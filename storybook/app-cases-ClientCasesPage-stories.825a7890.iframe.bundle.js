"use strict";(self.webpackChunkapp_scaffold=self.webpackChunkapp_scaffold||[]).push([[3590],{"./.storybook/MapPreviewStub.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>MapPreviewStub});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/jsx-runtime.js");function MapPreviewStub({width,height,className}){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:null!=className?className:"",style:{aspectRatio:`${width} / ${height}`},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("img",{src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='150'%3E%3Crect width='100%25' height='100%25' fill='%23ddd'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23666' font-family='sans-serif' font-size='20'%3EMap Preview%3C/text%3E%3C/svg%3E",alt:"Map preview placeholder",width,height,loading:"lazy"})})}MapPreviewStub.__docgenInfo={description:"",methods:[],displayName:"MapPreviewStub",props:{width:{required:!0,tsType:{name:"number"},description:""},height:{required:!0,tsType:{name:"number"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}}},"./src/app/cases/ClientCasesPage.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MultipleCases:()=>MultipleCases,SelectedCase:()=>SelectedCase,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ClientCasesPage_stories});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/jsx-runtime.js"),apiClient=__webpack_require__("./src/apiClient.ts"),useNewCaseFromFiles=__webpack_require__("./src/app/useNewCaseFromFiles.ts"),MapPreviewStub=__webpack_require__("./.storybook/MapPreviewStub.tsx"),caseUtils=__webpack_require__("./src/lib/caseUtils.ts"),es=__webpack_require__("./node_modules/.pnpm/react-i18next@15.6.0_i18next@25.3.1_typescript@5.8.3__react-dom@19.1.0_react@19.1.0__react@19.1.0_typescript@5.8.3/node_modules/react-i18next/dist/es/index.js");function CaseCard({caseData,className}){var _caseData_analysis;const{t}=(0,es.Bd)(),photo=(0,caseUtils.wq)(caseData),location=(0,caseUtils.qR)(caseData),plateNumber=(0,caseUtils.qy)(caseData),plateState=(0,caseUtils.W7)(caseData),status=caseData.archived?t("archived"):caseData.closed?t("closed"):t("open");return(0,jsx_runtime.jsxs)("div",{className:`grid grid-cols-[auto_auto_1fr] items-center gap-2 ${null!=className?className:""}`,children:[photo?(0,jsx_runtime.jsxs)("div",{className:"relative w-16 h-12 shrink-0",children:[(0,jsx_runtime.jsx)("img",{src:`/uploads/${photo}`,alt:t("casePreview"),width:64,height:48,className:"object-cover w-full h-full",loading:"lazy"}),caseData.photos.length>1?(0,jsx_runtime.jsx)("span",{className:"absolute bottom-1 right-1 bg-black/75 text-white text-xs rounded px-1",children:caseData.photos.length}):null]}):null,location?(0,jsx_runtime.jsx)(MapPreviewStub.A,{lat:location.lat,lon:location.lon,width:96,height:72,className:"w-16 aspect-[4/3]"}):null,(0,jsx_runtime.jsxs)("div",{className:"flex flex-col text-xs gap-0.5 overflow-hidden",children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold text-sm truncate",children:t("caseLabel",{id:caseData.id})}),(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.violationType)?(0,jsx_runtime.jsx)("span",{className:"truncate",children:caseData.analysis.violationType}):null,plateNumber||plateState?(0,jsx_runtime.jsxs)("span",{className:"text-gray-500 dark:text-gray-400 truncate",children:[plateState?`${plateState} `:"",plateNumber]}):null,(0,jsx_runtime.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:status}),"pending"===caseData.analysisStatus?(0,jsx_runtime.jsx)("span",{className:"text-gray-400",children:t("updatingAnalysis")}):null]})]})}CaseCard.__docgenInfo={description:"",methods:[],displayName:"CaseCard",props:{caseData:{required:!0,tsType:{name:"Case"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};const WGS84_F=1/298.257223563;function toRad(deg){return deg*Math.PI/180}function distanceBetween(a,b){const L=toRad(b.lon-a.lon),U1=Math.atan((1-WGS84_F)*Math.tan(toRad(a.lat))),U2=Math.atan((1-WGS84_F)*Math.tan(toRad(b.lat))),sinU1=Math.sin(U1),cosU1=Math.cos(U1),sinU2=Math.sin(U2),cosU2=Math.cos(U2);let lambda=L,lambdaP=0,iter=0,cosSqAlpha=0,sinSigma=0,cosSigma=0,sigma=0,cos2SigmaM=0;do{const sinLambda=Math.sin(lambda),cosLambda=Math.cos(lambda);if(sinSigma=Math.sqrt((cosU2*sinLambda)**2+(cosU1*sinU2-sinU1*cosU2*cosLambda)**2),0===sinSigma)return 0;cosSigma=sinU1*sinU2+cosU1*cosU2*cosLambda,sigma=Math.atan2(sinSigma,cosSigma);const sinAlpha=cosU1*cosU2*sinLambda/sinSigma;cosSqAlpha=1-sinAlpha**2,cos2SigmaM=0!==cosSqAlpha?cosSigma-2*sinU1*sinU2/cosSqAlpha:0;const C=WGS84_F/16*cosSqAlpha*(4+WGS84_F*(4-3*cosSqAlpha));lambdaP=lambda,lambda=L+(1-C)*WGS84_F*sinAlpha*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(2*cos2SigmaM**2-1)))}while(Math.abs(lambda-lambdaP)>1e-12&&++iter<1e3);const uSq=272331606109.84375*cosSqAlpha/40408299984659.16,B=uSq/1024*(256+uSq*(uSq*(74-47*uSq)-128));return 6356752.314245*(1+uSq/16384*(4096+uSq*(uSq*(320-175*uSq)-768)))*(sigma-B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(2*cos2SigmaM**2-1)-B/6*cos2SigmaM*(4*sinSigma**2-3)*(4*cos2SigmaM**2-3))))}var esm=__webpack_require__("./node_modules/.pnpm/@tanstack+react-virtual@3.13.12_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/@tanstack/react-virtual/dist/esm/index.js"),next_link=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/link.js"),link_default=__webpack_require__.n(next_link),navigation=__webpack_require__("./node_modules/.pnpm/@storybook+nextjs@8.6.14_esbuild@0.25.5_next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@_ncigxvbcd5lb3ppgtj3i534psq/node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),react=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/index.js"),NotificationProvider=__webpack_require__("./src/app/components/NotificationProvider.tsx"),useEventSource=__webpack_require__("./src/app/hooks/useEventSource.ts"),useSession=__webpack_require__("./src/app/useSession.ts"),useDragReset=__webpack_require__("./src/app/cases/useDragReset.ts");function sortList(list,key,location){if("distance"===key&&location)return[...list].sort((a,b)=>{const ag=(0,caseUtils.qR)(a),bg=(0,caseUtils.qR)(b);return ag||bg?ag?bg?distanceBetween(location,ag)-distanceBetween(location,bg):-1:1:0});const k=key;return[...list].sort((a,b)=>{var _b_k,_a_k;return new Date(null!==(_b_k=b[k])&&void 0!==_b_k?_b_k:b.createdAt).getTime()-new Date(null!==(_a_k=a[k])&&void 0!==_a_k?_a_k:a.createdAt).getTime()})}function ClientCasesPage({initialCases,scrollElement}){var _searchParams_get;const[orderBy,setOrderBy]=(0,react.useState)("createdAt"),[cases,setCases]=(0,react.useState)(()=>sortList(initialCases,"createdAt")),[states,setStates]=(0,react.useState)(["open"]),[userLocation,setUserLocation]=(0,react.useState)(null),router=(0,navigation.useRouter)(),{t}=(0,es.Bd)(),uploadNewCase=(0,useNewCaseFromFiles.A)(),[dragging,setDragging]=(0,react.useState)(!1),[dropCase,setDropCase]=(0,react.useState)(null),notify=(0,NotificationProvider.l)(),{data:session}=(0,useSession.wV)(),params=(0,navigation.useParams)();var _searchParams_get_split_filter;const selectedIds=null!==(_searchParams_get_split_filter=null===(_searchParams_get=(0,navigation.useSearchParams)().get("ids"))||void 0===_searchParams_get?void 0:_searchParams_get.split(",").filter(Boolean))&&void 0!==_searchParams_get_split_filter?_searchParams_get_split_filter:params.id?[params.id]:[],localScrollRef=(0,react.useRef)(null),filteredCases=cases.filter(c=>{const state=c.archived?"archived":c.closed?"closed":"open";return states.includes(state)}),rowVirtualizer=scrollElement?(0,esm.Te)({count:filteredCases.length,getScrollElement:()=>scrollElement.current,estimateSize:()=>150,overscan:5}):null;return(0,useEventSource.A)(session?"/api/cases/stream":null,data=>{setCases(prev=>{if(data.deleted)return sortList(prev.filter(c=>c.id!==data.id),orderBy,userLocation);const idx=prev.findIndex(c=>c.id===data.id);if(-1===idx)return sortList([...prev,data],orderBy,userLocation);const copy=[...prev];return copy[idx]=data,sortList(copy,orderBy,userLocation)})}),(0,react.useEffect)(()=>{setCases(prev=>sortList(prev,orderBy,userLocation))},[orderBy,userLocation]),(0,react.useEffect)(()=>{"distance"===orderBy&&!userLocation&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(pos=>{setUserLocation({lat:pos.coords.latitude,lon:pos.coords.longitude})})},[orderBy,userLocation]),(0,useDragReset.A)(()=>{setDragging(!1),setDropCase(null)}),(0,jsx_runtime.jsxs)("div",{ref:scrollElement?void 0:localScrollRef,className:"p-8 relative h-full",onDragOver:e=>e.preventDefault(),onDragEnter:e=>{e.preventDefault(),setDragging(!0)},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||(setDragging(!1),setDropCase(null))},onDrop:async e=>{e.preventDefault();const files=e.dataTransfer.files;dropCase?await async function uploadFilesToCase(id,files){(await Promise.all(Array.from(files).map(file=>{const formData=new FormData;return formData.append("photo",file),formData.append("caseId",id),(0,apiClient.n)("/api/upload",{method:"POST",body:formData})}))).some(r=>!r.ok)&&notify(t("failedUpload"))}(dropCase,files):await uploadNewCase(files),setDragging(!1),setDropCase(null)},children:[(0,jsx_runtime.jsx)("h1",{className:"text-xl font-bold mb-4",children:t("nav.cases")}),(0,jsx_runtime.jsxs)("div",{className:"mb-4 flex items-center gap-4",children:[(0,jsx_runtime.jsx)("label",{className:"mr-2",htmlFor:"order",children:t("orderBy")}),(0,jsx_runtime.jsxs)("select",{id:"order",value:orderBy,onChange:e=>setOrderBy(e.target.value),className:"border rounded p-1 bg-white dark:bg-gray-900",children:[(0,jsx_runtime.jsx)("option",{value:"createdAt",children:t("creationDate")}),(0,jsx_runtime.jsx)("option",{value:"updatedAt",children:t("lastUpdated")}),(0,jsx_runtime.jsx)("option",{value:"distance",children:t("distanceFromMe")})]}),(0,jsx_runtime.jsxs)("label",{className:"flex items-center gap-1",htmlFor:"case-states",children:[(0,jsx_runtime.jsx)("span",{children:t("show")}),(0,jsx_runtime.jsxs)("select",{id:"case-states",multiple:!0,value:states,onChange:e=>setStates(Array.from(e.target.selectedOptions).map(o=>o.value)),className:"border rounded p-1 bg-white dark:bg-gray-900",children:[(0,jsx_runtime.jsx)("option",{value:"open",children:t("open")}),(0,jsx_runtime.jsx)("option",{value:"archived",children:t("archived")}),(0,jsx_runtime.jsx)("option",{value:"closed",children:t("closed")})]})]})]}),rowVirtualizer?(0,jsx_runtime.jsx)("div",{style:{height:rowVirtualizer.getTotalSize(),position:"relative"},children:rowVirtualizer.getVirtualItems().map(virtualRow=>{const c=filteredCases[virtualRow.index];return(0,jsx_runtime.jsx)("div",{ref:rowVirtualizer.measureElement,onDragEnter:()=>{setDropCase(c.id),setDragging(!0)},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||setDropCase(null)},className:"border rounded p-2 mb-4 last:mb-0"+(selectedIds.includes(c.id)?" bg-gray-100 dark:bg-gray-800 ring-2 ring-blue-500":dropCase===c.id?" ring-2 ring-green-500":" ring-1 ring-transparent"),style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${virtualRow.start}px)`},children:(0,jsx_runtime.jsx)(link_default(),{href:session?`/cases/${c.id}`:`/public/cases/${c.id}`,onClick:e=>{if(e.shiftKey){e.preventDefault();const ids=Array.from(new Set([...selectedIds,c.id]));router.push(`/cases?ids=${ids.join(",")}`)}},className:"block text-left",children:(0,jsx_runtime.jsx)(CaseCard,{caseData:c})})},c.id)})}):(0,jsx_runtime.jsx)("ul",{className:"grid gap-4",children:filteredCases.map(c=>(0,jsx_runtime.jsx)("li",{onDragEnter:()=>{setDropCase(c.id),setDragging(!0)},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||setDropCase(null)},className:"border rounded p-2"+(selectedIds.includes(c.id)?" bg-gray-100 dark:bg-gray-800 ring-2 ring-blue-500":dropCase===c.id?" ring-2 ring-green-500":" ring-1 ring-transparent"),children:(0,jsx_runtime.jsx)(link_default(),{href:session?`/cases/${c.id}`:`/public/cases/${c.id}`,onClick:e=>{if(e.shiftKey){e.preventDefault();const ids=Array.from(new Set([...selectedIds,c.id]));router.push(`/cases?ids=${ids.join(",")}`)}},className:"block text-left",children:(0,jsx_runtime.jsx)(CaseCard,{caseData:c})})},c.id))}),dragging?(0,jsx_runtime.jsx)("div",{className:"absolute inset-0 bg-black/50 text-white flex items-center justify-center pointer-events-none text-xl z-nav",children:dropCase?t("addPhotosToCase",{id:dropCase}):t("dropPhotosToCreateCase")}):null]})}ClientCasesPage.__docgenInfo={description:"",methods:[],displayName:"ClientCasesPage",props:{initialCases:{required:!0,tsType:{name:"Array",elements:[{name:"Case"}],raw:"Case[]"},description:""},scrollElement:{required:!1,tsType:{name:"RefObject",elements:[{name:"union",raw:"HTMLDivElement | null",elements:[{name:"HTMLDivElement"},{name:"null"}]}],raw:"RefObject<HTMLDivElement | null>"},description:""}}};const ClientCasesPage_stories={component:ClientCasesPage,title:"Pages/ClientCasesPage"},caseBase={photos:["https://placehold.co/600x400?text=photo"],photoTimes:{},createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),gps:{lat:41.88,lon:-87.78},streetAddress:null,intersection:null,vin:null,vinOverride:null,analysis:null,analysisOverrides:null,analysisStatus:"pending",analysisStatusCode:null,public:!1,sentEmails:[],ownershipRequests:[]},MultipleCases={render:()=>{const cases=[{id:"1",...caseBase,analysis:{violationType:"parking",details:{en:"Blocking sidewalk"},vehicle:{licensePlateNumber:"ABC123"},location:"Oak Park",images:{}},analysisStatus:"complete"},{id:"2",...caseBase,photos:["https://placehold.co/600x400?text=photo2","https://placehold.co/601x400?text=photo3"]}];return(0,jsx_runtime.jsx)(ClientCasesPage,{initialCases:cases})}},SelectedCase={render:()=>{const cases=[{id:"1",...caseBase},{id:"2",...caseBase}];return(0,jsx_runtime.jsx)(ClientCasesPage,{initialCases:cases})}},__namedExportsOrder=["MultipleCases","SelectedCase"];MultipleCases.parameters={...MultipleCases.parameters,docs:{...MultipleCases.parameters?.docs,source:{originalSource:'{\n  render: () => {\n    const cases: Case[] = [{\n      id: "1",\n      ...caseBase,\n      analysis: {\n        violationType: "parking",\n        details: {\n          en: "Blocking sidewalk"\n        },\n        vehicle: {\n          licensePlateNumber: "ABC123"\n        },\n        location: "Oak Park",\n        images: {}\n      },\n      analysisStatus: "complete"\n    }, {\n      id: "2",\n      ...caseBase,\n      photos: ["https://placehold.co/600x400?text=photo2", "https://placehold.co/601x400?text=photo3"]\n    }];\n    return <ClientCasesPage initialCases={cases} />;\n  }\n}',...MultipleCases.parameters?.docs?.source}}},SelectedCase.parameters={...SelectedCase.parameters,docs:{...SelectedCase.parameters?.docs,source:{originalSource:'{\n  render: () => {\n    const cases: Case[] = [{\n      id: "1",\n      ...caseBase\n    }, {\n      id: "2",\n      ...caseBase\n    }];\n    return <ClientCasesPage initialCases={cases} />;\n  }\n}',...SelectedCase.parameters?.docs?.source}}}},"./src/app/cases/useDragReset.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useDragReset});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/index.js");function useDragReset(reset){(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{function handleDragEnd(){reset()}function handleDragLeave(e){e.relatedTarget||reset()}return window.addEventListener("dragend",handleDragEnd),window.addEventListener("drop",handleDragEnd),window.addEventListener("dragleave",handleDragLeave),()=>{window.removeEventListener("dragend",handleDragEnd),window.removeEventListener("drop",handleDragEnd),window.removeEventListener("dragleave",handleDragLeave)}},[reset])}},"./src/app/hooks/useEventSource.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useEventSource});var _apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/apiClient.ts"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/index.js");function useEventSource(url,onData){const cbRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(onData);(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{cbRef.current=onData},[onData]);const handleMessage=(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)(e=>{try{cbRef.current(JSON.parse(e.data))}catch(e){}},[]);(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(!url)return;const es=(0,_apiClient__WEBPACK_IMPORTED_MODULE_0__.a)(url);return es.onmessage=handleMessage,()=>es.close()},[url])}},"./src/app/useNewCaseFromFiles.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useNewCaseFromFiles});var _apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/apiClient.ts"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@5.81.5_react@19.1.0/node_modules/@tanstack/react-query/build/modern/useMutation.js"),next_navigation__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@storybook+nextjs@8.6.14_esbuild@0.25.5_next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@_ncigxvbcd5lb3ppgtj3i534psq/node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),react_i18next__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react-i18next@15.6.0_i18next@25.3.1_typescript@5.8.3__react-dom@19.1.0_react@19.1.0__react@19.1.0_typescript@5.8.3/node_modules/react-i18next/dist/es/index.js"),_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/app/components/NotificationProvider.tsx");function useNewCaseFromFiles(){const router=(0,next_navigation__WEBPACK_IMPORTED_MODULE_1__.useRouter)(),notify=(0,_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_3__.l)(),{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_2__.Bd)(),uploadMutation=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_4__.n)({mutationFn:async formData=>(0,_apiClient__WEBPACK_IMPORTED_MODULE_0__.n)("/api/upload",{method:"POST",body:formData})});return async(files,gps)=>{if(!files||0===files.length)return;const id=crypto.randomUUID(),preview=URL.createObjectURL(files[0]);sessionStorage.setItem(`preview-${id}`,preview);(await Promise.all(Array.from(files).map((file,idx)=>{const formData=new FormData;formData.append("photo",file),formData.append("caseId",id),gps&&(formData.append("lat",String(gps.lat)),formData.append("lon",String(gps.lon)));const upload=uploadMutation.mutateAsync(formData);return 0===idx&&upload.then(()=>{sessionStorage.removeItem(`preview-${id}`)}),upload}))).some(r=>!r.ok)?notify(t("failedUpload")):router.push(`/cases/${id}`)}}},"./src/app/useSession.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{CI:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.signOut,Jv:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.signIn,wV:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.useSession});var next_auth_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next-auth@4.24.11_@auth+core@0.34.2_nodemailer@6.10.1__next@15.3.3_@babel+core@7.7.4_react-do_zjcut2ggo65zodhp2il2qrfvoq/node_modules/next-auth/react/index.js")},"./src/lib/caseUtils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Pk:()=>getAnalysisSummary,_g:()=>getBestViolationPhoto,g_:()=>getCaseOwnerContact,sC:()=>getCaseOwnerContactInfo,qy:()=>getCasePlateNumber,W7:()=>getCasePlateState,E5:()=>getCaseVin,cy:()=>getLatestOwnershipRequestLink,qR:()=>getOfficialCaseGps,wq:()=>getRepresentativePhoto,u5:()=>hasCaseViolation});var i18next=__webpack_require__("./node_modules/.pnpm/i18next@25.3.1_typescript@5.8.3/node_modules/i18next/dist/esm/i18next.js");__webpack_require__("./public/locales/en/common.json"),__webpack_require__("./public/locales/es/common.json"),__webpack_require__("./public/locales/fr/common.json");const instance=i18next.Ay.createInstance();const i18n_server=instance;function basename(filePath){const parts=filePath.split(/[\\/]/);return parts[parts.length-1]}function getRepresentativePhoto(caseData){var _caseData_analysis;if(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images){const best=Object.entries(caseData.analysis.images).sort((a,b)=>b[1].representationScore-a[1].representationScore)[0];if(best){const name=best[0],file=caseData.photos.find(p=>basename(p)===name);if(file)return file}}const sorted=[...caseData.photos].sort();return sorted.length>0?sorted[0]:null}function getOfficialCaseGps(caseData){var _caseData_analysis,_caseData_gps;if((null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)&&caseData.photoGps){const entries=Object.entries(caseData.analysis.images).sort((a,b)=>b[1].representationScore-a[1].representationScore);for(const[name]of entries){const file=caseData.photos.find(p=>basename(p)===name);if(file){const gps=caseData.photoGps[file];if(gps)return gps}}}if(caseData.photoGps)for(const p of caseData.photos){const g=caseData.photoGps[p];if(g)return g}return null!==(_caseData_gps=caseData.gps)&&void 0!==_caseData_gps?_caseData_gps:null}function hasCaseViolation(c){return!!c.violationOverride||function hasViolation(report){var _report_violationType;if(!report)return!1;if(report.images){const all=Object.values(report.images),hasTrue=all.some(i=>!0===i.violation),hasFalse=all.some(i=>!1===i.violation);if(hasTrue||hasFalse)return hasTrue}return Boolean(null===(_report_violationType=report.violationType)||void 0===_report_violationType?void 0:_report_violationType.trim())}(c.analysis)}function getCaseVin(caseData){var _caseData_analysis;if(caseData.vin)return caseData.vin;const imgs=(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const vin=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.vin;if(vin)return vin}return null}function getCasePlateNumber(caseData){var _caseData_analysis_vehicle,_caseData_analysis,_caseData_analysis1;const direct=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis||null===(_caseData_analysis_vehicle=_caseData_analysis.vehicle)||void 0===_caseData_analysis_vehicle?void 0:_caseData_analysis_vehicle.licensePlateNumber;if(direct)return direct;const imgs=(null===(_caseData_analysis1=caseData.analysis)||void 0===_caseData_analysis1?void 0:_caseData_analysis1.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const plate=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.licensePlateNumber;if(plate)return plate}return null}function getCasePlateState(caseData){var _caseData_analysis_vehicle,_caseData_analysis,_caseData_analysis1;const direct=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis||null===(_caseData_analysis_vehicle=_caseData_analysis.vehicle)||void 0===_caseData_analysis_vehicle?void 0:_caseData_analysis_vehicle.licensePlateState;if(direct)return direct;const imgs=(null===(_caseData_analysis1=caseData.analysis)||void 0===_caseData_analysis1?void 0:_caseData_analysis1.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const state=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.licensePlateState;if(state)return state}return null}function getCaseOwnerContact(caseData){var _caseData_analysis;const imgs=(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo;const contact=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo?void 0:_info_paperworkInfo.contact;if(contact)return contact}return null}function getCaseOwnerContactInfo(caseData){const contact=getCaseOwnerContact(caseData);return contact?function parseContactInfo(text){const emailMatch=text.match(/[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}/),phoneMatch=text.match(/\+?\d[\d\s().-]{7,}\d/);let address;return text.trim().split(/\n+/).length>1&&(address=text.trim()),{email:emailMatch?emailMatch[0]:void 0,phone:phoneMatch?phoneMatch[0]:void 0,address}}(contact):null}function getLatestOwnershipRequestLink(caseData){var _caseData_sentEmails;const email=[...null!==(_caseData_sentEmails=caseData.sentEmails)&&void 0!==_caseData_sentEmails?_caseData_sentEmails:[]].filter(m=>"Ownership information request"===m.subject).sort((a,b)=>b.sentAt.localeCompare(a.sentAt))[0];return email?`/cases/${caseData.id}/thread/${encodeURIComponent(email.sentAt)}`:null}function getBestViolationPhoto(caseData){var _caseData_analysis,_info_highlights,_info_highlights1,_caseData_analysis_images;const imgs=null!==(_caseData_analysis_images=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)&&void 0!==_caseData_analysis_images?_caseData_analysis_images:{},entries=Object.entries(imgs).filter(([,info])=>info.violation).sort((a,b)=>b[1].representationScore-a[1].representationScore),best=entries[0];if(!best)return null;const[name,info]=best,file=caseData.photos.find(p=>basename(p)===name);if(!file)return null;var _info_highlights_i18n_language,_info_highlights2,_ref;return{photo:file,caption:"string"==typeof info.highlights?info.highlights:null!==(_ref=null!==(_info_highlights_i18n_language=null===(_info_highlights=info.highlights)||void 0===_info_highlights?void 0:_info_highlights[i18n_server.language])&&void 0!==_info_highlights_i18n_language?_info_highlights_i18n_language:null===(_info_highlights1=info.highlights)||void 0===_info_highlights1?void 0:_info_highlights1.en)&&void 0!==_ref?_ref:Object.values(null!==(_info_highlights2=info.highlights)&&void 0!==_info_highlights2?_info_highlights2:{})[0]}}function getAnalysisSummary(report){var _report_vehicle,_report_vehicle1,_report_details_i18n_language,_ref,_ref1;const detailText="string"==typeof report.details?report.details:null!==(_ref1=null!==(_ref=null!==(_report_details_i18n_language=report.details[i18n_server.language])&&void 0!==_report_details_i18n_language?_report_details_i18n_language:report.details.en)&&void 0!==_ref?_ref:Object.values(report.details)[0])&&void 0!==_ref1?_ref1:"",parts=[`Violation: ${report.violationType}`,detailText];report.location&&parts.push(`Location: ${report.location}`);const plate=[];return(null===(_report_vehicle=report.vehicle)||void 0===_report_vehicle?void 0:_report_vehicle.licensePlateState)&&plate.push(report.vehicle.licensePlateState),(null===(_report_vehicle1=report.vehicle)||void 0===_report_vehicle1?void 0:_report_vehicle1.licensePlateNumber)&&plate.push(report.vehicle.licensePlateNumber),plate.length>0&&parts.push(`Plate: ${plate.join(" ")}`),parts.filter(Boolean).join("\n")}}}]);