"use strict";(self.webpackChunkapp_scaffold=self.webpackChunkapp_scaffold||[]).push([[6234],{"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!./node_modules/postcss-loader/dist/cjs.js!./src/app/cases/[id]/CaseChat.module.css":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,'.CaseChat_bubble__CZgum {\n  position: relative;\n  display: inline-block;\n  max-width: 100%;\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n}\n\n.CaseChat_user__ux9N4 {\n  background-color: rgb(37, 99, 235); /* blue-600 */\n  color: white;\n}\n.CaseChat_user__ux9N4::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  right: -0.25rem;\n  border-width: 0.4rem 0 0.4rem 0.4rem;\n  border-style: solid;\n  border-color: transparent transparent transparent rgb(37, 99, 235);\n}\n\n@media (prefers-color-scheme: dark) {\n  .CaseChat_user__ux9N4 {\n    background-color: rgb(29, 78, 216); /* blue-700 */\n  }\n  .CaseChat_user__ux9N4::after {\n    border-left-color: rgb(29, 78, 216);\n  }\n}\n\n.CaseChat_assistant__BSx_p {\n  background-color: rgb(229, 231, 235); /* gray-200 */\n}\n.CaseChat_assistant__BSx_p::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(229, 231, 235) transparent transparent;\n}\n\n.CaseChat_error__nvroa {\n  background-color: rgb(220, 38, 38); /* red-600 */\n  color: white;\n}\n.CaseChat_error__nvroa::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(220, 38, 38) transparent transparent;\n}\n\n@media (prefers-color-scheme: dark) {\n  .CaseChat_assistant__BSx_p {\n    background-color: rgb(55, 65, 81); /* gray-700 */\n    color: white;\n  }\n  .CaseChat_assistant__BSx_p::after {\n    border-right-color: rgb(55, 65, 81);\n  }\n}\n\n@keyframes CaseChat_typing-ellipsis__fDGZx {\n  to {\n    width: 1.2em;\n  }\n}\n\n.CaseChat_typing__0BvNE::after {\n  content: "...";\n  overflow: hidden;\n  display: inline-block;\n  vertical-align: bottom;\n  width: 0;\n  animation: CaseChat_typing-ellipsis__fDGZx 1s steps(4, end) infinite;\n}\n',"",{version:3,sources:["webpack://./src/app/cases/[id]/CaseChat.module.css"],names:[],mappings:"AAAA;EACE,kBAAkB;EAClB,qBAAqB;EACrB,eAAe;EACf,uBAAuB;EACvB,sBAAsB;AACxB;;AAEA;EACE,kCAAkC,EAAE,aAAa;EACjD,YAAY;AACd;AACA;EACE,WAAW;EACX,kBAAkB;EAClB,eAAe;EACf,eAAe;EACf,oCAAoC;EACpC,mBAAmB;EACnB,kEAAkE;AACpE;;AAEA;EACE;IACE,kCAAkC,EAAE,aAAa;EACnD;EACA;IACE,mCAAmC;EACrC;AACF;;AAEA;EACE,oCAAoC,EAAE,aAAa;AACrD;AACA;EACE,WAAW;EACX,kBAAkB;EAClB,eAAe;EACf,cAAc;EACd,oCAAoC;EACpC,mBAAmB;EACnB,oEAAoE;AACtE;;AAEA;EACE,kCAAkC,EAAE,YAAY;EAChD,YAAY;AACd;AACA;EACE,WAAW;EACX,kBAAkB;EAClB,eAAe;EACf,cAAc;EACd,oCAAoC;EACpC,mBAAmB;EACnB,kEAAkE;AACpE;;AAEA;EACE;IACE,iCAAiC,EAAE,aAAa;IAChD,YAAY;EACd;EACA;IACE,mCAAmC;EACrC;AACF;;AAEA;EACE;IACE,YAAY;EACd;AACF;;AAEA;EACE,cAAc;EACd,gBAAgB;EAChB,qBAAqB;EACrB,sBAAsB;EACtB,QAAQ;EACR,oEAAoD;AACtD",sourcesContent:['.bubble {\n  position: relative;\n  display: inline-block;\n  max-width: 100%;\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n}\n\n.user {\n  background-color: rgb(37, 99, 235); /* blue-600 */\n  color: white;\n}\n.user::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  right: -0.25rem;\n  border-width: 0.4rem 0 0.4rem 0.4rem;\n  border-style: solid;\n  border-color: transparent transparent transparent rgb(37, 99, 235);\n}\n\n@media (prefers-color-scheme: dark) {\n  .user {\n    background-color: rgb(29, 78, 216); /* blue-700 */\n  }\n  .user::after {\n    border-left-color: rgb(29, 78, 216);\n  }\n}\n\n.assistant {\n  background-color: rgb(229, 231, 235); /* gray-200 */\n}\n.assistant::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(229, 231, 235) transparent transparent;\n}\n\n.error {\n  background-color: rgb(220, 38, 38); /* red-600 */\n  color: white;\n}\n.error::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(220, 38, 38) transparent transparent;\n}\n\n@media (prefers-color-scheme: dark) {\n  .assistant {\n    background-color: rgb(55, 65, 81); /* gray-700 */\n    color: white;\n  }\n  .assistant::after {\n    border-right-color: rgb(55, 65, 81);\n  }\n}\n\n@keyframes typing-ellipsis {\n  to {\n    width: 1.2em;\n  }\n}\n\n.typing::after {\n  content: "...";\n  overflow: hidden;\n  display: inline-block;\n  vertical-align: bottom;\n  width: 0;\n  animation: typing-ellipsis 1s steps(4, end) infinite;\n}\n'],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={bubble:"CaseChat_bubble__CZgum",user:"CaseChat_user__ux9N4",assistant:"CaseChat_assistant__BSx_p",error:"CaseChat_error__nvroa",typing:"CaseChat_typing__0BvNE","typing-ellipsis":"CaseChat_typing-ellipsis__fDGZx"};const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___},"./src/app/cases/[id]/CaseChat.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>CaseChat});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");var apiClient=__webpack_require__("./src/apiClient.ts"),thumbnail_image=__webpack_require__("./src/components/thumbnail-image.tsx");__webpack_require__("./src/lib/caseUtils.ts"),__webpack_require__("./src/lib/reportModules.ts");const caseActions=[{id:"compose",label:"Draft Report",href:id=>`/cases/${id}/compose`,description:"Open a modal to draft an email report to the relevant authority. Use when the user wants to formally report the violation."},{id:"followup",label:"Follow Up",href:id=>`/cases/${id}/followup`,description:"Send a follow-up email referencing previous correspondence. Suggest this when the user needs to check the status of a prior report."},{id:"notify-owner",label:"Notify Owner",href:id=>`/cases/${id}/notify-owner`,description:"Send an anonymous notice to the vehicle owner about the violation. Useful when the owner might not know they were reported."},{id:"ownership",label:"Request Ownership Info",href:id=>`/cases/${id}/ownership`,description:"Record the steps for requesting official ownership details from the state. Use if the license plate is known but contact info is missing."},{id:"upload-photo",label:"Upload Photo",href:id=>`/upload?case=${id}`,description:"Upload an existing photo to this case."},{id:"take-photo",label:"Take Photo",href:id=>`/point?case=${id}`,description:"Use your camera to take a new photo for this case."}];var clientThumbnails=__webpack_require__("./src/lib/clientThumbnails.ts"),localizedText=__webpack_require__("./src/lib/localizedText.ts"),navigation=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),InlineTranslateButton=__webpack_require__("./src/app/components/InlineTranslateButton.tsx"),NotificationProvider=__webpack_require__("./src/app/components/NotificationProvider.tsx");const CaseChatContext=(0,react.createContext)(null);function useCaseChat(){const ctx=(0,react.useContext)(CaseChatContext);if(!ctx)throw new Error("CaseChatContext missing");return ctx}function CaseChatProvider({caseId,onChat,expanded:controlledExpanded,onExpandChange,children}){const[open,setOpen]=(0,react.useState)(!1),[expandedState,setExpandedState]=(0,react.useState)(!1),expanded=null!=controlledExpanded?controlledExpanded:expandedState,[messages,setMessages]=(0,react.useState)([]),[history,setHistory]=(0,react.useState)([]),[sessionId,setSessionId]=(0,react.useState)(null),[sessionCreatedAt,setSessionCreatedAt]=(0,react.useState)(""),[sessionSummary,setSessionSummary]=(0,react.useState)(""),[systemPrompt,setSystemPrompt]=(0,react.useState)(""),[availableActions,setAvailableActions]=(0,react.useState)([]),[unavailableActions,setUnavailableActions]=(0,react.useState)([]),[input,setInput]=(0,react.useState)(""),[loading,setLoading]=(0,react.useState)(!1),{i18n,t}=(0,es.Bd)(),scrollRef=(0,react.useRef)(null),inputRef=(0,react.useRef)(null),[showJump,setShowJump]=(0,react.useState)(!1),abortRef=(0,react.useRef)(null),openRef=(0,react.useRef)(open),saveCurrentSessionRef=(0,react.useRef)(()=>{}),[photoMap,setPhotoMap]=(0,react.useState)({});(0,react.useEffect)(()=>{openRef.current=open},[open]),(0,react.useEffect)(()=>{if(!open)return;if(window.innerWidth>=640)return;const htmlStyle=document.documentElement.style.overflow,bodyStyle=document.body.style.overflow;return document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",()=>{document.documentElement.style.overflow=htmlStyle,document.body.style.overflow=bodyStyle}},[open]);const[draftData,setDraftData]=(0,react.useState)(null),[draftLoading,setDraftLoading]=(0,react.useState)(!1),[cameraOpen,setCameraOpen]=(0,react.useState)(!1),[draftAnchorId,setDraftAnchorId]=(0,react.useState)(null),[cameraAnchorId,setCameraAnchorId]=(0,react.useState)(null),notify=(0,NotificationProvider.l)(),chatTranslate=function useChatTranslate(caseId){const notify=(0,NotificationProvider.l)(),{t}=(0,es.Bd)();return async(text,lang)=>{const res=await(0,apiClient.n)(`/api/cases/${caseId}/chat/translate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text,lang})});if(!res.ok)throw notify(t("failedToTranslate")),new Error(t("failedToTranslate"));return(await res.json()).translation}}(caseId),[chatError,setChatError]=(0,react.useState)(null),storageKey=`case-chat-${caseId}`,stateKey=`case-chat-state-${caseId}`,loadHistory=(0,react.useCallback)(()=>{try{const raw=localStorage.getItem(storageKey);if(!raw)return[];return JSON.parse(raw).map(s=>({...s,messages:s.messages.map(m=>{var _m_lang,_m_translations;return{...m,lang:null!==(_m_lang=m.lang)&&void 0!==_m_lang?_m_lang:"en",translations:null!==(_m_translations=m.translations)&&void 0!==_m_translations?_m_translations:{}}})}))}catch(e){return[]}},[storageKey]),saveHistory=(0,react.useCallback)(list=>{localStorage.setItem(storageKey,JSON.stringify(list))},[storageKey]),loadState=(0,react.useCallback)(()=>{try{const raw=localStorage.getItem(stateKey);return raw?JSON.parse(raw):null}catch(e){return null}},[stateKey]),saveState=(0,react.useCallback)(state=>{localStorage.setItem(stateKey,JSON.stringify(state))},[stateKey]);(0,react.useEffect)(()=>{setHistory(loadHistory())},[loadHistory]);const loadPhotos=(0,react.useCallback)(async()=>{const res=await(0,apiClient.n)(`/api/cases/${caseId}`);if(!res.ok)return;const data=await res.json(),map={};var _data_photos;for(const url of null!==(_data_photos=data.photos)&&void 0!==_data_photos?_data_photos:[]){const parts=url.split(/[\\/]/);map[parts[parts.length-1]]=url}setPhotoMap(map)},[caseId]);function startNew(){setMessages([]),setSessionId(crypto.randomUUID()),setSessionCreatedAt((new Date).toISOString()),setSessionSummary(""),setSystemPrompt(""),setAvailableActions([]),setUnavailableActions([]),setDraftAnchorId(null),setCameraAnchorId(null)}async function openDraft(anchorId){setDraftAnchorId(null!=anchorId?anchorId:null),setDraftLoading(!0),setDraftData(null);const res=await(0,apiClient.n)(`/api/cases/${caseId}/report?lang=${i18n.language}`);if(res.ok){const data=await res.json();setDraftData(data)}else{const err=await res.json().catch(()=>({}));notify(err.error||"Failed to draft report")}setDraftLoading(!1)}(0,react.useEffect)(()=>{loadPhotos()},[loadPhotos]),(0,react.useEffect)(()=>{const state=loadState();state&&(state.open&&setOpen(!0),void 0===controlledExpanded&&state.expanded&&setExpandedState(state.expanded),state.session&&(setMessages(state.session.messages.map(m=>{var _m_translations;return{...m,translations:null!==(_m_translations=m.translations)&&void 0!==_m_translations?_m_translations:{}}})),setSessionId(state.session.id),setSessionCreatedAt(state.session.createdAt),setSessionSummary(state.session.summary)))},[controlledExpanded,loadState]);const saveCurrentSession=(0,react.useCallback)(()=>{if(messages.length>0&&sessionId){const firstUser=messages.find(m=>"user"===m.role),summary=sessionSummary||(firstUser?firstUser.content.slice(0,30):""),session={id:sessionId,createdAt:sessionCreatedAt,summary,messages},list=[...history.filter(h=>h.id!==sessionId),session];setHistory(list),saveHistory(list)}},[messages,sessionId,sessionCreatedAt,sessionSummary,history,saveHistory]);(0,react.useEffect)(()=>{saveCurrentSessionRef.current=saveCurrentSession},[saveCurrentSession]);const router=(0,navigation.useRouter)();return(0,react.useEffect)(()=>{scrollRef.current&&(scrollRef.current.scrollTop=scrollRef.current.scrollHeight)},[messages]),(0,react.useEffect)(()=>{if(!scrollRef.current)return;const current=scrollRef.current;function update(){const canScroll=current.scrollHeight>current.clientHeight+1,atBottom=current.scrollTop+current.clientHeight>=current.scrollHeight-1;setShowJump(canScroll&&!atBottom)}update(),current.addEventListener("scroll",update),window.addEventListener("resize",update);const observer=new ResizeObserver(update);return observer.observe(current),()=>{current.removeEventListener("scroll",update),window.removeEventListener("resize",update),observer.disconnect()}},[open,messages,expanded]),(0,react.useEffect)(()=>{open&&inputRef.current&&inputRef.current.focus()},[open]),(0,react.useEffect)(()=>{const handler=()=>saveCurrentSessionRef.current();return window.addEventListener("beforeunload",handler),()=>{window.removeEventListener("beforeunload",handler),handler()}},[]),(0,react.useEffect)(()=>{openRef.current&&saveCurrentSessionRef.current(),messages.length},[messages]),(0,react.useEffect)(()=>{saveState({open,expanded,session:sessionId&&sessionCreatedAt?{id:sessionId,createdAt:sessionCreatedAt,summary:sessionSummary,messages}:void 0})},[open,expanded,messages,sessionId,sessionCreatedAt,sessionSummary,saveState]),(0,jsx_runtime.jsx)(CaseChatContext.Provider,{value:{open,expanded,expandedState,messages,history,input,loading,draftLoading,cameraOpen,chatError,photoMap,sessionId,sessionCreatedAt,sessionSummary,systemPrompt,availableActions,unavailableActions,showJump,scrollRef,inputRef,handleOpen:function handleOpen(){startNew(),setOpen(!0),void 0===controlledExpanded?setExpandedState(!1):null==onExpandChange||onExpandChange(!1),async function seed(){var _abortRef_current;setLoading(!0),null===(_abortRef_current=abortRef.current)||void 0===_abortRef_current||_abortRef_current.abort();const controller=new AbortController;abortRef.current=controller;try{let reply=null;if(onChat){const result=await onChat([]);if("string"==typeof result)reply=result.startsWith("[action:")&&result.endsWith("]")?{response:{en:""},actions:[{id:result.slice(8,-1)}],noop:!1,lang:i18n.language}:"[noop]"===result?{response:{en:""},actions:[],noop:!0,lang:i18n.language}:{response:{en:result},actions:[],noop:!1,lang:i18n.language};else if("response"in result)reply=result;else if("reply"in result){const r=result;reply=r.reply,r.system&&setSystemPrompt(r.system),r.available&&setAvailableActions(r.available),r.unavailable&&setUnavailableActions(r.unavailable)}else reply=result}else{const res=await(0,apiClient.n)(`/api/cases/${caseId}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[],lang:i18n.language}),signal:controller.signal});if(res.ok){const data=await res.json();var _data_available,_data_unavailable;reply=data.reply,setSystemPrompt(data.system),setAvailableActions(null!==(_data_available=data.available)&&void 0!==_data_available?_data_available:[]),setUnavailableActions(null!==(_data_unavailable=data.unavailable)&&void 0!==_data_unavailable?_data_unavailable:[])}}var _reply_response_i18n_language,_ref,_ref1;controller.signal.aborted||!reply||reply.noop||setMessages([{id:crypto.randomUUID(),role:"assistant",content:null!==(_ref1=null!==(_ref=null!==(_reply_response_i18n_language=reply.response[i18n.language])&&void 0!==_reply_response_i18n_language?_reply_response_i18n_language:reply.response.en)&&void 0!==_ref?_ref:Object.values(reply.response)[0])&&void 0!==_ref1?_ref1:"",lang:reply.lang,actions:reply.actions}])}catch(e){}controller.signal.aborted||setLoading(!1)}()},handleClose:function handleClose(){setOpen(!1),setDraftData(null),setDraftLoading(!1),setCameraOpen(!1),setDraftAnchorId(null),setCameraAnchorId(null),void 0===controlledExpanded?setExpandedState(!1):null==onExpandChange||onExpandChange(!1),saveCurrentSession(),localStorage.removeItem(stateKey)},toggleExpanded:function toggleExpanded(){const next=!expanded;void 0===controlledExpanded&&setExpandedState(next),null==onExpandChange||onExpandChange(next)},send:async function send(){const text=input.trim();if(!text)return;const list=[...messages,{id:crypto.randomUUID(),role:"user",content:text,lang:i18n.language,translations:{[i18n.language]:text}}];0===messages.length&&setSessionSummary(text.slice(0,30)),setMessages(list),setInput(""),await async function request(list){var _abortRef_current;setLoading(!0),null===(_abortRef_current=abortRef.current)||void 0===_abortRef_current||_abortRef_current.abort();const controller=new AbortController;abortRef.current=controller;try{let reply=null;if(onChat){const result=await onChat(list);if("string"==typeof result)reply=result.startsWith("[action:")&&result.endsWith("]")?{response:{en:""},actions:[{id:result.slice(8,-1)}],noop:!1,lang:i18n.language}:"[noop]"===result?{response:{en:""},actions:[],noop:!0,lang:i18n.language}:{response:{en:result},actions:[],noop:!1,lang:i18n.language};else if("response"in result)reply=result;else if("reply"in result){const r=result;reply=r.reply,r.system&&setSystemPrompt(r.system),r.available&&setAvailableActions(r.available),r.unavailable&&setUnavailableActions(r.unavailable)}else reply=result}else{const res=await(0,apiClient.n)(`/api/cases/${caseId}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:list,lang:i18n.language}),signal:controller.signal});if(res.ok){const data=await res.json();var _data_available,_data_unavailable;reply=data.reply,setSystemPrompt(data.system),setAvailableActions(null!==(_data_available=data.available)&&void 0!==_data_available?_data_available:[]),setUnavailableActions(null!==(_data_unavailable=data.unavailable)&&void 0!==_data_unavailable?_data_unavailable:[]),setChatError(null)}else{const err=await res.json().catch(()=>({}));503===res.status?setChatError(err.error||"Case Chat server is unavailable. Please try again."):setChatError(err.error||"Case Chat response was invalid. Please try again later.")}}var _reply_response_i18n_language,_ref,_ref1;!controller.signal.aborted&&reply&&(reply.noop?setMessages(list):setMessages([...list,{id:crypto.randomUUID(),role:"assistant",content:null!==(_ref1=null!==(_ref=null!==(_reply_response_i18n_language=reply.response[i18n.language])&&void 0!==_reply_response_i18n_language?_reply_response_i18n_language:reply.response.en)&&void 0!==_ref?_ref:Object.values(reply.response)[0])&&void 0!==_ref1?_ref1:"",lang:reply.lang,actions:reply.actions,translations:reply.response}]))}catch(e){controller.signal.aborted||setChatError("Case Chat server is unreachable. Please try again later.")}controller.signal.aborted||setLoading(!1)}(list)},scrollToBottom:function scrollToBottom(){scrollRef.current&&(scrollRef.current.scrollTop=scrollRef.current.scrollHeight,setShowJump(!1))},renderActions:function renderActions(actions,msgId){const buttons=actions.map((a,idx)=>{if("id"in a){const act=caseActions.find(c=>c.id===a.id);if(act)return(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{"compose"===act.id?openDraft(msgId):"take-photo"===act.id?function openCamera(anchorId){setCameraAnchorId(null!=anchorId?anchorId:null),setCameraOpen(!0)}(msgId):router.push(act.href(caseId))},className:"bg-blue-600 text-white px-2 py-1 rounded mx-1",children:act.label},`${a.id}-${idx}`)}else{if("field"in a&&"value"in a){var _labelMap_a_field;const label=null!==(_labelMap_a_field={vin:`Set VIN to "${a.value}"`,plate:`Set Plate to "${a.value}"`,state:`Set State to "${a.value}"`,note:`Add Note: "${a.value}"`}[a.field])&&void 0!==_labelMap_a_field?_labelMap_a_field:`Apply ${a.field}`;return(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{(async function handleEdit(field,value){switch(field){case"vin":await(0,apiClient.n)(`/api/cases/${caseId}/vin`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vin:value})}),router.refresh();break;case"plate":await(0,apiClient.n)(`/api/cases/${caseId}/override`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle:{licensePlateNumber:value}})}),router.refresh();break;case"state":await(0,apiClient.n)(`/api/cases/${caseId}/override`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle:{licensePlateState:value}})}),router.refresh();break;case"note":{const res=await(0,apiClient.n)(`/api/cases/${caseId}`),data=res.ok?await res.json():{note:null},note=data.note?`${data.note}\n${value}`:value;await(0,apiClient.n)(`/api/cases/${caseId}/note`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({note})}),router.refresh()}}})(a.field,a.value)},className:"bg-green-700 text-white px-2 py-1 rounded mx-1",children:label},`edit-${a.field}-${a.value}`)}if("photo"in a&&"note"in a){const url=photoMap[a.photo];if(url)return(0,jsx_runtime.jsxs)("button",{type:"button",onClick:()=>{(async function handlePhotoNote(name,value){var _data_photoNotes;const url=photoMap[name];if(!url)return;const res=await(0,apiClient.n)(`/api/cases/${caseId}`);var _data_photoNotes_url;const current=null!==(_data_photoNotes_url=null===(_data_photoNotes=(res.ok?await res.json():{photoNotes:void 0}).photoNotes)||void 0===_data_photoNotes?void 0:_data_photoNotes[url])&&void 0!==_data_photoNotes_url?_data_photoNotes_url:null,note=current?`${current}\n${value}`:value;await(0,apiClient.n)(`/api/cases/${caseId}/photo-note`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({photo:url,note})}),router.refresh()})(a.photo,a.note)},className:"bg-green-700 text-white px-1 py-1 rounded mx-1 flex items-center gap-1",children:[(0,jsx_runtime.jsx)(thumbnail_image.A,{src:(0,clientThumbnails.s)(url,64),alt:a.photo,width:32,height:24}),(0,jsx_runtime.jsx)("span",{children:`Add "${a.note}"`})]},`photo-${a.photo}-${a.note}`)}}return null});return(0,jsx_runtime.jsx)("div",{className:"mt-1 flex flex-wrap gap-1",children:buttons})},renderContent:function renderContent(m){var _m_translations;const{text,needsTranslation}=(0,localizedText.P)({[m.lang]:m.content,...null!==(_m_translations=m.translations)&&void 0!==_m_translations?_m_translations:{}},i18n.language);return(0,jsx_runtime.jsxs)("span",{children:[text,needsTranslation?(0,jsx_runtime.jsx)(InlineTranslateButton.A,{lang:i18n.language,onTranslate:()=>async function handleTranslate(msg){const tr=await chatTranslate(msg.content,i18n.language);setMessages(list=>list.map(m=>{var _m_translations;return m.id===msg.id?{...m,translations:{...null!==(_m_translations=m.translations)&&void 0!==_m_translations?_m_translations:{},[i18n.language]:tr}}:m}))}(m)}):null]})},setInput,openDraft,draftAnchorId,setDraftAnchorId,draftData,setDraftData,cameraAnchorId,setCameraAnchorId,setCameraOpen,selectSession:function selectSession(val){if(saveCurrentSession(),"new"===val)startNew();else{const found=history.find(h=>h.id===val);found&&(setMessages(found.messages),setSessionId(found.id),setSessionCreatedAt(found.createdAt),setSessionSummary(found.summary))}}},children})}CaseChatProvider.__docgenInfo={description:"",methods:[],displayName:"CaseChatProvider",props:{caseId:{required:!0,tsType:{name:"string"},description:""},onChat:{required:!1,tsType:{name:"signature",type:"function",raw:"(\n  messages: Message[],\n) => Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>",signature:{arguments:[{type:{name:"Array",elements:[{name:"Message"}],raw:"Message[]"},name:"messages"}],return:{name:"Promise",elements:[{name:"union",raw:"CaseChatReply | { reply: string; system?: string } | ChatResponse | string",elements:[{name:"CaseChatReply"},{name:"signature",type:"object",raw:"{ reply: string; system?: string }",signature:{properties:[{key:"reply",value:{name:"string",required:!0}},{key:"system",value:{name:"string",required:!1}}]}},{name:"ChatResponse"},{name:"string"}]}],raw:"Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>"}}},description:""},expanded:{required:!1,tsType:{name:"boolean"},description:""},onExpandChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"value"}],return:{name:"void"}}},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};var index_esm=__webpack_require__("__barrel_optimize__?names=FaBars,FaUserCircle!=!./node_modules/react-icons/fa/index.esm.js");function ChatHeader(){const{expanded,toggleExpanded,handleClose,history,sessionId,sessionCreatedAt,sessionSummary,selectSession}=useCaseChat(),{t}=(0,es.Bd)();return(0,jsx_runtime.jsxs)("div",{className:"flex items-center border-b p-2 gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold flex-none",children:t("caseChat")}),(0,jsx_runtime.jsxs)("select",{"aria-label":t("chatHistory"),value:null!=sessionId?sessionId:"",onChange:e=>selectSession(e.target.value),className:"text-black dark:text-black text-xs flex-auto min-w-0 truncate",children:[(0,jsx_runtime.jsx)("option",{value:"new",children:t("newChat")}),!history.some(h=>h.id===sessionId)&&sessionId&&(0,jsx_runtime.jsxs)("option",{value:sessionId,children:[new Date(sessionCreatedAt).toLocaleString(),sessionSummary?` - ${sessionSummary}`:""]}),history.map(h=>(0,jsx_runtime.jsxs)("option",{value:h.id,children:[new Date(h.createdAt).toLocaleString()," - ",h.summary]},h.id))]}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:toggleExpanded,"aria-label":t(expanded?"collapseChat":"expandChat"),className:"text-xl leading-none flex-none hidden sm:block",children:expanded?(0,jsx_runtime.jsx)(index_esm.f93,{}):(0,jsx_runtime.jsx)(index_esm.xKl,{})}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:handleClose,"aria-label":t("closeChat"),className:"text-xl leading-none flex-none",children:"×"})]})}function ChatInput(){const{input,setInput,send,loading,showJump,scrollToBottom,inputRef}=useCaseChat(),{t}=(0,es.Bd)();return(0,jsx_runtime.jsxs)("div",{className:"border-t p-2 flex flex-col gap-2",style:{paddingBottom:"calc(env(safe-area-inset-bottom,0) + 0.5rem)"},children:[showJump?(0,jsx_runtime.jsx)("button",{type:"button",onClick:scrollToBottom,className:"self-start text-blue-600 underline text-xs",children:t("jumpToLatest")}):null,(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)("input",{ref:inputRef,type:"text",value:input,onChange:e=>setInput(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),send())},className:"flex-1 border rounded px-1 dark:bg-gray-800 text-base",placeholder:t("askQuestion")}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:send,disabled:loading,className:"bg-blue-600 text-white px-2 rounded disabled:opacity-50",children:t("send")})]})]})}ChatHeader.__docgenInfo={description:"",methods:[],displayName:"ChatHeader"},ChatInput.__docgenInfo={description:"",methods:[],displayName:"ChatInput"};var DebugWrapper=__webpack_require__("./src/app/components/DebugWrapper.tsx"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),CaseChat_module=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!./node_modules/postcss-loader/dist/cjs.js!./src/app/cases/[id]/CaseChat.module.css"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(CaseChat_module.A,options);const _id_CaseChat_module=CaseChat_module.A&&CaseChat_module.A.locals?CaseChat_module.A.locals:void 0;var useAddFilesToCase=__webpack_require__("./src/app/useAddFilesToCase.ts");function ChatWidget({children,className=""}){return(0,jsx_runtime.jsx)("div",{className:`bg-blue-600 text-white px-2 py-1 rounded mx-1 text-xs space-y-1 ${className}`,children})}function WidgetActions({children,centered=!1,wrap=!1}){const classes=["flex","gap-1"];return centered&&classes.push("justify-center"),wrap&&classes.push("flex-wrap"),(0,jsx_runtime.jsx)("div",{className:classes.join(" "),children})}function TakePhotoWidget({caseId,onClose}){const videoRef=(0,react.useRef)(null),canvasRef=(0,react.useRef)(null),uploadCase=(0,useAddFilesToCase.A)(caseId),[error,setError]=(0,react.useState)(null),[uploading,setUploading]=(0,react.useState)(!1),[gps,setGps]=(0,react.useState)(null),{t}=(0,es.Bd)();return(0,react.useEffect)(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(pos=>{setGps({lat:pos.coords.latitude,lon:pos.coords.longitude})});let stream=null;return async function startCamera(){var _navigator_mediaDevices;if(null===(_navigator_mediaDevices=navigator.mediaDevices)||void 0===_navigator_mediaDevices?void 0:_navigator_mediaDevices.getUserMedia)try{stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});const v=videoRef.current;v&&(v.srcObject=stream,v.setAttribute("autoplay",""),v.setAttribute("muted",""),v.setAttribute("playsinline",""),v.onloadedmetadata=()=>{v.play().catch(()=>{})})}catch(e){setError(t("cameraAccessError"))}else setError(t("cameraApiUnavailable"))}(),()=>{if(stream)for(const t of stream.getTracks())t.stop()}},[t]),(0,jsx_runtime.jsxs)(ChatWidget,{className:"w-48",children:[(0,jsx_runtime.jsx)("video",{ref:videoRef,className:"w-full h-32 bg-black rounded",children:(0,jsx_runtime.jsx)("track",{kind:"captions",label:""})}),(0,jsx_runtime.jsx)("canvas",{ref:canvasRef,className:"hidden"}),error&&(0,jsx_runtime.jsx)("div",{className:"text-red-200 text-center",children:error}),(0,jsx_runtime.jsxs)(WidgetActions,{centered:!0,children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:async function takePicture(){const video=videoRef.current,canvas=canvasRef.current;if(!video||!canvas)return;canvas.width=video.videoWidth,canvas.height=video.videoHeight;const ctx=canvas.getContext("2d");ctx&&(ctx.drawImage(video,0,0,canvas.width,canvas.height),canvas.toBlob(async blob=>{if(!blob)return;const file=new File([blob],"photo.jpg",{type:"image/jpeg"}),dt=new DataTransfer;dt.items.add(file),setUploading(!0),await uploadCase(dt.files,gps),setUploading(!1),onClose()},"image/jpeg"))},disabled:uploading,className:"bg-blue-800 text-white px-1 rounded disabled:opacity-50",children:t(uploading?"uploading":"takePicture")}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:onClose,className:"bg-gray-200 text-black px-1 rounded",children:t("close")})]})]})}ChatWidget.__docgenInfo={description:"",methods:[],displayName:"ChatWidget",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}}}},WidgetActions.__docgenInfo={description:"",methods:[],displayName:"WidgetActions",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},centered:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},wrap:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}},TakePhotoWidget.__docgenInfo={description:"",methods:[],displayName:"TakePhotoWidget",props:{caseId:{required:!0,tsType:{name:"string"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};var tooltip=__webpack_require__("./src/components/ui/tooltip.tsx"),next_link=__webpack_require__("./node_modules/next/link.js"),link_default=__webpack_require__.n(next_link);function DraftPreview({caseId,data,onClose}){const router=(0,navigation.useRouter)(),notify=(0,NotificationProvider.l)(),[sending,setSending]=(0,react.useState)(!1),{i18n,t}=(0,es.Bd)();const subjectText=(0,localizedText.P)(data.email.subject,i18n.language).text,{text:bodyText}=(0,localizedText.P)(data.email.body,i18n.language);async function send(){setSending(!0);const res=await(0,apiClient.n)(`/api/cases/${caseId}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:subjectText,body:bodyText,attachments:data.attachments})});if(res.ok)notify(t("emailSent")),onClose();else{const err=await res.json().catch(()=>({}));notify(err.error||t("failedToSendEmail"))}setSending(!1)}const previewBody=bodyText.length>80?`${bodyText.slice(0,77)}...`:bodyText,tooltipContent=(0,jsx_runtime.jsxs)("div",{className:"bg-white text-black p-2 rounded shadow max-w-sm space-y-2",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold text-sm",children:subjectText}),(0,jsx_runtime.jsx)("pre",{className:"whitespace-pre-wrap text-xs",children:bodyText}),data.attachments.length>0&&(0,jsx_runtime.jsx)("div",{className:"flex gap-1 flex-wrap",children:data.attachments.map(p=>(0,jsx_runtime.jsx)(thumbnail_image.A,{src:(0,clientThumbnails.s)(p,128),alt:"attachment",width:96,height:72,imgClassName:"object-contain"},p))}),(0,jsx_runtime.jsxs)(WidgetActions,{wrap:!0,children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:send,disabled:sending,className:"bg-blue-800 text-white px-1 rounded text-xs disabled:opacity-50",children:t(sending?"sending":"send")}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:onClose,className:"bg-gray-200 text-black px-1 rounded text-xs",children:t("close")}),(0,jsx_runtime.jsx)(link_default(),{href:`/cases/${caseId}/compose`,className:"bg-blue-600 text-white px-1 rounded text-xs",children:t("fullEditor")})]})]});return(0,jsx_runtime.jsxs)(ChatWidget,{children:[(0,jsx_runtime.jsx)(tooltip.A,{label:tooltipContent,interactive:!0,children:(0,jsx_runtime.jsxs)("button",{type:"button",onClick:function openCompose(){const url=`/cases/${caseId}/compose`;if(router.push(url),"undefined"!=typeof history){var _history_state;const st=null!==(_history_state=history.state)&&void 0!==_history_state?_history_state:{};history.replaceState({...st,draftData:data},"",url)}},className:"text-left w-full",children:[(0,jsx_runtime.jsx)("strong",{children:subjectText})," ",previewBody]})}),(0,jsx_runtime.jsxs)(WidgetActions,{children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:send,disabled:sending,className:"bg-blue-800 text-white px-1 rounded disabled:opacity-50",children:t(sending?"sending":"send")}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:onClose,className:"bg-gray-200 text-black px-1 rounded",children:t("close")})]})]})}function ChatMessages({caseId}){const{messages,loading,draftLoading,draftData,cameraOpen,chatError,renderActions,renderContent,scrollRef,setDraftData,setCameraOpen,draftAnchorId,setDraftAnchorId,cameraAnchorId,setCameraAnchorId,systemPrompt,availableActions,unavailableActions}=useCaseChat(),{t}=(0,es.Bd)();return(0,jsx_runtime.jsx)(DebugWrapper.A,{data:{system:systemPrompt,available:availableActions,unavailable:unavailableActions},className:"flex flex-col flex-1 min-h-0",children:(0,jsx_runtime.jsxs)("div",{ref:scrollRef,className:"flex-1 overflow-y-auto p-2 space-y-2",children:[messages.map(m=>(0,jsx_runtime.jsxs)("div",{className:"user"===m.role?"flex flex-col items-end":"flex flex-col items-start",children:[(0,jsx_runtime.jsx)("span",{className:`${_id_CaseChat_module.bubble} ${"user"===m.role?_id_CaseChat_module.user:_id_CaseChat_module.assistant}`,children:renderContent(m)}),"assistant"===m.role&&m.actions&&m.actions.length>0&&renderActions(m.actions,m.id),draftData&&draftAnchorId===m.id&&(0,jsx_runtime.jsx)(DraftPreview,{caseId,data:draftData,onClose:()=>{setDraftData(null),setDraftAnchorId(null)}}),cameraOpen&&cameraAnchorId===m.id&&(0,jsx_runtime.jsx)(TakePhotoWidget,{caseId,onClose:()=>{setCameraOpen(!1),setCameraAnchorId(null)}})]},m.id)),loading&&(0,jsx_runtime.jsx)("div",{className:"text-left",children:(0,jsx_runtime.jsx)("span",{className:`${_id_CaseChat_module.bubble} ${_id_CaseChat_module.assistant} ${_id_CaseChat_module.typing}`})},"typing"),draftLoading&&(0,jsx_runtime.jsx)("div",{className:"text-left",children:(0,jsx_runtime.jsx)("span",{className:"text-sm",children:t("draftingEmail")})},"draft-loading"),chatError&&(0,jsx_runtime.jsx)("div",{className:"text-left",children:(0,jsx_runtime.jsx)("span",{className:`${_id_CaseChat_module.bubble} ${_id_CaseChat_module.error}`,children:chatError})},"chat-error")]})})}function CaseChat(props){const{caseId}=props;return(0,jsx_runtime.jsx)(CaseChatProvider,{...props,children:(0,jsx_runtime.jsx)(CaseChatInner,{caseId})})}function CaseChatInner({caseId}){const{open,expanded,handleOpen}=useCaseChat();return function useVisualViewportHeight(active=!0){(0,react.useEffect)(()=>{var _window_visualViewport;if(!active)return;const setHeight=()=>{const height=window.visualViewport?window.visualViewport.height:window.innerHeight;document.documentElement.style.setProperty("--visual-viewport-height",`${height}px`),window.scrollTo({top:0})};return setHeight(),null===(_window_visualViewport=window.visualViewport)||void 0===_window_visualViewport||_window_visualViewport.addEventListener("resize",setHeight),window.addEventListener("resize",setHeight),()=>{var _window_visualViewport;null===(_window_visualViewport=window.visualViewport)||void 0===_window_visualViewport||_window_visualViewport.removeEventListener("resize",setHeight),window.removeEventListener("resize",setHeight)}},[active])}(open),(0,jsx_runtime.jsx)("div",{className:(expanded?"relative h-full":open?"fixed inset-0 sm:bottom-4 sm:right-4 sm:inset-auto z-chat sm:[--case-chat-offset:1rem]":"fixed bottom-4 right-4 z-chat")+" text-sm",children:open?(0,jsx_runtime.jsxs)("div",{className:"bg-white dark:bg-gray-900 shadow-lg rounded flex flex-col "+(expanded?"w-full h-full":"w-screen sm:w-80 sm:max-h-[400px]"),style:expanded?void 0:{height:"calc(var(--visual-viewport-height) - var(--case-chat-offset,0px))",marginTop:"var(--case-chat-offset,0px)"},children:[(0,jsx_runtime.jsx)(ChatHeader,{}),(0,jsx_runtime.jsx)(ChatMessages,{caseId}),(0,jsx_runtime.jsx)(ChatInput,{})]}):(0,jsx_runtime.jsx)("button",{type:"button",onClick:handleOpen,className:"bg-blue-600 text-white px-3 py-1 rounded shadow",children:"Chat"})})}DraftPreview.__docgenInfo={description:"",methods:[],displayName:"DraftPreview",props:{caseId:{required:!0,tsType:{name:"string"},description:""},data:{required:!0,tsType:{name:"DraftData"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}},ChatMessages.__docgenInfo={description:"",methods:[],displayName:"ChatMessages",props:{caseId:{required:!0,tsType:{name:"string"},description:""}}},CaseChat.__docgenInfo={description:"",methods:[],displayName:"CaseChat",props:{caseId:{required:!0,tsType:{name:"string"},description:""},onChat:{required:!1,tsType:{name:"signature",type:"function",raw:"(\n  messages: Message[],\n) => Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>",signature:{arguments:[{type:{name:"Array",elements:[{name:"Message"}],raw:"Message[]"},name:"messages"}],return:{name:"Promise",elements:[{name:"union",raw:"CaseChatReply | { reply: string; system?: string } | ChatResponse | string",elements:[{name:"CaseChatReply"},{name:"signature",type:"object",raw:"{ reply: string; system?: string }",signature:{properties:[{key:"reply",value:{name:"string",required:!0}},{key:"system",value:{name:"string",required:!1}}]}},{name:"ChatResponse"},{name:"string"}]}],raw:"Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>"}}},description:""},expanded:{required:!1,tsType:{name:"boolean"},description:""},onExpandChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"value"}],return:{name:"void"}}},description:""}}}},"./src/app/components/DebugWrapper.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>DebugWrapper});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");var tooltip=__webpack_require__("./src/components/ui/tooltip.tsx"),publicEnv=__webpack_require__("./src/publicEnv.ts");function DebugWrapper({data,children,availableActions,unavailableActions,className}){const{NEXT_PUBLIC_BROWSER_DEBUG}=(0,publicEnv.j)(),enabled=Boolean(NEXT_PUBLIC_BROWSER_DEBUG),alt=function useAltKey(){const[pressed,setPressed]=(0,react.useState)(!1);return(0,react.useEffect)(()=>{const down=e=>{e.altKey&&setPressed(!0)},up=()=>setPressed(!1);return window.addEventListener("keydown",down),window.addEventListener("keyup",up),window.addEventListener("blur",up),()=>{window.removeEventListener("keydown",down),window.removeEventListener("keyup",up),window.removeEventListener("blur",up)}},[]),pressed}(),[refHover,setRefHover]=(0,react.useState)(!1),[open,setOpen]=(0,react.useState)(!1);(0,react.useEffect)(()=>{alt&&refHover&&setOpen(!0)},[alt,refHover]);const json=JSON.stringify(data,null,2),tokens=function tokenize(json){const tokens=[];let last=0;return json.replace(/(\"(?:\\u[a-fA-F0-9]{4}|\\[^u]|[^\\\"])*\"(?:\s*:)?|\b(?:true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(match,_p1,offset)=>{last<offset&&tokens.push(json.slice(last,offset));let cls="json-number";return/^\"/.test(match)?cls=/:$/.test(match)?"json-key":"json-string":/true|false/.test(match)?cls="json-boolean":/null/.test(match)&&(cls="json-null"),tokens.push((0,jsx_runtime.jsx)("span",{className:cls,children:match},tokens.length)),last=offset+match.length,""}),last<json.length&&tokens.push(json.slice(last)),tokens}(json);if(!enabled)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children});const show=alt&&refHover||open;return(0,jsx_runtime.jsx)(tooltip.A,{label:(0,jsx_runtime.jsxs)("div",{className:"text-xs bg-black/80 text-white p-2 rounded shadow max-w-sm max-h-60 overflow-auto relative space-y-1",children:[((null==availableActions?void 0:availableActions.length)||(null==unavailableActions?void 0:unavailableActions.length))&&(0,jsx_runtime.jsxs)("div",{className:"mb-1 space-y-1",children:[(null==availableActions?void 0:availableActions.length)?(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Available:"})," ",availableActions.join(", ")]}):null,(null==unavailableActions?void 0:unavailableActions.length)?(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Unavailable:"})," ",unavailableActions.join(", ")]}):null,(0,jsx_runtime.jsx)("hr",{})]}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>navigator.clipboard.writeText(json),className:"absolute top-1 right-1 underline",children:"Copy"}),(0,jsx_runtime.jsx)("pre",{className:"pt-4 whitespace-pre-wrap break-words",children:tokens})]}),open:show,onOpenChange:setOpen,interactive:!0,closeDelay:200,children:(0,jsx_runtime.jsx)("div",{onMouseEnter:()=>{setRefHover(!0),alt&&setOpen(!0)},onMouseLeave:()=>{setRefHover(!1)},className:null!=className?className:"inline-block",children})})}DebugWrapper.__docgenInfo={description:"",methods:[],displayName:"DebugWrapper",props:{data:{required:!0,tsType:{name:"unknown"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""},availableActions:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},unavailableActions:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}}},"./src/app/components/InlineTranslateButton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>InlineTranslateButton});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),index_esm=__webpack_require__("__barrel_optimize__?names=FaBars,FaUserCircle!=!./node_modules/react-icons/fa/index.esm.js");const FLAGS={en:"🇺🇸",es:"🇪🇸",fr:"🇫🇷"};function TranslateIcon({lang,loading=!1,error=!1}){const flag=(0,react.useMemo)(()=>{var _FLAGS_lang;return null!==(_FLAGS_lang=FLAGS[lang])&&void 0!==_FLAGS_lang?_FLAGS_lang:"🏳️"},[lang]),ArrowIcon=error?index_esm.KP4:index_esm.Z0P;return(0,jsx_runtime.jsxs)("span",{className:"inline-flex items-center text-xs relative",children:[(0,jsx_runtime.jsx)(ArrowIcon,{className:"mr-0.5 "+(loading?"animate-translate-arrow":"")}),(0,jsx_runtime.jsxs)("span",{"aria-label":lang,className:"relative "+(loading?"animate-translate-flag":""),children:[flag,error?(0,jsx_runtime.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-red-600",children:"✖"}):null]})]})}function InlineTranslateButton({lang,onTranslate}){const[state,setState]=(0,react.useState)("idle");return(0,jsx_runtime.jsx)("button",{type:"button",onClick:async function handleClick(){if("loading"!==state){setState("loading");try{await Promise.resolve(onTranslate()),setState("idle")}catch(e){setState("error")}}},"aria-label":"translate",className:"ml-2 text-blue-500 hover:text-blue-700",children:(0,jsx_runtime.jsx)(TranslateIcon,{lang,loading:"loading"===state,error:"error"===state})})}TranslateIcon.__docgenInfo={description:"",methods:[],displayName:"TranslateIcon",props:{lang:{required:!0,tsType:{name:"string"},description:""},loading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},error:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}},InlineTranslateButton.__docgenInfo={description:"",methods:[],displayName:"InlineTranslateButton",props:{lang:{required:!0,tsType:{name:"string"},description:""},onTranslate:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void> | void",signature:{arguments:[],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""}}}},"./src/app/useAddFilesToCase.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useAddFilesToCase});var _apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/apiClient.ts"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useMutation.js"),next_navigation__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),react_i18next__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/app/components/NotificationProvider.tsx");function useAddFilesToCase(caseId){const router=(0,next_navigation__WEBPACK_IMPORTED_MODULE_1__.useRouter)(),notify=(0,_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_3__.l)(),{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_2__.Bd)(),uploadMutation=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_4__.n)({mutationFn:async formData=>(0,_apiClient__WEBPACK_IMPORTED_MODULE_0__.n)("/api/upload",{method:"POST",body:formData})});return async(files,gps)=>{if(!files||0===files.length)return;(await Promise.all(Array.from(files).map(file=>{const formData=new FormData;return formData.append("photo",file),formData.append("caseId",caseId),gps&&(formData.append("lat",String(gps.lat)),formData.append("lon",String(gps.lon))),uploadMutation.mutateAsync(formData)}))).some(r=>!r.ok)?notify(t("failedUpload")):router.push(`/cases/${caseId}`)}}},"./src/components/thumbnail-image.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>ThumbnailImage});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function ThumbnailImage({src,alt,width,height,className,imgClassName,...props}){const[ready,setReady]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[attempt,setAttempt]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(0);return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(ready)return;const timer=setInterval(()=>setAttempt(a=>a+1),2e3);return()=>clearInterval(timer)},[ready]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{style:{width,height},className:`relative overflow-hidden ${null!=className?className:""}`,children:[!ready&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-200 dark:bg-gray-800",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"w-6 h-6 border-2 border-gray-500 border-t-transparent rounded-full animate-spin"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("img",{src:`${src}${attempt?`?${attempt}`:""}`,alt:null!=alt?alt:"",width,height,onLoad:()=>setReady(!0),onError:()=>setReady(!1),className:`object-cover max-w-full max-h-full ${null!=imgClassName?imgClassName:""} ${ready?"":"invisible"}`,loading:"lazy",...props})]})}ThumbnailImage.__docgenInfo={description:"",methods:[],displayName:"ThumbnailImage",props:{src:{required:!0,tsType:{name:"string"},description:""},alt:{required:!0,tsType:{name:"string"},description:""},width:{required:!0,tsType:{name:"number"},description:""},height:{required:!0,tsType:{name:"number"},description:""},imgClassName:{required:!1,tsType:{name:"string"},description:""}},composes:["Omit"]}},"./src/components/ui/tooltip.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>Tooltip});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@floating-ui/react/dist/floating-ui.react.mjs"),_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@floating-ui/react-dom/dist/floating-ui.react-dom.mjs"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function Tooltip({label,children,placement="top",open:controlledOpen,onOpenChange,interactive=!1,closeDelay=0}){const[uncontrolledOpen,setUncontrolledOpen]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),open=null!=controlledOpen?controlledOpen:uncontrolledOpen,setOpen=null!=onOpenChange?onOpenChange:setUncontrolledOpen,{refs,floatingStyles,context}=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.we)({open,onOpenChange:setOpen,middleware:[(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.cY)(5),(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.UU)(),(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.BN)({padding:5})],placement}),hover=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.Mk)(context,{enabled:void 0===controlledOpen,move:!1,handleClose:interactive?(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.iB)():void 0,delay:{close:closeDelay}}),focus=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.iQ)(context,{enabled:void 0===controlledOpen}),dismiss=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.s9)(context),role=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.It)(context,{role:"tooltip"}),{getReferenceProps,getFloatingProps}=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.bv)([hover,focus,dismiss,role]),referenceProps=getReferenceProps({ref:refs.setReference});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[(0,react__WEBPACK_IMPORTED_MODULE_1__.cloneElement)(children,referenceProps),open&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.XF,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{ref:refs.setFloating,style:floatingStyles,...getFloatingProps(),className:"z-tooltip rounded bg-black/80 px-2 py-1 text-xs text-white shadow",children:label})})]})}Tooltip.__docgenInfo={description:"",methods:[],displayName:"Tooltip",props:{label:{required:!0,tsType:{name:"union",raw:"ReactElement | string",elements:[{name:"ReactElement"},{name:"string"}]},description:""},children:{required:!0,tsType:{name:"ReactElement"},description:""},placement:{required:!1,tsType:{name:"Placement"},description:"",defaultValue:{value:'"top"',computed:!1}},open:{required:!1,tsType:{name:"boolean"},description:""},onOpenChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(open: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"open"}],return:{name:"void"}}},description:""},interactive:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},closeDelay:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0",computed:!1}}}}},"./src/lib/caseUtils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Pk:()=>getAnalysisSummary,_g:()=>getBestViolationPhoto,g_:()=>getCaseOwnerContact,sC:()=>getCaseOwnerContactInfo,qy:()=>getCasePlateNumber,W7:()=>getCasePlateState,E5:()=>getCaseVin,qR:()=>getOfficialCaseGps,wq:()=>getRepresentativePhoto,u5:()=>hasCaseViolation});var i18next=__webpack_require__("./node_modules/i18next/dist/esm/i18next.js");__webpack_require__("./public/locales/en/common.json"),__webpack_require__("./public/locales/es/common.json"),__webpack_require__("./public/locales/fr/common.json");const instance=i18next.Ay.createInstance();const i18n_server=instance;function basename(filePath){const parts=filePath.split(/[\\/]/);return parts[parts.length-1]}function getRepresentativePhoto(caseData){var _caseData_analysis;if(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images){const best=Object.entries(caseData.analysis.images).sort((a,b)=>b[1].representationScore-a[1].representationScore)[0];if(best){const name=best[0],file=caseData.photos.find(p=>basename(p)===name);if(file)return file}}const sorted=[...caseData.photos].sort();return sorted.length>0?sorted[0]:null}function getOfficialCaseGps(caseData){var _caseData_analysis,_caseData_gps;if((null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)&&caseData.photoGps){const entries=Object.entries(caseData.analysis.images).sort((a,b)=>b[1].representationScore-a[1].representationScore);for(const[name]of entries){const file=caseData.photos.find(p=>basename(p)===name);if(file){const gps=caseData.photoGps[file];if(gps)return gps}}}if(caseData.photoGps)for(const p of caseData.photos){const g=caseData.photoGps[p];if(g)return g}return null!==(_caseData_gps=caseData.gps)&&void 0!==_caseData_gps?_caseData_gps:null}function hasCaseViolation(c){return!!c.violationOverride||function hasViolation(report){var _report_violationType;if(!report)return!1;if(report.images){const all=Object.values(report.images),hasTrue=all.some(i=>!0===i.violation),hasFalse=all.some(i=>!1===i.violation);if(hasTrue||hasFalse)return hasTrue}return Boolean(null===(_report_violationType=report.violationType)||void 0===_report_violationType?void 0:_report_violationType.trim())}(c.analysis)}function getCaseVin(caseData){var _caseData_analysis;if(caseData.vin)return caseData.vin;const imgs=(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const vin=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.vin;if(vin)return vin}return null}function getCasePlateNumber(caseData){var _caseData_analysis_vehicle,_caseData_analysis,_caseData_analysis1;const direct=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis||null===(_caseData_analysis_vehicle=_caseData_analysis.vehicle)||void 0===_caseData_analysis_vehicle?void 0:_caseData_analysis_vehicle.licensePlateNumber;if(direct)return direct;const imgs=(null===(_caseData_analysis1=caseData.analysis)||void 0===_caseData_analysis1?void 0:_caseData_analysis1.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const plate=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.licensePlateNumber;if(plate)return plate}return null}function getCasePlateState(caseData){var _caseData_analysis_vehicle,_caseData_analysis,_caseData_analysis1;const direct=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis||null===(_caseData_analysis_vehicle=_caseData_analysis.vehicle)||void 0===_caseData_analysis_vehicle?void 0:_caseData_analysis_vehicle.licensePlateState;if(direct)return direct;const imgs=(null===(_caseData_analysis1=caseData.analysis)||void 0===_caseData_analysis1?void 0:_caseData_analysis1.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const state=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.licensePlateState;if(state)return state}return null}function getCaseOwnerContact(caseData){var _caseData_analysis;const imgs=(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo;const contact=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo?void 0:_info_paperworkInfo.contact;if(contact)return contact}return null}function getCaseOwnerContactInfo(caseData){const contact=getCaseOwnerContact(caseData);return contact?function parseContactInfo(text){const emailMatch=text.match(/[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}/),phoneMatch=text.match(/\+?\d[\d\s().-]{7,}\d/);let address;return text.trim().split(/\n+/).length>1&&(address=text.trim()),{email:emailMatch?emailMatch[0]:void 0,phone:phoneMatch?phoneMatch[0]:void 0,address}}(contact):null}function getBestViolationPhoto(caseData){var _caseData_analysis,_info_highlights,_info_highlights1,_caseData_analysis_images;const imgs=null!==(_caseData_analysis_images=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)&&void 0!==_caseData_analysis_images?_caseData_analysis_images:{},entries=Object.entries(imgs).filter(([,info])=>info.violation).sort((a,b)=>b[1].representationScore-a[1].representationScore),best=entries[0];if(!best)return null;const[name,info]=best,file=caseData.photos.find(p=>basename(p)===name);if(!file)return null;var _info_highlights_i18n_language,_info_highlights2,_ref;return{photo:file,caption:"string"==typeof info.highlights?info.highlights:null!==(_ref=null!==(_info_highlights_i18n_language=null===(_info_highlights=info.highlights)||void 0===_info_highlights?void 0:_info_highlights[i18n_server.language])&&void 0!==_info_highlights_i18n_language?_info_highlights_i18n_language:null===(_info_highlights1=info.highlights)||void 0===_info_highlights1?void 0:_info_highlights1.en)&&void 0!==_ref?_ref:Object.values(null!==(_info_highlights2=info.highlights)&&void 0!==_info_highlights2?_info_highlights2:{})[0]}}function getAnalysisSummary(report){var _report_vehicle,_report_vehicle1,_report_details_i18n_language,_ref,_ref1;const detailText="string"==typeof report.details?report.details:null!==(_ref1=null!==(_ref=null!==(_report_details_i18n_language=report.details[i18n_server.language])&&void 0!==_report_details_i18n_language?_report_details_i18n_language:report.details.en)&&void 0!==_ref?_ref:Object.values(report.details)[0])&&void 0!==_ref1?_ref1:"",parts=[`Violation: ${report.violationType}`,detailText];report.location&&parts.push(`Location: ${report.location}`);const plate=[];return(null===(_report_vehicle=report.vehicle)||void 0===_report_vehicle?void 0:_report_vehicle.licensePlateState)&&plate.push(report.vehicle.licensePlateState),(null===(_report_vehicle1=report.vehicle)||void 0===_report_vehicle1?void 0:_report_vehicle1.licensePlateNumber)&&plate.push(report.vehicle.licensePlateNumber),plate.length>0&&parts.push(`Plate: ${plate.join(" ")}`),parts.filter(Boolean).join("\n")}},"./src/lib/clientThumbnails.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function getThumbnailUrl(url,size){const base=url.substring(url.lastIndexOf("/")+1);return base.toLowerCase().endsWith(".pdf")?`/uploads/thumbs/${size}/${base.replace(/\.pdf$/i,".jpg")}`:`/uploads/thumbs/${size}/${base}`}__webpack_require__.d(__webpack_exports__,{s:()=>getThumbnailUrl})},"./src/lib/localizedText.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function getLocalizedText(textMap,lang){if(!textMap)return{text:"",needsTranslation:!1};if("string"==typeof textMap)return{text:textMap,needsTranslation:!1};var _textMap_lang,_ref,_ref1;return{text:null!==(_ref1=null!==(_ref=null!==(_textMap_lang=textMap[lang])&&void 0!==_textMap_lang?_textMap_lang:textMap.en)&&void 0!==_ref?_ref:Object.values(textMap)[0])&&void 0!==_ref1?_ref1:"",needsTranslation:!(lang in textMap)}}__webpack_require__.d(__webpack_exports__,{P:()=>getLocalizedText})},"./src/lib/reportModules.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{u:()=>reportModules});const reportModules={"oak-park":{id:"oak-park",authorityName:"Oak Park Police Department",authorityEmail:"police@oak-park.us",authorityAddress:"123 Madison St\nOak Park, IL 60302"}}}}]);