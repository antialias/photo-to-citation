"use strict";(self.webpackChunkapp_scaffold=self.webpackChunkapp_scaffold||[]).push([[4287],{"./node_modules/.pnpm/css-loader@6.11.0_webpack@4.41.2/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!./node_modules/.pnpm/postcss-loader@8.1.1_postcss@8.5.6_typescript@5.8.3_webpack@4.41.2/node_modules/postcss-loader/dist/cjs.js!./src/app/cases/[id]/CaseChat.module.css":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_pnpm_css_loader_6_11_0_webpack_4_41_2_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/css-loader@6.11.0_webpack@4.41.2/node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_pnpm_css_loader_6_11_0_webpack_4_41_2_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_pnpm_css_loader_6_11_0_webpack_4_41_2_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_pnpm_css_loader_6_11_0_webpack_4_41_2_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/css-loader@6.11.0_webpack@4.41.2/node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_pnpm_css_loader_6_11_0_webpack_4_41_2_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_pnpm_css_loader_6_11_0_webpack_4_41_2_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,'.CaseChat_bubble__CZgum {\n  position: relative;\n  display: inline-block;\n  max-width: 100%;\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n}\n\n.CaseChat_user__ux9N4 {\n  background-color: rgb(37, 99, 235); /* blue-600 */\n  color: white;\n}\n.CaseChat_user__ux9N4::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  right: -0.25rem;\n  border-width: 0.4rem 0 0.4rem 0.4rem;\n  border-style: solid;\n  border-color: transparent transparent transparent rgb(37, 99, 235);\n}\n\n@media (prefers-color-scheme: dark) {\n  .CaseChat_user__ux9N4 {\n    background-color: rgb(29, 78, 216); /* blue-700 */\n  }\n  .CaseChat_user__ux9N4::after {\n    border-left-color: rgb(29, 78, 216);\n  }\n}\n\n.CaseChat_assistant__BSx_p {\n  background-color: rgb(229, 231, 235); /* gray-200 */\n}\n.CaseChat_assistant__BSx_p::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(229, 231, 235) transparent transparent;\n}\n\n.CaseChat_error__nvroa {\n  background-color: rgb(220, 38, 38); /* red-600 */\n  color: white;\n}\n.CaseChat_error__nvroa::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(220, 38, 38) transparent transparent;\n}\n\n@media (prefers-color-scheme: dark) {\n  .CaseChat_assistant__BSx_p {\n    background-color: rgb(55, 65, 81); /* gray-700 */\n    color: white;\n  }\n  .CaseChat_assistant__BSx_p::after {\n    border-right-color: rgb(55, 65, 81);\n  }\n}\n\n@keyframes CaseChat_typing-ellipsis__fDGZx {\n  to {\n    width: 1.2em;\n  }\n}\n\n.CaseChat_typing__0BvNE::after {\n  content: "...";\n  overflow: hidden;\n  display: inline-block;\n  vertical-align: bottom;\n  width: 0;\n  animation: CaseChat_typing-ellipsis__fDGZx 1s steps(4, end) infinite;\n}\n',"",{version:3,sources:["webpack://./src/app/cases/[id]/CaseChat.module.css"],names:[],mappings:"AAAA;EACE,kBAAkB;EAClB,qBAAqB;EACrB,eAAe;EACf,uBAAuB;EACvB,sBAAsB;AACxB;;AAEA;EACE,kCAAkC,EAAE,aAAa;EACjD,YAAY;AACd;AACA;EACE,WAAW;EACX,kBAAkB;EAClB,eAAe;EACf,eAAe;EACf,oCAAoC;EACpC,mBAAmB;EACnB,kEAAkE;AACpE;;AAEA;EACE;IACE,kCAAkC,EAAE,aAAa;EACnD;EACA;IACE,mCAAmC;EACrC;AACF;;AAEA;EACE,oCAAoC,EAAE,aAAa;AACrD;AACA;EACE,WAAW;EACX,kBAAkB;EAClB,eAAe;EACf,cAAc;EACd,oCAAoC;EACpC,mBAAmB;EACnB,oEAAoE;AACtE;;AAEA;EACE,kCAAkC,EAAE,YAAY;EAChD,YAAY;AACd;AACA;EACE,WAAW;EACX,kBAAkB;EAClB,eAAe;EACf,cAAc;EACd,oCAAoC;EACpC,mBAAmB;EACnB,kEAAkE;AACpE;;AAEA;EACE;IACE,iCAAiC,EAAE,aAAa;IAChD,YAAY;EACd;EACA;IACE,mCAAmC;EACrC;AACF;;AAEA;EACE;IACE,YAAY;EACd;AACF;;AAEA;EACE,cAAc;EACd,gBAAgB;EAChB,qBAAqB;EACrB,sBAAsB;EACtB,QAAQ;EACR,oEAAoD;AACtD",sourcesContent:['.bubble {\n  position: relative;\n  display: inline-block;\n  max-width: 100%;\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n}\n\n.user {\n  background-color: rgb(37, 99, 235); /* blue-600 */\n  color: white;\n}\n.user::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  right: -0.25rem;\n  border-width: 0.4rem 0 0.4rem 0.4rem;\n  border-style: solid;\n  border-color: transparent transparent transparent rgb(37, 99, 235);\n}\n\n@media (prefers-color-scheme: dark) {\n  .user {\n    background-color: rgb(29, 78, 216); /* blue-700 */\n  }\n  .user::after {\n    border-left-color: rgb(29, 78, 216);\n  }\n}\n\n.assistant {\n  background-color: rgb(229, 231, 235); /* gray-200 */\n}\n.assistant::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(229, 231, 235) transparent transparent;\n}\n\n.error {\n  background-color: rgb(220, 38, 38); /* red-600 */\n  color: white;\n}\n.error::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(220, 38, 38) transparent transparent;\n}\n\n@media (prefers-color-scheme: dark) {\n  .assistant {\n    background-color: rgb(55, 65, 81); /* gray-700 */\n    color: white;\n  }\n  .assistant::after {\n    border-right-color: rgb(55, 65, 81);\n  }\n}\n\n@keyframes typing-ellipsis {\n  to {\n    width: 1.2em;\n  }\n}\n\n.typing::after {\n  content: "...";\n  overflow: hidden;\n  display: inline-block;\n  vertical-align: bottom;\n  width: 0;\n  animation: typing-ellipsis 1s steps(4, end) infinite;\n}\n'],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={bubble:"CaseChat_bubble__CZgum",user:"CaseChat_user__ux9N4",assistant:"CaseChat_assistant__BSx_p",error:"CaseChat_error__nvroa",typing:"CaseChat_typing__0BvNE","typing-ellipsis":"CaseChat_typing-ellipsis__fDGZx"};const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___},"./src/app/cases/[id]/CaseChat.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>CaseChat});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/jsx-runtime.js"),css=__webpack_require__("./styled-system/css/index.mjs"),tokens=__webpack_require__("./styled-system/tokens/index.mjs"),react=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/index.js");var apiClient=__webpack_require__("./src/apiClient.ts"),thumbnail_image=__webpack_require__("./src/components/thumbnail-image.tsx"),caseActions=__webpack_require__("./src/lib/caseActions.ts"),caseUtils=__webpack_require__("./src/lib/caseUtils.ts"),clientThumbnails=__webpack_require__("./src/lib/clientThumbnails.ts"),localizedText=__webpack_require__("./src/lib/localizedText.ts"),navigation=__webpack_require__("./node_modules/.pnpm/@storybook+nextjs@8.6.14_esbuild@0.25.5_next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@_htn273eqkwxmbpgcwhwcuzbpny/node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),es=__webpack_require__("./node_modules/.pnpm/react-i18next@15.6.0_i18next@25.3.1_typescript@5.8.3__react-dom@19.1.0_react@19.1.0__react@19.1.0_typescript@5.8.3/node_modules/react-i18next/dist/es/index.js"),InlineTranslateButton=__webpack_require__("./src/app/components/InlineTranslateButton.tsx"),NotificationProvider=__webpack_require__("./src/app/components/NotificationProvider.tsx");var CaseContext=__webpack_require__("./src/app/cases/[id]/CaseContext.tsx");const CaseChatContext=(0,react.createContext)(null);function useCaseChat(){const ctx=(0,react.useContext)(CaseChatContext);if(!ctx)throw new Error("CaseChatContext missing");return ctx}function CaseChatProvider({caseId,onChat,expanded:controlledExpanded,onExpandChange,children}){const[open,setOpen]=(0,react.useState)(!1),[expandedState,setExpandedState]=(0,react.useState)(!1),expanded=null!=controlledExpanded?controlledExpanded:expandedState;var _useOptionalCaseContext;const{caseData}=null!==(_useOptionalCaseContext=(0,CaseContext.ZR)())&&void 0!==_useOptionalCaseContext?_useOptionalCaseContext:{caseData:null},[messages,setMessages]=(0,react.useState)([]),[history,setHistory]=(0,react.useState)([]),[sessionId,setSessionId]=(0,react.useState)(null),[sessionCreatedAt,setSessionCreatedAt]=(0,react.useState)(""),[sessionSummary,setSessionSummary]=(0,react.useState)(""),[systemPrompt,setSystemPrompt]=(0,react.useState)(""),[availableActions,setAvailableActions]=(0,react.useState)([]),[unavailableActions,setUnavailableActions]=(0,react.useState)([]),[input,setInput]=(0,react.useState)(""),[loading,setLoading]=(0,react.useState)(!1),{i18n,t}=(0,es.Bd)(),scrollRef=(0,react.useRef)(null),inputRef=(0,react.useRef)(null),[showJump,setShowJump]=(0,react.useState)(!1),abortRef=(0,react.useRef)(null),openRef=(0,react.useRef)(open),saveCurrentSessionRef=(0,react.useRef)(()=>{}),[photoMap,setPhotoMap]=(0,react.useState)({});(0,react.useEffect)(()=>{openRef.current=open},[open]),(0,react.useEffect)(()=>{if(!open)return;if(window.innerWidth>=640)return;const htmlStyle=document.documentElement.style.overflow,bodyStyle=document.body.style.overflow;return document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",()=>{document.documentElement.style.overflow=htmlStyle,document.body.style.overflow=bodyStyle}},[open]);const[draftData,setDraftData]=(0,react.useState)(null),[draftLoading,setDraftLoading]=(0,react.useState)(!1),[cameraOpen,setCameraOpen]=(0,react.useState)(!1),[draftAnchorId,setDraftAnchorId]=(0,react.useState)(null),[cameraAnchorId,setCameraAnchorId]=(0,react.useState)(null),notify=(0,NotificationProvider.l)(),chatTranslate=function useChatTranslate(caseId){const notify=(0,NotificationProvider.l)(),{t}=(0,es.Bd)();return async(text,lang)=>{const res=await(0,apiClient.n)(`/api/cases/${caseId}/chat/translate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text,lang})});if(!res.ok)throw notify(t("failedToTranslate")),new Error(t("failedToTranslate"));return(await res.json()).translation}}(caseId),[chatError,setChatError]=(0,react.useState)(null),storageKey=`case-chat-${caseId}`,stateKey=`case-chat-state-${caseId}`,loadHistory=(0,react.useCallback)(()=>{try{const raw=localStorage.getItem(storageKey);if(!raw)return[];return JSON.parse(raw).map(s=>({...s,messages:s.messages.map(m=>{var _m_lang,_m_translations;return{...m,lang:null!==(_m_lang=m.lang)&&void 0!==_m_lang?_m_lang:"en",translations:null!==(_m_translations=m.translations)&&void 0!==_m_translations?_m_translations:{}}})}))}catch(e){return[]}},[storageKey]),saveHistory=(0,react.useCallback)(list=>{localStorage.setItem(storageKey,JSON.stringify(list))},[storageKey]),loadState=(0,react.useCallback)(()=>{try{const raw=localStorage.getItem(stateKey);return raw?JSON.parse(raw):null}catch(e){return null}},[stateKey]),saveState=(0,react.useCallback)(state=>{localStorage.setItem(stateKey,JSON.stringify(state))},[stateKey]);(0,react.useEffect)(()=>{setHistory(loadHistory())},[loadHistory]);const loadPhotos=(0,react.useCallback)(async()=>{const res=await(0,apiClient.n)(`/api/cases/${caseId}`);if(!res.ok)return;const data=await res.json(),map={};var _data_photos;for(const url of null!==(_data_photos=data.photos)&&void 0!==_data_photos?_data_photos:[]){const parts=url.split(/[\\/]/);map[parts[parts.length-1]]=url}setPhotoMap(map)},[caseId]);function startNew(){setMessages([]),setSessionId(crypto.randomUUID()),setSessionCreatedAt((new Date).toISOString()),setSessionSummary(""),setSystemPrompt(""),setAvailableActions([]),setUnavailableActions([]),setDraftAnchorId(null),setCameraAnchorId(null)}async function openDraft(anchorId){setDraftAnchorId(null!=anchorId?anchorId:null),setDraftLoading(!0),setDraftData(null);const res=await(0,apiClient.n)(`/api/cases/${caseId}/report?lang=${i18n.language}`);if(res.ok){const data=await res.json();setDraftData(data)}else{const err=await res.json().catch(()=>({}));notify(err.error||"Failed to draft report")}setDraftLoading(!1)}(0,react.useEffect)(()=>{loadPhotos()},[loadPhotos]),(0,react.useEffect)(()=>{const state=loadState();state&&(state.open&&setOpen(!0),void 0===controlledExpanded&&state.expanded&&setExpandedState(state.expanded),state.session&&(setMessages(state.session.messages.map(m=>{var _m_translations;return{...m,translations:null!==(_m_translations=m.translations)&&void 0!==_m_translations?_m_translations:{}}})),setSessionId(state.session.id),setSessionCreatedAt(state.session.createdAt),setSessionSummary(state.session.summary)))},[controlledExpanded,loadState]);const saveCurrentSession=(0,react.useCallback)(()=>{if(messages.length>0&&sessionId){const firstUser=messages.find(m=>"user"===m.role),summary=sessionSummary||(firstUser?firstUser.content.slice(0,30):""),session={id:sessionId,createdAt:sessionCreatedAt,summary,messages},list=[...history.filter(h=>h.id!==sessionId),session];setHistory(list),saveHistory(list)}},[messages,sessionId,sessionCreatedAt,sessionSummary,history,saveHistory]);(0,react.useEffect)(()=>{saveCurrentSessionRef.current=saveCurrentSession},[saveCurrentSession]);const router=(0,navigation.useRouter)();return(0,react.useEffect)(()=>{scrollRef.current&&(scrollRef.current.scrollTop=scrollRef.current.scrollHeight)},[messages]),(0,react.useEffect)(()=>{if(!scrollRef.current)return;const current=scrollRef.current;function update(){const canScroll=current.scrollHeight>current.clientHeight+1,atBottom=current.scrollTop+current.clientHeight>=current.scrollHeight-1;setShowJump(canScroll&&!atBottom)}update(),current.addEventListener("scroll",update),window.addEventListener("resize",update);const observer=new ResizeObserver(update);return observer.observe(current),()=>{current.removeEventListener("scroll",update),window.removeEventListener("resize",update),observer.disconnect()}},[open,messages,expanded]),(0,react.useEffect)(()=>{open&&inputRef.current&&inputRef.current.focus()},[open]),(0,react.useEffect)(()=>{const handler=()=>saveCurrentSessionRef.current();return window.addEventListener("beforeunload",handler),()=>{window.removeEventListener("beforeunload",handler),handler()}},[]),(0,react.useEffect)(()=>{openRef.current&&saveCurrentSessionRef.current(),messages.length},[messages]),(0,react.useEffect)(()=>{saveState({open,expanded,session:sessionId&&sessionCreatedAt?{id:sessionId,createdAt:sessionCreatedAt,summary:sessionSummary,messages}:void 0})},[open,expanded,messages,sessionId,sessionCreatedAt,sessionSummary,saveState]),(0,jsx_runtime.jsx)(CaseChatContext.Provider,{value:{open,expanded,expandedState,messages,history,input,loading,draftLoading,cameraOpen,chatError,photoMap,sessionId,sessionCreatedAt,sessionSummary,systemPrompt,availableActions,unavailableActions,showJump,scrollRef,inputRef,handleOpen:function handleOpen(){startNew(),setOpen(!0),void 0===controlledExpanded?setExpandedState(!1):null==onExpandChange||onExpandChange(!1),async function seed(){var _abortRef_current;setLoading(!0),null===(_abortRef_current=abortRef.current)||void 0===_abortRef_current||_abortRef_current.abort();const controller=new AbortController;abortRef.current=controller;try{let reply=null;if(onChat){const result=await onChat([]);if("string"==typeof result)reply=result.startsWith("[action:")&&result.endsWith("]")?{response:{en:""},actions:[{id:result.slice(8,-1)}],noop:!1,lang:i18n.language}:"[noop]"===result?{response:{en:""},actions:[],noop:!0,lang:i18n.language}:{response:{en:result},actions:[],noop:!1,lang:i18n.language};else if("response"in result)reply=result;else if("reply"in result){const r=result;reply=r.reply,r.system&&setSystemPrompt(r.system),r.available&&setAvailableActions(r.available),r.unavailable&&setUnavailableActions(r.unavailable)}else reply=result}else{const res=await(0,apiClient.n)(`/api/cases/${caseId}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[],lang:i18n.language}),signal:controller.signal});if(res.ok){const data=await res.json();var _data_available,_data_unavailable;reply=data.reply,setSystemPrompt(data.system),setAvailableActions(null!==(_data_available=data.available)&&void 0!==_data_available?_data_available:[]),setUnavailableActions(null!==(_data_unavailable=data.unavailable)&&void 0!==_data_unavailable?_data_unavailable:[])}}var _reply_response_i18n_language,_ref,_ref1;controller.signal.aborted||!reply||reply.noop||setMessages([{id:crypto.randomUUID(),role:"assistant",content:null!==(_ref1=null!==(_ref=null!==(_reply_response_i18n_language=reply.response[i18n.language])&&void 0!==_reply_response_i18n_language?_reply_response_i18n_language:reply.response.en)&&void 0!==_ref?_ref:Object.values(reply.response)[0])&&void 0!==_ref1?_ref1:"",lang:reply.lang,actions:reply.actions}])}catch(e){}controller.signal.aborted||setLoading(!1)}()},handleClose:function handleClose(){setOpen(!1),setDraftData(null),setDraftLoading(!1),setCameraOpen(!1),setDraftAnchorId(null),setCameraAnchorId(null),void 0===controlledExpanded?setExpandedState(!1):null==onExpandChange||onExpandChange(!1),saveCurrentSession(),localStorage.removeItem(stateKey)},toggleExpanded:function toggleExpanded(){const next=!expanded;void 0===controlledExpanded&&setExpandedState(next),null==onExpandChange||onExpandChange(next)},send:async function send(){const text=input.trim();if(!text)return;const list=[...messages,{id:crypto.randomUUID(),role:"user",content:text,lang:i18n.language,translations:{[i18n.language]:text}}];0===messages.length&&setSessionSummary(text.slice(0,30)),setMessages(list),setInput(""),await async function request(list){var _abortRef_current;setLoading(!0),null===(_abortRef_current=abortRef.current)||void 0===_abortRef_current||_abortRef_current.abort();const controller=new AbortController;abortRef.current=controller;try{let reply=null;if(onChat){const result=await onChat(list);if("string"==typeof result)reply=result.startsWith("[action:")&&result.endsWith("]")?{response:{en:""},actions:[{id:result.slice(8,-1)}],noop:!1,lang:i18n.language}:"[noop]"===result?{response:{en:""},actions:[],noop:!0,lang:i18n.language}:{response:{en:result},actions:[],noop:!1,lang:i18n.language};else if("response"in result)reply=result;else if("reply"in result){const r=result;reply=r.reply,r.system&&setSystemPrompt(r.system),r.available&&setAvailableActions(r.available),r.unavailable&&setUnavailableActions(r.unavailable)}else reply=result}else{const res=await(0,apiClient.n)(`/api/cases/${caseId}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:list,lang:i18n.language}),signal:controller.signal});if(res.ok){const data=await res.json();var _data_available,_data_unavailable;reply=data.reply,setSystemPrompt(data.system),setAvailableActions(null!==(_data_available=data.available)&&void 0!==_data_available?_data_available:[]),setUnavailableActions(null!==(_data_unavailable=data.unavailable)&&void 0!==_data_unavailable?_data_unavailable:[]),setChatError(null)}else{const err=await res.json().catch(()=>({}));503===res.status?setChatError(err.error||"Case Chat server is unavailable. Please try again."):setChatError(err.error||"Case Chat response was invalid. Please try again later.")}}var _reply_response_i18n_language,_ref,_ref1;!controller.signal.aborted&&reply&&(reply.noop?setMessages(list):setMessages([...list,{id:crypto.randomUUID(),role:"assistant",content:null!==(_ref1=null!==(_ref=null!==(_reply_response_i18n_language=reply.response[i18n.language])&&void 0!==_reply_response_i18n_language?_reply_response_i18n_language:reply.response.en)&&void 0!==_ref?_ref:Object.values(reply.response)[0])&&void 0!==_ref1?_ref1:"",lang:reply.lang,actions:reply.actions,translations:reply.response}]))}catch(e){controller.signal.aborted||setChatError("Case Chat server is unreachable. Please try again later.")}controller.signal.aborted||setLoading(!1)}(list)},scrollToBottom:function scrollToBottom(){scrollRef.current&&(scrollRef.current.scrollTop=scrollRef.current.scrollHeight,setShowJump(!1))},renderActions:function renderActions(actions,msgId){const buttons=actions.map((a,idx)=>{if("id"in a){const act=caseActions.E.find(c=>c.id===a.id);if(act)return(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{if("compose"===act.id)openDraft(msgId);else if("take-photo"===act.id)!function openCamera(anchorId){setCameraAnchorId(null!=anchorId?anchorId:null),setCameraOpen(!0)}(msgId);else if("view-ownership-request"===act.id){const link=caseData?(0,caseUtils.cy)(caseData):null;link&&router.push(link)}else router.push(act.href(caseId))},className:(0,css.AH)({bg:"blue.600",color:"white",px:"2",py:"1",borderRadius:"md",mx:"1"}),children:act.label},`${a.id}-${idx}`)}else{if("field"in a&&"value"in a){var _labelMap_a_field;const label=null!==(_labelMap_a_field={vin:`Set VIN to "${a.value}"`,plate:`Set Plate to "${a.value}"`,state:`Set State to "${a.value}"`,note:`Add Note: "${a.value}"`}[a.field])&&void 0!==_labelMap_a_field?_labelMap_a_field:`Apply ${a.field}`;return(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{(async function handleEdit(field,value){switch(field){case"vin":await(0,apiClient.n)(`/api/cases/${caseId}/vin`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vin:value})}),router.refresh();break;case"plate":await(0,apiClient.n)(`/api/cases/${caseId}/override`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle:{licensePlateNumber:value}})}),router.refresh();break;case"state":await(0,apiClient.n)(`/api/cases/${caseId}/override`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle:{licensePlateState:value}})}),router.refresh();break;case"note":{const res=await(0,apiClient.n)(`/api/cases/${caseId}`),data=res.ok?await res.json():{note:null},note=data.note?`${data.note}\n${value}`:value;await(0,apiClient.n)(`/api/cases/${caseId}/note`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({note})}),router.refresh()}}})(a.field,a.value)},className:(0,css.AH)({bg:"green.700",color:"white",px:"2",py:"1",borderRadius:"md",mx:"1"}),children:label},`edit-${a.field}-${a.value}`)}if("photo"in a&&"note"in a){const url=photoMap[a.photo];if(url)return(0,jsx_runtime.jsxs)("button",{type:"button",onClick:()=>{(async function handlePhotoNote(name,value){var _data_photoNotes;const url=photoMap[name];if(!url)return;const res=await(0,apiClient.n)(`/api/cases/${caseId}`);var _data_photoNotes_url;const current=null!==(_data_photoNotes_url=null===(_data_photoNotes=(res.ok?await res.json():{photoNotes:void 0}).photoNotes)||void 0===_data_photoNotes?void 0:_data_photoNotes[url])&&void 0!==_data_photoNotes_url?_data_photoNotes_url:null,note=current?`${current}\n${value}`:value;await(0,apiClient.n)(`/api/cases/${caseId}/photo-note`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({photo:url,note})}),router.refresh()})(a.photo,a.note)},className:(0,css.AH)({bg:"green.700",color:"white",px:"1",py:"1",borderRadius:"md",mx:"1",display:"flex",alignItems:"center",gap:"1"}),children:[(0,jsx_runtime.jsx)(thumbnail_image.A,{src:(0,clientThumbnails.s)(url,64),alt:a.photo,width:32,height:24}),(0,jsx_runtime.jsx)("span",{children:`Add "${a.note}"`})]},`photo-${a.photo}-${a.note}`)}}return null});return(0,jsx_runtime.jsx)("div",{className:(0,css.AH)({mt:"1",display:"flex",flexWrap:"wrap",gap:"1"}),children:buttons})},renderContent:function renderContent(m){var _m_translations;const{text,needsTranslation}=(0,localizedText.P)({[m.lang]:m.content,...null!==(_m_translations=m.translations)&&void 0!==_m_translations?_m_translations:{}},i18n.language);return(0,jsx_runtime.jsxs)("span",{children:[text,needsTranslation?(0,jsx_runtime.jsx)(InlineTranslateButton.A,{lang:i18n.language,onTranslate:()=>async function handleTranslate(msg){const tr=await chatTranslate(msg.content,i18n.language);setMessages(list=>list.map(m=>{var _m_translations;return m.id===msg.id?{...m,translations:{...null!==(_m_translations=m.translations)&&void 0!==_m_translations?_m_translations:{},[i18n.language]:tr}}:m}))}(m)}):null]})},setInput,openDraft,draftAnchorId,setDraftAnchorId,draftData,setDraftData,cameraAnchorId,setCameraAnchorId,setCameraOpen,selectSession:function selectSession(val){if(saveCurrentSession(),"new"===val)startNew();else{const found=history.find(h=>h.id===val);found&&(setMessages(found.messages),setSessionId(found.id),setSessionCreatedAt(found.createdAt),setSessionSummary(found.summary))}}},children})}CaseChatProvider.__docgenInfo={description:"",methods:[],displayName:"CaseChatProvider",props:{caseId:{required:!0,tsType:{name:"string"},description:""},onChat:{required:!1,tsType:{name:"signature",type:"function",raw:"(\n  messages: Message[],\n) => Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>",signature:{arguments:[{type:{name:"Array",elements:[{name:"Message"}],raw:"Message[]"},name:"messages"}],return:{name:"Promise",elements:[{name:"union",raw:"CaseChatReply | { reply: string; system?: string } | ChatResponse | string",elements:[{name:"CaseChatReply"},{name:"signature",type:"object",raw:"{ reply: string; system?: string }",signature:{properties:[{key:"reply",value:{name:"string",required:!0}},{key:"system",value:{name:"string",required:!1}}]}},{name:"ChatResponse"},{name:"string"}]}],raw:"Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>"}}},description:""},expanded:{required:!1,tsType:{name:"boolean"},description:""},onExpandChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"value"}],return:{name:"void"}}},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};var index_esm=__webpack_require__("__barrel_optimize__?names=FaBars,FaUserCircle!=!./node_modules/.pnpm/react-icons@4.12.0_react@19.1.0/node_modules/react-icons/fa/index.esm.js");function ChatHeader(){const{expanded,toggleExpanded,handleClose,history,sessionId,sessionCreatedAt,sessionSummary,selectSession}=useCaseChat(),{t}=(0,es.Bd)();return(0,jsx_runtime.jsxs)("div",{className:(0,css.AH)({display:"flex",alignItems:"center",borderBottomWidth:"1px",p:"2",gap:"2"}),children:[(0,jsx_runtime.jsx)("span",{className:(0,css.AH)({fontWeight:"semibold",flex:"none"}),children:t("caseChat")}),(0,jsx_runtime.jsxs)("select",{"aria-label":t("chatHistory"),value:null!=sessionId?sessionId:"",onChange:e=>selectSession(e.target.value),className:(0,css.AH)({color:"black",fontSize:"xs",flex:"auto",minW:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),children:[(0,jsx_runtime.jsx)("option",{value:"new",children:t("newChat")}),!history.some(h=>h.id===sessionId)&&sessionId&&(0,jsx_runtime.jsxs)("option",{value:sessionId,children:[new Date(sessionCreatedAt).toLocaleString(),sessionSummary?` - ${sessionSummary}`:""]}),history.map(h=>(0,jsx_runtime.jsxs)("option",{value:h.id,children:[new Date(h.createdAt).toLocaleString()," - ",h.summary]},h.id))]}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:toggleExpanded,"aria-label":t(expanded?"collapseChat":"expandChat"),className:(0,css.AH)({fontSize:"xl",lineHeight:"none",flex:"none",display:{base:"none",sm:"block"}}),children:expanded?(0,jsx_runtime.jsx)(index_esm.f93,{}):(0,jsx_runtime.jsx)(index_esm.xKl,{})}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:handleClose,"aria-label":t("closeChat"),className:(0,css.AH)({fontSize:"xl",lineHeight:"none",flex:"none"}),children:"Ã—"})]})}function ChatInput(){const{input,setInput,send,loading,showJump,scrollToBottom,inputRef}=useCaseChat(),{t}=(0,es.Bd)();return(0,jsx_runtime.jsxs)("div",{className:(0,css.AH)({borderTopWidth:"1px",p:"2",display:"flex",flexDirection:"column",gap:"2"}),style:{paddingBottom:"calc(env(safe-area-inset-bottom,0) + 0.5rem)"},children:[showJump?(0,jsx_runtime.jsx)("button",{type:"button",onClick:scrollToBottom,className:(0,css.AH)({alignSelf:"flex-start",color:"blue.600",textDecoration:"underline",fontSize:"xs"}),children:t("jumpToLatest")}):null,(0,jsx_runtime.jsxs)("div",{className:(0,css.AH)({display:"flex",gap:"2"}),children:[(0,jsx_runtime.jsx)("input",{ref:inputRef,type:"text",value:input,onChange:e=>setInput(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),send())},className:(0,css.AH)({flex:"1",borderWidth:"1px",borderRadius:"md",px:"1",fontSize:"base",bg:(0,tokens.S)("colors.surface-subtle")}),placeholder:t("askQuestion")}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:send,disabled:loading,className:(0,css.AH)({bg:"blue.600",color:"white",px:"2",borderRadius:"md",_disabled:{opacity:.5}}),children:t("send")})]})]})}ChatHeader.__docgenInfo={description:"",methods:[],displayName:"ChatHeader"},ChatInput.__docgenInfo={description:"",methods:[],displayName:"ChatInput"};var DebugWrapper=__webpack_require__("./src/app/components/DebugWrapper.tsx"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@3.3.4_webpack@4.41.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/.pnpm/style-loader@3.3.4_webpack@4.41.2/node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/.pnpm/style-loader@3.3.4_webpack@4.41.2/node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/.pnpm/style-loader@3.3.4_webpack@4.41.2/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/.pnpm/style-loader@3.3.4_webpack@4.41.2/node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/.pnpm/style-loader@3.3.4_webpack@4.41.2/node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),CaseChat_module=__webpack_require__("./node_modules/.pnpm/css-loader@6.11.0_webpack@4.41.2/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!./node_modules/.pnpm/postcss-loader@8.1.1_postcss@8.5.6_typescript@5.8.3_webpack@4.41.2/node_modules/postcss-loader/dist/cjs.js!./src/app/cases/[id]/CaseChat.module.css"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(CaseChat_module.A,options);const _id_CaseChat_module=CaseChat_module.A&&CaseChat_module.A.locals?CaseChat_module.A.locals:void 0;var useAddFilesToCase=__webpack_require__("./src/app/useAddFilesToCase.ts");function ChatWidget({children,className=""}){return(0,jsx_runtime.jsx)("div",{className:`bg-blue-600 text-white px-2 py-1 rounded mx-1 text-xs space-y-1 ${className}`,children})}function WidgetActions({children,centered=!1,wrap=!1}){const classes=["flex","gap-1"];return centered&&classes.push("justify-center"),wrap&&classes.push("flex-wrap"),(0,jsx_runtime.jsx)("div",{className:classes.join(" "),children})}function TakePhotoWidget({caseId,onClose}){const videoRef=(0,react.useRef)(null),canvasRef=(0,react.useRef)(null),uploadCase=(0,useAddFilesToCase.A)(caseId),[error,setError]=(0,react.useState)(null),[uploading,setUploading]=(0,react.useState)(!1),[gps,setGps]=(0,react.useState)(null),{t}=(0,es.Bd)();return(0,react.useEffect)(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(pos=>{setGps({lat:pos.coords.latitude,lon:pos.coords.longitude})});let stream=null;return async function startCamera(){var _navigator_mediaDevices;if(null===(_navigator_mediaDevices=navigator.mediaDevices)||void 0===_navigator_mediaDevices?void 0:_navigator_mediaDevices.getUserMedia)try{stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});const v=videoRef.current;v&&(v.srcObject=stream,v.setAttribute("autoplay",""),v.setAttribute("muted",""),v.setAttribute("playsinline",""),v.onloadedmetadata=()=>{v.play().catch(()=>{})})}catch(e){setError(t("cameraAccessError"))}else setError(t("cameraApiUnavailable"))}(),()=>{if(stream)for(const t of stream.getTracks())t.stop()}},[t]),(0,jsx_runtime.jsxs)(ChatWidget,{className:"w-48",children:[(0,jsx_runtime.jsx)("video",{ref:videoRef,className:"w-full h-32 bg-black rounded",children:(0,jsx_runtime.jsx)("track",{kind:"captions",label:""})}),(0,jsx_runtime.jsx)("canvas",{ref:canvasRef,className:"hidden"}),error&&(0,jsx_runtime.jsx)("div",{className:"text-red-200 text-center",children:error}),(0,jsx_runtime.jsxs)(WidgetActions,{centered:!0,children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:async function takePicture(){const video=videoRef.current,canvas=canvasRef.current;if(!video||!canvas)return;canvas.width=video.videoWidth,canvas.height=video.videoHeight;const ctx=canvas.getContext("2d");ctx&&(ctx.drawImage(video,0,0,canvas.width,canvas.height),canvas.toBlob(async blob=>{if(!blob)return;const file=new File([blob],"photo.jpg",{type:"image/jpeg"}),dt=new DataTransfer;dt.items.add(file),setUploading(!0),await uploadCase(dt.files,gps),setUploading(!1),onClose()},"image/jpeg"))},disabled:uploading,className:"bg-blue-800 text-white px-1 rounded disabled:opacity-50",children:t(uploading?"uploading":"takePicture")}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:onClose,className:"bg-gray-200 text-black px-1 rounded",children:t("close")})]})]})}ChatWidget.__docgenInfo={description:"",methods:[],displayName:"ChatWidget",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}}}},WidgetActions.__docgenInfo={description:"",methods:[],displayName:"WidgetActions",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},centered:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},wrap:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}},TakePhotoWidget.__docgenInfo={description:"",methods:[],displayName:"TakePhotoWidget",props:{caseId:{required:!0,tsType:{name:"string"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};var tooltip=__webpack_require__("./src/components/ui/tooltip.tsx"),next_link=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/link.js"),link_default=__webpack_require__.n(next_link);function DraftPreview({caseId,data,onClose}){const router=(0,navigation.useRouter)(),notify=(0,NotificationProvider.l)(),[sending,setSending]=(0,react.useState)(!1),{i18n,t}=(0,es.Bd)();const subjectText=(0,localizedText.P)(data.email.subject,i18n.language).text,{text:bodyText}=(0,localizedText.P)(data.email.body,i18n.language);async function send(){setSending(!0);const res=await(0,apiClient.n)(`/api/cases/${caseId}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:subjectText,body:bodyText,attachments:data.attachments})});if(res.ok)notify(t("emailSent")),onClose();else{const err=await res.json().catch(()=>({}));notify(err.error||t("failedToSendEmail"))}setSending(!1)}const previewBody=bodyText.length>80?`${bodyText.slice(0,77)}...`:bodyText,tooltipContent=(0,jsx_runtime.jsxs)("div",{className:"bg-white text-black p-2 rounded shadow max-w-sm space-y-2",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold text-sm",children:subjectText}),(0,jsx_runtime.jsx)("pre",{className:"whitespace-pre-wrap text-xs",children:bodyText}),data.attachments.length>0&&(0,jsx_runtime.jsx)("div",{className:"flex gap-1 flex-wrap",children:data.attachments.map(p=>(0,jsx_runtime.jsx)(thumbnail_image.A,{src:(0,clientThumbnails.s)(p,128),alt:"attachment",width:96,height:72,imgClassName:"object-contain"},p))}),(0,jsx_runtime.jsxs)(WidgetActions,{wrap:!0,children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:send,disabled:sending,className:"bg-blue-800 text-white px-1 rounded text-xs disabled:opacity-50",children:t(sending?"sending":"send")}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:onClose,className:"bg-gray-200 text-black px-1 rounded text-xs",children:t("close")}),(0,jsx_runtime.jsx)(link_default(),{href:`/cases/${caseId}/compose`,className:"bg-blue-600 text-white px-1 rounded text-xs",children:t("fullEditor")})]})]});return(0,jsx_runtime.jsxs)(ChatWidget,{children:[(0,jsx_runtime.jsx)(tooltip.A,{label:tooltipContent,interactive:!0,children:(0,jsx_runtime.jsxs)("button",{type:"button",onClick:function openCompose(){const url=`/cases/${caseId}/compose`;if(router.push(url),"undefined"!=typeof history){var _history_state;const st=null!==(_history_state=history.state)&&void 0!==_history_state?_history_state:{};history.replaceState({...st,draftData:data},"",url)}},className:"text-left w-full",children:[(0,jsx_runtime.jsx)("strong",{children:subjectText})," ",previewBody]})}),(0,jsx_runtime.jsxs)(WidgetActions,{children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:send,disabled:sending,className:"bg-blue-800 text-white px-1 rounded disabled:opacity-50",children:t(sending?"sending":"send")}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:onClose,className:"bg-gray-200 text-black px-1 rounded",children:t("close")})]})]})}function ChatMessages({caseId}){const{messages,loading,draftLoading,draftData,cameraOpen,chatError,renderActions,renderContent,scrollRef,setDraftData,setCameraOpen,draftAnchorId,setDraftAnchorId,cameraAnchorId,setCameraAnchorId,systemPrompt,availableActions,unavailableActions}=useCaseChat(),{t}=(0,es.Bd)();return(0,jsx_runtime.jsx)(DebugWrapper.A,{data:{system:systemPrompt,available:availableActions,unavailable:unavailableActions},className:(0,css.AH)({display:"flex",flexDirection:"column",flex:"1",minH:0}),children:(0,jsx_runtime.jsxs)("div",{ref:scrollRef,"data-testid":"chat-scroll",className:(0,css.AH)({flex:"1",overflowY:"auto",p:"2",display:"flex",flexDirection:"column",gap:"2"}),children:[messages.map(m=>(0,jsx_runtime.jsxs)("div",{className:(0,css.AH)({display:"flex",flexDirection:"column",alignItems:"user"===m.role?"flex-end":"flex-start"}),children:[(0,jsx_runtime.jsx)("span",{className:`${_id_CaseChat_module.bubble} ${"user"===m.role?_id_CaseChat_module.user:_id_CaseChat_module.assistant}`,children:renderContent(m)}),"assistant"===m.role&&m.actions&&m.actions.length>0&&renderActions(m.actions,m.id),draftData&&draftAnchorId===m.id&&(0,jsx_runtime.jsx)(DraftPreview,{caseId,data:draftData,onClose:()=>{setDraftData(null),setDraftAnchorId(null)}}),cameraOpen&&cameraAnchorId===m.id&&(0,jsx_runtime.jsx)(TakePhotoWidget,{caseId,onClose:()=>{setCameraOpen(!1),setCameraAnchorId(null)}})]},m.id)),loading&&(0,jsx_runtime.jsx)("div",{className:(0,css.AH)({textAlign:"left"}),children:(0,jsx_runtime.jsx)("span",{className:`${_id_CaseChat_module.bubble} ${_id_CaseChat_module.assistant} ${_id_CaseChat_module.typing}`})},"typing"),draftLoading&&(0,jsx_runtime.jsx)("div",{className:(0,css.AH)({textAlign:"left"}),children:(0,jsx_runtime.jsx)("span",{className:(0,css.AH)({fontSize:"sm"}),children:t("draftingEmail")})},"draft-loading"),chatError&&(0,jsx_runtime.jsx)("div",{className:(0,css.AH)({textAlign:"left"}),children:(0,jsx_runtime.jsx)("span",{className:`${_id_CaseChat_module.bubble} ${_id_CaseChat_module.error}`,children:chatError})},"chat-error")]})})}function CaseChat(props){const{caseId}=props;return(0,jsx_runtime.jsx)(CaseChatProvider,{...props,children:(0,jsx_runtime.jsx)(CaseChatInner,{caseId})})}function CaseChatInner({caseId}){const{open,expanded,handleOpen}=useCaseChat();return function useVisualViewportHeight(active=!0){(0,react.useEffect)(()=>{var _window_visualViewport;if(!active)return;const setHeight=()=>{const height=window.visualViewport?window.visualViewport.height:window.innerHeight;document.documentElement.style.setProperty("--visual-viewport-height",`${height}px`),window.scrollTo({top:0})};return setHeight(),null===(_window_visualViewport=window.visualViewport)||void 0===_window_visualViewport||_window_visualViewport.addEventListener("resize",setHeight),window.addEventListener("resize",setHeight),()=>{var _window_visualViewport;null===(_window_visualViewport=window.visualViewport)||void 0===_window_visualViewport||_window_visualViewport.removeEventListener("resize",setHeight),window.removeEventListener("resize",setHeight)}},[active])}(open),(0,jsx_runtime.jsx)("div",{className:(0,css.cx)((0,css.AH)({fontSize:"sm"}),expanded?(0,css.AH)({position:"relative",h:"full"}):open?(0,css.cx)("z-chat",(0,css.AH)({position:"fixed",inset:0,sm:{bottom:"4",right:"4",inset:"auto"}})):(0,css.cx)("z-chat",(0,css.AH)({position:"fixed",bottom:"4",right:"4"}))),style:open&&!expanded?{"--case-chat-offset":"1rem"}:void 0,children:open?(0,jsx_runtime.jsxs)("div",{className:(0,css.AH)({bg:(0,tokens.S)("colors.surface"),shadow:"md",rounded:"md",display:"flex",flexDirection:"column",w:expanded?"full":"100vw",h:expanded?"full":void 0,sm:expanded?{w:"full",h:"full"}:{w:"80",maxH:"400px"}}),style:expanded?void 0:{height:"calc(var(--visual-viewport-height) - var(--case-chat-offset,0px))",marginTop:"var(--case-chat-offset,0px)"},children:[(0,jsx_runtime.jsx)(ChatHeader,{}),(0,jsx_runtime.jsx)(ChatMessages,{caseId}),(0,jsx_runtime.jsx)(ChatInput,{})]}):(0,jsx_runtime.jsx)("button",{type:"button",onClick:handleOpen,className:(0,css.AH)({bg:"blue.600",color:"white",px:"3",py:"1",borderRadius:"md",shadow:"md"}),children:"Chat"})})}DraftPreview.__docgenInfo={description:"",methods:[],displayName:"DraftPreview",props:{caseId:{required:!0,tsType:{name:"string"},description:""},data:{required:!0,tsType:{name:"DraftData"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}},ChatMessages.__docgenInfo={description:"",methods:[],displayName:"ChatMessages",props:{caseId:{required:!0,tsType:{name:"string"},description:""}}},CaseChat.__docgenInfo={description:"",methods:[],displayName:"CaseChat",props:{caseId:{required:!0,tsType:{name:"string"},description:""},onChat:{required:!1,tsType:{name:"signature",type:"function",raw:"(\n  messages: Message[],\n) => Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>",signature:{arguments:[{type:{name:"Array",elements:[{name:"Message"}],raw:"Message[]"},name:"messages"}],return:{name:"Promise",elements:[{name:"union",raw:"CaseChatReply | { reply: string; system?: string } | ChatResponse | string",elements:[{name:"CaseChatReply"},{name:"signature",type:"object",raw:"{ reply: string; system?: string }",signature:{properties:[{key:"reply",value:{name:"string",required:!0}},{key:"system",value:{name:"string",required:!1}}]}},{name:"ChatResponse"},{name:"string"}]}],raw:"Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>"}}},description:""},expanded:{required:!1,tsType:{name:"boolean"},description:""},onExpandChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"value"}],return:{name:"void"}}},description:""}}}},"./src/app/cases/[id]/CaseContext.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{qS:()=>CaseProvider,VJ:()=>useCaseContext,ZR:()=>useOptionalCaseContext});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/jsx-runtime.js"),apiClient=__webpack_require__("./src/apiClient.ts"),react=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/index.js"),useEventSource=__webpack_require__("./src/app/hooks/useEventSource.ts");var basePath=__webpack_require__("./src/basePath.ts"),caseUtils=__webpack_require__("./src/lib/caseUtils.ts"),QueryClientProvider=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@5.81.5_react@19.1.0/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js"),useMutation=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@5.81.5_react@19.1.0/node_modules/@tanstack/react-query/build/modern/useMutation.js"),navigation=__webpack_require__("./node_modules/.pnpm/@storybook+nextjs@8.6.14_esbuild@0.25.5_next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@_htn273eqkwxmbpgcwhwcuzbpny/node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),es=__webpack_require__("./node_modules/.pnpm/react-i18next@15.6.0_i18next@25.3.1_typescript@5.8.3__react-dom@19.1.0_react@19.1.0__react@19.1.0_typescript@5.8.3/node_modules/react-i18next/dist/es/index.js"),NotificationProvider=__webpack_require__("./src/app/components/NotificationProvider.tsx"),useQuery=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@5.81.5_react@19.1.0/node_modules/@tanstack/react-query/build/modern/useQuery.js");const caseQueryKey=id=>[`/api/cases/${id}`];const caseMembersQueryKey=id=>[`/api/cases/${id}/members`];const CaseContext=(0,react.createContext)(null);function CaseProvider({children,initialCase,caseId}){const queryClient=(0,QueryClientProvider.jE)(),{data:caseData=null}=function useCase(id,initialData){return(0,useQuery.I)({queryKey:caseQueryKey(id),initialData:null!=initialData?initialData:void 0,enabled:!!id})}(caseId,initialCase),{data:members=[]}=function useCaseMembers(id){return(0,useQuery.I)({queryKey:caseMembersQueryKey(id),enabled:!!id})}(caseId),[selectedPhoto,setSelectedPhoto]=(0,react.useState)(initialCase?(0,caseUtils.wq)(initialCase):null),notify=(0,NotificationProvider.l)(),router=(0,navigation.useRouter)(),fileInputRef=(0,react.useRef)(null),{t}=(0,es.Bd)(),[copied,setCopied]=(0,react.useState)(!1),[reanalyzingPhoto,setReanalyzingPhoto]=(0,react.useState)(null);var _caseData_public;const analysisActive=function useCaseAnalysisActive(caseId,isPublic){const[active,setActive]=(0,react.useState)(!1);return(0,react.useEffect)(()=>{let closed=!1;const base=isPublic?"/api/public/cases":"/api/cases";return async function fetchStatus(){try{const res=await(0,apiClient.n)(`${base}/${encodeURIComponent(caseId)}/jobs?type=analyzeCase`);if(res.ok){var _data_jobs;const data=await res.json();var _data_jobs_length;closed||setActive((null!==(_data_jobs_length=null===(_data_jobs=data.jobs)||void 0===_data_jobs?void 0:_data_jobs.length)&&void 0!==_data_jobs_length?_data_jobs_length:0)>0)}}catch(e){}}(),()=>{closed=!0}},[caseId,isPublic]),(0,useEventSource.A)(`${isPublic?"/api/public/cases":"/api/cases"}/${encodeURIComponent(caseId)}/jobs/stream?type=analyzeCase`,data=>{setActive(data.jobs.length>0)}),active}(caseId,null!==(_caseData_public=null==caseData?void 0:caseData.public)&&void 0!==_caseData_public&&_caseData_public);async function uploadFiles(files){if(!files||0===files.length)return;(await Promise.all(Array.from(files).map(file=>{const formData=new FormData;return formData.append("photo",file),formData.append("caseId",caseId),(0,apiClient.n)("/api/upload",{method:"POST",body:formData})}))).some(r=>!r.ok)?notify("Failed to upload one or more files."):(await refreshCase(),router.refresh(),fileInputRef.current&&(fileInputRef.current.value=""))}async function refreshCase(){const res=await(0,apiClient.n)(`/api/cases/${caseId}`);res.ok?queryClient.setQueryData(caseQueryKey(caseId),await res.json()):notify("Failed to refresh case.")}async function updateVehicle(plateNum,plateState){(await(0,apiClient.n)(`/api/cases/${caseId}/override`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle:{licensePlateNumber:plateNum||void 0,licensePlateState:plateState||void 0}})})).ok?await refreshCase():notify("Failed to update vehicle information.")}async function refreshMembers(){const res=await(0,apiClient.n)(`/api/cases/${caseId}/members`);res.ok&&queryClient.setQueryData(caseMembersQueryKey(caseId),await res.json())}(0,useEventSource.A)("/api/cases/stream",data=>{data.id===caseId&&(data.deleted?queryClient.setQueryData(caseQueryKey(caseId),null):(queryClient.setQueryData(caseQueryKey(caseId),data),sessionStorage.removeItem(`preview-${caseId}`)))}),(0,react.useEffect)(()=>{caseData&&setSelectedPhoto(prev=>{var _caseData_threadImages;const all=new Set([...caseData.photos,...(null!==(_caseData_threadImages=caseData.threadImages)&&void 0!==_caseData_threadImages?_caseData_threadImages:[]).map(img=>img.url)]);return prev&&all.has(prev)?prev:(0,caseUtils.wq)(caseData)})},[caseData]);const updateVinMutation=(0,useMutation.n)({async mutationFn(value){if(!(await(0,apiClient.n)(`/api/cases/${caseId}/vin`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vin:value||null})})).ok)throw new Error(t("failedUpdateVin"))},onSuccess(){queryClient.invalidateQueries({queryKey:caseQueryKey(caseId)})},onError(){notify(t("failedUpdateVin"))}}),clearVinMutation=(0,useMutation.n)({async mutationFn(){if(!(await(0,apiClient.n)(`/api/cases/${caseId}/vin`,{method:"DELETE"})).ok)throw new Error(t("failedClearVin"))},onSuccess(){queryClient.invalidateQueries({queryKey:caseQueryKey(caseId)})},onError(){notify(t("failedClearVin"))}}),updateNoteMutation=(0,useMutation.n)({async mutationFn(value){if(!(await(0,apiClient.n)(`/api/cases/${caseId}/note`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:value||null})})).ok)throw new Error(t("failedUpdateNote"))},onSuccess(){queryClient.invalidateQueries({queryKey:caseQueryKey(caseId)})},onError(){notify(t("failedUpdateNote"))}}),updatePhotoNoteMutation=(0,useMutation.n)({async mutationFn({photo,value}){if(!(await(0,apiClient.n)(`/api/cases/${caseId}/photo-note`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({photo,note:value||null})})).ok)throw new Error(t("failedUpdateNote"))},onSuccess(){queryClient.invalidateQueries({queryKey:caseQueryKey(caseId)})},onError(){notify(t("failedUpdateNote"))}}),togglePublicMutation=(0,useMutation.n)({async mutationFn(){var _caseData_public;if(!(await(0,apiClient.n)(`/api/cases/${caseId}/public`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({public:!(null!==(_caseData_public=null==caseData?void 0:caseData.public)&&void 0!==_caseData_public&&_caseData_public)})})).ok)throw new Error(t("failedUpdateVisibility"))},onSuccess(){queryClient.invalidateQueries({queryKey:caseQueryKey(caseId)})},onError(){notify(t("failedUpdateVisibility"))}}),toggleClosedMutation=(0,useMutation.n)({async mutationFn(){var _caseData_closed;if(!(await(0,apiClient.n)(`/api/cases/${caseId}/closed`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({closed:!(null!==(_caseData_closed=null==caseData?void 0:caseData.closed)&&void 0!==_caseData_closed&&_caseData_closed)})})).ok)throw new Error(t("failedUpdateStatus"))},onSuccess(){queryClient.invalidateQueries({queryKey:caseQueryKey(caseId)})},onError(){notify(t("failedUpdateStatus"))}}),toggleArchivedMutation=(0,useMutation.n)({async mutationFn(){var _caseData_archived;if(!(await(0,apiClient.n)(`/api/cases/${caseId}/archived`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({archived:!(null!==(_caseData_archived=null==caseData?void 0:caseData.archived)&&void 0!==_caseData_archived&&_caseData_archived)})})).ok)throw new Error(t("failedUpdateStatus"))},onSuccess(){queryClient.invalidateQueries({queryKey:caseQueryKey(caseId)})},onError(){notify(t("failedUpdateStatus"))}});const reanalyzePhotoMutation=(0,useMutation.n)({async mutationFn({photo}){const url=`/api/cases/${caseId}/reanalyze-photo?photo=${encodeURIComponent(photo)}`;caseData&&queryClient.setQueryData(caseQueryKey(caseId),{...caseData,analysisStatus:"pending"}),setReanalyzingPhoto(photo);if(!(await(0,apiClient.n)(url,{method:"POST"})).ok)throw new Error(t("failedReanalyzePhoto"))},onSuccess(){queryClient.invalidateQueries({queryKey:caseQueryKey(caseId)})},onError(){notify(t("failedReanalyzePhoto"))}}),retryAnalysisMutation=(0,useMutation.n)({async mutationFn(){caseData&&queryClient.setQueryData(caseQueryKey(caseId),{...caseData,analysisStatus:"pending"});if(!(await(0,apiClient.n)(`/api/cases/${caseId}/reanalyze`,{method:"POST"})).ok)throw new Error(t("failedRetryAnalysis"))},onSuccess(){queryClient.invalidateQueries({queryKey:caseQueryKey(caseId)})},onError(){notify(t("failedRetryAnalysis"))}}),removePhotoMutation=(0,useMutation.n)({async mutationFn(photo){if(!(await(0,apiClient.n)(`/api/cases/${caseId}/photos`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({photo})})).ok)throw new Error(t("failedRemovePhoto"));const res=await(0,apiClient.n)(`/api/cases/${caseId}`);if(!res.ok)throw new Error(t("failedRefreshAfterRemove"));queryClient.setQueryData(caseQueryKey(caseId),await res.json())},async onSuccess(){router.refresh();window.confirm(t("confirmReanalyze"))&&(await(0,apiClient.n)(`/api/cases/${caseId}/reanalyze`,{method:"POST"}),router.refresh())},onError(){notify(t("failedRemovePhoto"))}}),translateMutation=(0,useMutation.n)({async mutationFn({path,lang}){if(!(await(0,apiClient.n)(`/api/cases/${caseId}/translate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path,lang})})).ok)throw new Error(t("failedToTranslate"))},onSuccess(){queryClient.invalidateQueries({queryKey:caseQueryKey(caseId)})},onError(){notify(t("failedToTranslate"))}});const progress="pending"===(null==caseData?void 0:caseData.analysisStatus)&&caseData.analysisProgress?caseData.analysisProgress:null,isPhotoReanalysis=Boolean(reanalyzingPhoto&&"pending"===(null==caseData?void 0:caseData.analysisStatus)),requestValue=progress?"upload"===progress.stage?progress.index>0?progress.index/progress.total*100:void 0:"stream"===progress.stage?Math.min(progress.received/progress.total*100,100):void 0:void 0,progressDescription=(0,react.useMemo)(()=>{if(progress){const prefix=progress.steps?`${t("stepPrefix",{step:progress.step,steps:progress.steps})} `:"";return"upload"===progress.stage?prefix+(progress.index>0?t("uploadingProgress",{index:progress.index,total:progress.total,percent:Math.floor(progress.index/progress.total*100),count:progress.total}):t("uploadingPhotos")):"retry"===progress.stage?prefix+t("analysisRestarting",{attempt:progress.attempt}):prefix+(progress.done?t("processingResults"):t("analyzingTokens",{received:progress.received,total:progress.total}))}return"pending"===(null==caseData?void 0:caseData.analysisStatus)?t("analyzingPhoto"):"canceled"===(null==caseData?void 0:caseData.analysisStatus)?t("analysisCanceled"):t("analysisFailed")},[progress,null==caseData?void 0:caseData.analysisStatus,t]),value={caseId,caseData,members,selectedPhoto,setSelectedPhoto,fileInputRef,refreshCase,updateVehicle,inviteMember:async function inviteMember(userId){if(!userId)return;(await(0,apiClient.n)(`/api/cases/${caseId}/invite`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId})})).ok?await refreshMembers():notify("Failed to invite collaborator.")},uploadFiles,handleUpload:async function handleUpload(e){const files=e.target.files;files&&await uploadFiles(files)},removeMember:async function removeMember(uid){(await(0,apiClient.n)(`/api/cases/${caseId}/members/${uid}`,{method:"DELETE"})).ok?await refreshMembers():notify("Failed to remove collaborator.")},analysisActive,copied,copyPublicUrl:async function copyPublicUrl(){const url=`${window.location.origin}${(0,basePath.h)(`/public/cases/${caseId}`)}`;await navigator.clipboard.writeText(url),setCopied(!0),setTimeout(()=>setCopied(!1),2e3)},reanalyzingPhoto,setReanalyzingPhoto,updateVin:value=>updateVinMutation.mutateAsync(value),clearVin:()=>clearVinMutation.mutateAsync(),updateNote:value=>updateNoteMutation.mutateAsync(value),updatePhotoNote:(photo,value)=>updatePhotoNoteMutation.mutateAsync({photo,value}).then(()=>{}),togglePublic:()=>togglePublicMutation.mutate(),toggleClosed:()=>toggleClosedMutation.mutate(),toggleArchived:()=>toggleArchivedMutation.mutate(),reanalyzePhoto:photo=>reanalyzePhotoMutation.mutateAsync({photo}).then(()=>{}),retryAnalysis:()=>retryAnalysisMutation.mutate(),removePhoto:photo=>removePhotoMutation.mutateAsync(photo),updatePlateNumber:function updatePlateNumber(value){return updateVehicle(value,(0,caseUtils.W7)(caseData)||"")},updatePlateState:function updatePlateState(value){return updateVehicle((0,caseUtils.qy)(caseData)||"",value)},clearPlateNumber:function clearPlateNumber(){return updateVehicle("",(0,caseUtils.W7)(caseData)||"")},clearPlateState:function clearPlateState(){return updateVehicle((0,caseUtils.qy)(caseData)||"","")},translate:(path,lang)=>translateMutation.mutateAsync({path,lang}).then(()=>{}),progress,progressDescription,requestValue,isPhotoReanalysis};return(0,jsx_runtime.jsx)(CaseContext.Provider,{value,children})}function useCaseContext(){const ctx=(0,react.useContext)(CaseContext);if(!ctx)throw new Error("useCaseContext must be used within CaseProvider");return ctx}function useOptionalCaseContext(){return(0,react.useContext)(CaseContext)}CaseProvider.__docgenInfo={description:"",methods:[],displayName:"CaseProvider",props:{children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},initialCase:{required:!0,tsType:{name:"union",raw:"Case | null",elements:[{name:"Case"},{name:"null"}]},description:""},caseId:{required:!0,tsType:{name:"string"},description:""}}}},"./src/app/components/DebugWrapper.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>DebugWrapper});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/index.js");var tooltip=__webpack_require__("./src/components/ui/tooltip.tsx"),publicEnv=__webpack_require__("./src/publicEnv.ts");function DebugWrapper({data,children,availableActions,unavailableActions,className}){const{NEXT_PUBLIC_BROWSER_DEBUG}=(0,publicEnv.j)(),enabled=Boolean(NEXT_PUBLIC_BROWSER_DEBUG),alt=function useAltKey(){const[pressed,setPressed]=(0,react.useState)(!1);return(0,react.useEffect)(()=>{const down=e=>{e.altKey&&setPressed(!0)},up=()=>setPressed(!1);return window.addEventListener("keydown",down),window.addEventListener("keyup",up),window.addEventListener("blur",up),()=>{window.removeEventListener("keydown",down),window.removeEventListener("keyup",up),window.removeEventListener("blur",up)}},[]),pressed}(),[refHover,setRefHover]=(0,react.useState)(!1),[open,setOpen]=(0,react.useState)(!1);(0,react.useEffect)(()=>{alt&&refHover&&setOpen(!0)},[alt,refHover]);const json=JSON.stringify(data,null,2),tokens=function tokenize(json){const tokens=[];let last=0;return json.replace(/(\"(?:\\u[a-fA-F0-9]{4}|\\[^u]|[^\\\"])*\"(?:\s*:)?|\b(?:true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(match,_p1,offset)=>{last<offset&&tokens.push(json.slice(last,offset));let cls="json-number";return/^\"/.test(match)?cls=/:$/.test(match)?"json-key":"json-string":/true|false/.test(match)?cls="json-boolean":/null/.test(match)&&(cls="json-null"),tokens.push((0,jsx_runtime.jsx)("span",{className:cls,children:match},tokens.length)),last=offset+match.length,""}),last<json.length&&tokens.push(json.slice(last)),tokens}(json);if(!enabled)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children});const show=alt&&refHover||open;return(0,jsx_runtime.jsx)(tooltip.A,{label:(0,jsx_runtime.jsxs)("div",{className:"text-xs bg-black/80 text-white p-2 rounded shadow max-w-sm max-h-60 overflow-auto relative space-y-1",children:[((null==availableActions?void 0:availableActions.length)||(null==unavailableActions?void 0:unavailableActions.length))&&(0,jsx_runtime.jsxs)("div",{className:"mb-1 space-y-1",children:[(null==availableActions?void 0:availableActions.length)?(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Available:"})," ",availableActions.join(", ")]}):null,(null==unavailableActions?void 0:unavailableActions.length)?(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Unavailable:"})," ",unavailableActions.join(", ")]}):null,(0,jsx_runtime.jsx)("hr",{})]}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>navigator.clipboard.writeText(json),className:"absolute top-1 right-1 underline",children:"Copy"}),(0,jsx_runtime.jsx)("pre",{className:"pt-4 whitespace-pre-wrap break-words",children:tokens})]}),open:show,onOpenChange:setOpen,interactive:!0,closeDelay:200,children:(0,jsx_runtime.jsx)("div",{onMouseEnter:()=>{setRefHover(!0),alt&&setOpen(!0)},onMouseLeave:()=>{setRefHover(!1)},className:null!=className?className:"inline-block",children})})}DebugWrapper.__docgenInfo={description:"",methods:[],displayName:"DebugWrapper",props:{data:{required:!0,tsType:{name:"unknown"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""},availableActions:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},unavailableActions:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}}},"./src/app/components/InlineTranslateButton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>InlineTranslateButton});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/index.js"),index_esm=__webpack_require__("__barrel_optimize__?names=FaBars,FaUserCircle!=!./node_modules/.pnpm/react-icons@4.12.0_react@19.1.0/node_modules/react-icons/fa/index.esm.js");const FLAGS={en:"ðŸ‡ºðŸ‡¸",es:"ðŸ‡ªðŸ‡¸",fr:"ðŸ‡«ðŸ‡·"};function TranslateIcon({lang,loading=!1,error=!1}){const flag=(0,react.useMemo)(()=>{var _FLAGS_lang;return null!==(_FLAGS_lang=FLAGS[lang])&&void 0!==_FLAGS_lang?_FLAGS_lang:"ðŸ³ï¸"},[lang]),ArrowIcon=error?index_esm.KP4:index_esm.Z0P;return(0,jsx_runtime.jsxs)("span",{className:"inline-flex items-center text-xs relative",children:[(0,jsx_runtime.jsx)(ArrowIcon,{className:"mr-0.5 "+(loading?"animate-translate-arrow":"")}),(0,jsx_runtime.jsxs)("span",{"aria-label":lang,className:"relative "+(loading?"animate-translate-flag":""),children:[flag,error?(0,jsx_runtime.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-red-600",children:"âœ–"}):null]})]})}function InlineTranslateButton({lang,onTranslate}){const[state,setState]=(0,react.useState)("idle");return(0,jsx_runtime.jsx)("button",{type:"button",onClick:async function handleClick(){if("loading"!==state){setState("loading");try{await Promise.resolve(onTranslate()),setState("idle")}catch(e){setState("error")}}},"aria-label":"translate",className:"ml-2 text-blue-500 hover:text-blue-700",children:(0,jsx_runtime.jsx)(TranslateIcon,{lang,loading:"loading"===state,error:"error"===state})})}TranslateIcon.__docgenInfo={description:"",methods:[],displayName:"TranslateIcon",props:{lang:{required:!0,tsType:{name:"string"},description:""},loading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},error:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}},InlineTranslateButton.__docgenInfo={description:"",methods:[],displayName:"InlineTranslateButton",props:{lang:{required:!0,tsType:{name:"string"},description:""},onTranslate:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void> | void",signature:{arguments:[],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""}}}},"./src/app/components/NotificationProvider.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>useNotify});__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/jsx-runtime.js");var react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/index.js");__webpack_require__("./node_modules/.pnpm/react-hot-toast@2.5.2_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/react-hot-toast/dist/index.mjs");const NotifyContext=(0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)(()=>{});function useNotify(){return(0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(NotifyContext)}},"./src/app/hooks/useEventSource.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useEventSource});var _apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/apiClient.ts"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/index.js");function useEventSource(url,onData){const cbRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(onData);(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{cbRef.current=onData},[onData]);const handleMessage=(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)(e=>{try{cbRef.current(JSON.parse(e.data))}catch(e){}},[]);(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(!url)return;const es=(0,_apiClient__WEBPACK_IMPORTED_MODULE_0__.a)(url);return es.onmessage=handleMessage,()=>es.close()},[url])}},"./src/app/useAddFilesToCase.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useAddFilesToCase});var _apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/apiClient.ts"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/@tanstack+react-query@5.81.5_react@19.1.0/node_modules/@tanstack/react-query/build/modern/useMutation.js"),next_navigation__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@storybook+nextjs@8.6.14_esbuild@0.25.5_next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@_htn273eqkwxmbpgcwhwcuzbpny/node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),react_i18next__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react-i18next@15.6.0_i18next@25.3.1_typescript@5.8.3__react-dom@19.1.0_react@19.1.0__react@19.1.0_typescript@5.8.3/node_modules/react-i18next/dist/es/index.js"),_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/app/components/NotificationProvider.tsx");function useAddFilesToCase(caseId){const router=(0,next_navigation__WEBPACK_IMPORTED_MODULE_1__.useRouter)(),notify=(0,_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_3__.l)(),{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_2__.Bd)(),uploadMutation=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_4__.n)({mutationFn:async formData=>(0,_apiClient__WEBPACK_IMPORTED_MODULE_0__.n)("/api/upload",{method:"POST",body:formData})});return async(files,gps)=>{if(!files||0===files.length)return;(await Promise.all(Array.from(files).map(file=>{const formData=new FormData;return formData.append("photo",file),formData.append("caseId",caseId),gps&&(formData.append("lat",String(gps.lat)),formData.append("lon",String(gps.lon))),uploadMutation.mutateAsync(formData)}))).some(r=>!r.ok)?notify(t("failedUpload")):router.push(`/cases/${caseId}`)}}},"./src/components/thumbnail-image.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>ThumbnailImage});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/index.js"),styled_system_css__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./styled-system/css/index.mjs");function ThumbnailImage({src,alt,width,height,className,imgClassName,...props}){const[ready,setReady]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[attempt,setAttempt]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(0);return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(ready)return;const timer=setInterval(()=>setAttempt(a=>a+1),2e3);return()=>clearInterval(timer)},[ready]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{style:{width,height},className:(0,styled_system_css__WEBPACK_IMPORTED_MODULE_2__.cx)((0,styled_system_css__WEBPACK_IMPORTED_MODULE_2__.AH)({position:"relative",overflow:"hidden"}),className),children:[!ready&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:(0,styled_system_css__WEBPACK_IMPORTED_MODULE_2__.AH)({position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:{base:"gray.200",_dark:"gray.800"}}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:(0,styled_system_css__WEBPACK_IMPORTED_MODULE_2__.AH)({width:"6",height:"6",borderWidth:"2px",borderColor:"gray.500",borderTopColor:"transparent",borderRadius:"full",animation:"spin"})})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("img",{src:`${src}${attempt?`?${attempt}`:""}`,alt:null!=alt?alt:"",width,height,onLoad:()=>setReady(!0),onError:()=>setReady(!1),className:(0,styled_system_css__WEBPACK_IMPORTED_MODULE_2__.cx)((0,styled_system_css__WEBPACK_IMPORTED_MODULE_2__.AH)({objectFit:"cover",maxW:"full",maxH:"full"}),imgClassName,ready?void 0:(0,styled_system_css__WEBPACK_IMPORTED_MODULE_2__.AH)({visibility:"hidden"})),loading:"lazy",...props})]})}ThumbnailImage.__docgenInfo={description:"",methods:[],displayName:"ThumbnailImage",props:{src:{required:!0,tsType:{name:"string"},description:""},alt:{required:!0,tsType:{name:"string"},description:""},width:{required:!0,tsType:{name:"number"},description:""},height:{required:!0,tsType:{name:"number"},description:""},imgClassName:{required:!1,tsType:{name:"string"},description:""}},composes:["Omit"]}},"./src/components/ui/tooltip.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>Tooltip});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/jsx-runtime.js"),_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/@floating-ui+react@0.27.13_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/@floating-ui/react/dist/floating-ui.react.mjs"),_floating_ui_react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/@floating-ui+react-dom@2.1.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/@floating-ui/react-dom/dist/floating-ui.react-dom.mjs"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/next@15.3.3_@babel+core@7.7.4_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/compiled/react/index.js"),styled_system_css__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./styled-system/css/index.mjs");function Tooltip({label,children,placement="top",open:controlledOpen,onOpenChange,interactive=!1,closeDelay=0}){const[uncontrolledOpen,setUncontrolledOpen]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),open=null!=controlledOpen?controlledOpen:uncontrolledOpen,setOpen=null!=onOpenChange?onOpenChange:setUncontrolledOpen,{refs,floatingStyles,context}=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.we)({open,onOpenChange:setOpen,middleware:[(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_4__.cY)(5),(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_4__.UU)(),(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_4__.BN)({padding:5})],placement}),hover=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.Mk)(context,{enabled:void 0===controlledOpen,move:!1,handleClose:interactive?(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.iB)():void 0,delay:{close:closeDelay}}),focus=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.iQ)(context,{enabled:void 0===controlledOpen}),dismiss=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.s9)(context),role=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.It)(context,{role:"tooltip"}),{getReferenceProps,getFloatingProps}=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.bv)([hover,focus,dismiss,role]),referenceProps=getReferenceProps({ref:refs.setReference});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[(0,react__WEBPACK_IMPORTED_MODULE_1__.cloneElement)(children,referenceProps),open&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.XF,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{ref:refs.setFloating,style:floatingStyles,...getFloatingProps(),className:(0,styled_system_css__WEBPACK_IMPORTED_MODULE_2__.AH)({zIndex:"var(--z-tooltip)",borderRadius:"md",backgroundColor:"rgba(0,0,0,0.8)",px:"2",py:"1",fontSize:"xs",color:"white",shadow:"md"}),children:label})})]})}Tooltip.__docgenInfo={description:"",methods:[],displayName:"Tooltip",props:{label:{required:!0,tsType:{name:"union",raw:"ReactElement | string",elements:[{name:"ReactElement"},{name:"string"}]},description:""},children:{required:!0,tsType:{name:"ReactElement"},description:""},placement:{required:!1,tsType:{name:"Placement"},description:"",defaultValue:{value:'"top"',computed:!1}},open:{required:!1,tsType:{name:"boolean"},description:""},onOpenChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(open: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"open"}],return:{name:"void"}}},description:""},interactive:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},closeDelay:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0",computed:!1}}}}},"./src/lib/caseActions.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E:()=>caseActions,r:()=>getCaseActionStatus});var _caseUtils__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/lib/caseUtils.ts"),_reportModules__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/lib/reportModules.ts");const caseActions=[{id:"compose",label:"Draft Report",href:id=>`/cases/${id}/compose`,description:"Open a modal to draft an email report to the relevant authority. Use when the user wants to formally report the violation."},{id:"followup",label:"Follow Up",href:id=>`/cases/${id}/followup`,description:"Send a follow-up email referencing previous correspondence. Suggest this when the user needs to check the status of a prior report."},{id:"notify-owner",label:"Notify Owner",href:id=>`/cases/${id}/notify-owner`,description:"Send an anonymous notice to the vehicle owner about the violation. Useful when the owner might not know they were reported."},{id:"ownership",label:"Request Ownership Info",href:id=>`/cases/${id}/ownership`,description:"Record the steps for requesting official ownership details from the state. Use if the license plate is known but contact info is missing."},{id:"view-ownership-request",label:"View Ownership Request",href:id=>`/cases/${id}/ownership-request`,description:"View the most recent ownership information request email."},{id:"upload-photo",label:"Upload Photo",href:id=>`/upload?case=${id}`,description:"Upload an existing photo to this case."},{id:"take-photo",label:"Take Photo",href:id=>`/point?case=${id}`,description:"Use your camera to take a new photo for this case."}];function getCaseActionStatus(c){var _getCaseOwnerContactInfo;const ownerEmail=null===(_getCaseOwnerContactInfo=(0,_caseUtils__WEBPACK_IMPORTED_MODULE_0__.sC)(c))||void 0===_getCaseOwnerContactInfo?void 0:_getCaseOwnerContactInfo.email,authority=_reportModules__WEBPACK_IMPORTED_MODULE_1__.u["oak-park"].authorityEmail;return caseActions.map(a=>{let reason,applicable=!0;switch(a.id){case"compose":var _c_sentEmails;"complete"===c.analysisStatus&&(0,_caseUtils__WEBPACK_IMPORTED_MODULE_0__.u5)(c)?(null!==(_c_sentEmails=c.sentEmails)&&void 0!==_c_sentEmails?_c_sentEmails:[]).some(e=>e.to===authority)&&(applicable=!1,reason="already reported"):(applicable=!1,reason="analysis incomplete or no violation");break;case"followup":var _c_sentEmails1,_c_sentEmails2;(null!==(_c_sentEmails1=c.sentEmails)&&void 0!==_c_sentEmails1?_c_sentEmails1:[]).some(e=>e.to===authority)?(null!==(_c_sentEmails2=c.sentEmails)&&void 0!==_c_sentEmails2?_c_sentEmails2:[]).some(e=>e.to===authority&&e.replyTo)&&(applicable=!1,reason="follow-up already sent"):(applicable=!1,reason="no prior report");break;case"notify-owner":var _c_sentEmails3;ownerEmail?(null!==(_c_sentEmails3=c.sentEmails)&&void 0!==_c_sentEmails3?_c_sentEmails3:[]).some(e=>e.to===ownerEmail)&&(applicable=!1,reason="owner already notified"):(applicable=!1,reason="no owner contact info");break;case"ownership":var _c_ownershipRequests;(0,_caseUtils__WEBPACK_IMPORTED_MODULE_0__.g_)(c)?(applicable=!1,reason="owner contact already known"):(0,_caseUtils__WEBPACK_IMPORTED_MODULE_0__.qy)(c)||(0,_caseUtils__WEBPACK_IMPORTED_MODULE_0__.W7)(c)?(null!==(_c_ownershipRequests=c.ownershipRequests)&&void 0!==_c_ownershipRequests?_c_ownershipRequests:[]).length>0&&(applicable=!1,reason="ownership info already requested"):(applicable=!1,reason="missing license plate info");break;case"view-ownership-request":var _c_ownershipRequests1;applicable=(null!==(_c_ownershipRequests1=c.ownershipRequests)&&void 0!==_c_ownershipRequests1?_c_ownershipRequests1:[]).length>0}return{...a,applicable,reason}})}},"./src/lib/caseUtils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Pk:()=>getAnalysisSummary,_g:()=>getBestViolationPhoto,g_:()=>getCaseOwnerContact,sC:()=>getCaseOwnerContactInfo,qy:()=>getCasePlateNumber,W7:()=>getCasePlateState,E5:()=>getCaseVin,cy:()=>getLatestOwnershipRequestLink,qR:()=>getOfficialCaseGps,wq:()=>getRepresentativePhoto,u5:()=>hasCaseViolation});var i18next=__webpack_require__("./node_modules/.pnpm/i18next@25.3.1_typescript@5.8.3/node_modules/i18next/dist/esm/i18next.js");__webpack_require__("./public/locales/en/common.json"),__webpack_require__("./public/locales/es/common.json"),__webpack_require__("./public/locales/fr/common.json");const instance=i18next.Ay.createInstance();const i18n_server=instance;function basename(filePath){const parts=filePath.split(/[\\/]/);return parts[parts.length-1]}function getRepresentativePhoto(caseData){var _caseData_analysis;if(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images){const best=Object.entries(caseData.analysis.images).sort((a,b)=>b[1].representationScore-a[1].representationScore)[0];if(best){const name=best[0],file=caseData.photos.find(p=>basename(p)===name);if(file)return file}}const sorted=[...caseData.photos].sort();return sorted.length>0?sorted[0]:null}function getOfficialCaseGps(caseData){var _caseData_analysis,_caseData_gps;if((null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)&&caseData.photoGps){const entries=Object.entries(caseData.analysis.images).sort((a,b)=>b[1].representationScore-a[1].representationScore);for(const[name]of entries){const file=caseData.photos.find(p=>basename(p)===name);if(file){const gps=caseData.photoGps[file];if(gps)return gps}}}if(caseData.photoGps)for(const p of caseData.photos){const g=caseData.photoGps[p];if(g)return g}return null!==(_caseData_gps=caseData.gps)&&void 0!==_caseData_gps?_caseData_gps:null}function hasCaseViolation(c){return!!c.violationOverride||function hasViolation(report){var _report_violationType;if(!report)return!1;if(report.images){const all=Object.values(report.images),hasTrue=all.some(i=>!0===i.violation),hasFalse=all.some(i=>!1===i.violation);if(hasTrue||hasFalse)return hasTrue}return Boolean(null===(_report_violationType=report.violationType)||void 0===_report_violationType?void 0:_report_violationType.trim())}(c.analysis)}function getCaseVin(caseData){var _caseData_analysis;if(caseData.vin)return caseData.vin;const imgs=(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const vin=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.vin;if(vin)return vin}return null}function getCasePlateNumber(caseData){var _caseData_analysis_vehicle,_caseData_analysis,_caseData_analysis1;const direct=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis||null===(_caseData_analysis_vehicle=_caseData_analysis.vehicle)||void 0===_caseData_analysis_vehicle?void 0:_caseData_analysis_vehicle.licensePlateNumber;if(direct)return direct;const imgs=(null===(_caseData_analysis1=caseData.analysis)||void 0===_caseData_analysis1?void 0:_caseData_analysis1.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const plate=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.licensePlateNumber;if(plate)return plate}return null}function getCasePlateState(caseData){var _caseData_analysis_vehicle,_caseData_analysis,_caseData_analysis1;const direct=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis||null===(_caseData_analysis_vehicle=_caseData_analysis.vehicle)||void 0===_caseData_analysis_vehicle?void 0:_caseData_analysis_vehicle.licensePlateState;if(direct)return direct;const imgs=(null===(_caseData_analysis1=caseData.analysis)||void 0===_caseData_analysis1?void 0:_caseData_analysis1.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const state=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.licensePlateState;if(state)return state}return null}function getCaseOwnerContact(caseData){var _caseData_analysis;const imgs=(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo;const contact=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo?void 0:_info_paperworkInfo.contact;if(contact)return contact}return null}function getCaseOwnerContactInfo(caseData){const contact=getCaseOwnerContact(caseData);return contact?function parseContactInfo(text){const emailMatch=text.match(/[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}/),phoneMatch=text.match(/\+?\d[\d\s().-]{7,}\d/);let address;return text.trim().split(/\n+/).length>1&&(address=text.trim()),{email:emailMatch?emailMatch[0]:void 0,phone:phoneMatch?phoneMatch[0]:void 0,address}}(contact):null}function getLatestOwnershipRequestLink(caseData){var _caseData_sentEmails;const email=[...null!==(_caseData_sentEmails=caseData.sentEmails)&&void 0!==_caseData_sentEmails?_caseData_sentEmails:[]].filter(m=>"Ownership information request"===m.subject).sort((a,b)=>b.sentAt.localeCompare(a.sentAt))[0];return email?`/cases/${caseData.id}/thread/${encodeURIComponent(email.sentAt)}`:null}function getBestViolationPhoto(caseData){var _caseData_analysis,_info_highlights,_info_highlights1,_caseData_analysis_images;const imgs=null!==(_caseData_analysis_images=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)&&void 0!==_caseData_analysis_images?_caseData_analysis_images:{},entries=Object.entries(imgs).filter(([,info])=>info.violation).sort((a,b)=>b[1].representationScore-a[1].representationScore),best=entries[0];if(!best)return null;const[name,info]=best,file=caseData.photos.find(p=>basename(p)===name);if(!file)return null;var _info_highlights_i18n_language,_info_highlights2,_ref;return{photo:file,caption:"string"==typeof info.highlights?info.highlights:null!==(_ref=null!==(_info_highlights_i18n_language=null===(_info_highlights=info.highlights)||void 0===_info_highlights?void 0:_info_highlights[i18n_server.language])&&void 0!==_info_highlights_i18n_language?_info_highlights_i18n_language:null===(_info_highlights1=info.highlights)||void 0===_info_highlights1?void 0:_info_highlights1.en)&&void 0!==_ref?_ref:Object.values(null!==(_info_highlights2=info.highlights)&&void 0!==_info_highlights2?_info_highlights2:{})[0]}}function getAnalysisSummary(report){var _report_vehicle,_report_vehicle1,_report_details_i18n_language,_ref,_ref1;const detailText="string"==typeof report.details?report.details:null!==(_ref1=null!==(_ref=null!==(_report_details_i18n_language=report.details[i18n_server.language])&&void 0!==_report_details_i18n_language?_report_details_i18n_language:report.details.en)&&void 0!==_ref?_ref:Object.values(report.details)[0])&&void 0!==_ref1?_ref1:"",parts=[`Violation: ${report.violationType}`,detailText];report.location&&parts.push(`Location: ${report.location}`);const plate=[];return(null===(_report_vehicle=report.vehicle)||void 0===_report_vehicle?void 0:_report_vehicle.licensePlateState)&&plate.push(report.vehicle.licensePlateState),(null===(_report_vehicle1=report.vehicle)||void 0===_report_vehicle1?void 0:_report_vehicle1.licensePlateNumber)&&plate.push(report.vehicle.licensePlateNumber),plate.length>0&&parts.push(`Plate: ${plate.join(" ")}`),parts.filter(Boolean).join("\n")}},"./src/lib/clientThumbnails.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function getThumbnailUrl(url,size){return`/uploads/thumbs/${size}/${url.substring(url.lastIndexOf("/")+1)}`}__webpack_require__.d(__webpack_exports__,{s:()=>getThumbnailUrl})},"./src/lib/localizedText.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function getLocalizedText(textMap,lang){if(!textMap)return{text:"",needsTranslation:!1};if("string"==typeof textMap)return{text:textMap,needsTranslation:!1};var _textMap_lang,_ref,_ref1;return{text:null!==(_ref1=null!==(_ref=null!==(_textMap_lang=textMap[lang])&&void 0!==_textMap_lang?_textMap_lang:textMap.en)&&void 0!==_ref?_ref:Object.values(textMap)[0])&&void 0!==_ref1?_ref1:"",needsTranslation:!(lang in textMap)}}__webpack_require__.d(__webpack_exports__,{P:()=>getLocalizedText})},"./src/lib/reportModules.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{u:()=>reportModules});const reportModules={"oak-park":{id:"oak-park",authorityName:"Oak Park Police Department",authorityEmail:"police@oak-park.us",authorityAddress:"123 Madison St\nOak Park, IL 60302"}}}}]);