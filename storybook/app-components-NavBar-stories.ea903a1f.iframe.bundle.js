"use strict";(self.webpackChunkapp_scaffold=self.webpackChunkapp_scaffold||[]).push([[1360],{"./src/app/components/NavBar.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>NavBar_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),useNewCaseFromFiles=__webpack_require__("./src/app/useNewCaseFromFiles.ts"),useSession=__webpack_require__("./src/app/useSession.ts"),dist=__webpack_require__("./node_modules/@radix-ui/react-popover/dist/index.mjs"),next_link=__webpack_require__("./node_modules/next/link.js"),link_default=__webpack_require__.n(next_link),navigation=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),index_esm=__webpack_require__("__barrel_optimize__?names=FaBars,FaUserCircle!=!./node_modules/react-icons/fa/index.esm.js"),i18next=__webpack_require__("./node_modules/i18next/dist/esm/i18next.js");__webpack_require__("./public/locales/en/common.json"),__webpack_require__("./public/locales/es/common.json"),__webpack_require__("./public/locales/fr/common.json");const instance=i18next.Ay.createInstance();const i18n=instance,FLAGS_en="ðŸ‡ºðŸ‡¸",FLAGS_es="ðŸ‡ªðŸ‡¸",FLAGS_fr="ðŸ‡«ðŸ‡·",LABELS_en="English",LABELS_es="EspaÃ±ol",LABELS_fr="FranÃ§ais";function LanguageSwitcher(){return(0,jsx_runtime.jsxs)("select",{className:"border rounded p-1 text-sm bg-white dark:bg-gray-800",value:i18n.language,onChange:e=>{const lang=e.target.value;document.cookie=`language=${lang}; path=/; max-age=31536000`,i18n.changeLanguage(lang)},children:[(0,jsx_runtime.jsx)("option",{value:"en","aria-label":LABELS_en,children:FLAGS_en}),(0,jsx_runtime.jsx)("option",{value:"es","aria-label":LABELS_es,children:FLAGS_es}),(0,jsx_runtime.jsx)("option",{value:"fr","aria-label":LABELS_fr,children:FLAGS_fr})]})}function NavBar(){var _session_user,_session_user1,_session_user2,_session_user3,_session_user4;const pathname=(0,navigation.usePathname)(),uploadCase=(0,useNewCaseFromFiles.A)(),inputRef=(0,react.useRef)(null),{data:session}=(0,useSession.wV)(),{t}=(0,es.Bd)(),[menuOpen,setMenuOpen]=(0,react.useState)(!1);if(pathname.startsWith("/point"))return(0,jsx_runtime.jsx)("nav",{className:"p-2 flex justify-end bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100",children:(0,jsx_runtime.jsx)(link_default(),{href:"/cases",className:"text-sm underline",children:t("nav.cases")})});const navLinks=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("button",{type:"button",className:"hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>{var _inputRef_current;setMenuOpen(!1),null===(_inputRef_current=inputRef.current)||void 0===_inputRef_current||_inputRef_current.click()},children:t("nav.newCaseFromImage")}),(0,jsx_runtime.jsx)(link_default(),{href:"/point",className:"hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>setMenuOpen(!1),children:t("nav.pointShoot")}),(0,jsx_runtime.jsx)(link_default(),{href:"/cases",className:"hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>setMenuOpen(!1),children:t("nav.cases")}),(0,jsx_runtime.jsx)(link_default(),{href:"/map",className:"hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>setMenuOpen(!1),children:t("nav.mapView")}),session?(0,jsx_runtime.jsx)(link_default(),{href:"/triage",className:"hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>setMenuOpen(!1),children:t("nav.triage")}):null,"admin"===(null==session||null===(_session_user=session.user)||void 0===_session_user?void 0:_session_user.role)||"superadmin"===(null==session||null===(_session_user1=session.user)||void 0===_session_user1?void 0:_session_user1.role)?(0,jsx_runtime.jsx)(link_default(),{href:"/admin",className:"hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>setMenuOpen(!1),children:t("nav.admin")}):null,"superadmin"===(null==session||null===(_session_user2=session.user)||void 0===_session_user2?void 0:_session_user2.role)?(0,jsx_runtime.jsx)(link_default(),{href:"/system-status",className:"hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>setMenuOpen(!1),children:t("nav.systemStatus")}):null]}),userMenu=(0,jsx_runtime.jsxs)("details",{className:"relative",onToggle:()=>setMenuOpen(!1),children:[(0,jsx_runtime.jsx)("summary",{className:"cursor-pointer list-none flex items-center",children:(null==session||null===(_session_user3=session.user)||void 0===_session_user3?void 0:_session_user3.image)?(0,jsx_runtime.jsx)("img",{src:session.user.image,alt:"avatar",className:"w-6 h-6 rounded-full object-cover"}):(0,jsx_runtime.jsx)(index_esm.NBi,{className:"w-6 h-6"})}),(0,jsx_runtime.jsx)("div",{className:"absolute right-0 mt-1 bg-white dark:bg-gray-900 border rounded shadow text-sm",children:session?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(link_default(),{href:"/settings",className:"block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700",children:t("nav.userSettings")}),(0,jsx_runtime.jsx)(link_default(),{href:`/public/users/${null===(_session_user4=session.user)||void 0===_session_user4?void 0:_session_user4.id}`,className:"block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700",children:t("nav.publicProfile")}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>(0,useSession.CI)(),className:"block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left",children:t("nav.signOut")})]}):(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>(0,useSession.Jv)(),className:"block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left",children:t("nav.signIn")})})]});return(0,jsx_runtime.jsxs)("nav",{className:"py-4 px-8 flex items-center justify-between bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 relative sticky top-0 z-nav",children:[(0,jsx_runtime.jsx)(link_default(),{href:"/",className:"text-lg font-semibold hover:text-gray-600 dark:hover:text-gray-300",children:t("title")}),(0,jsx_runtime.jsx)("input",{type:"file",accept:"image/*",multiple:!0,hidden:!0,ref:inputRef,onChange:e=>uploadCase(e.target.files)}),(0,jsx_runtime.jsxs)("div",{className:"hidden sm:flex gap-4 sm:gap-6 md:gap-8 text-sm items-center",children:[navLinks,(0,jsx_runtime.jsx)(LanguageSwitcher,{}),userMenu]}),(0,jsx_runtime.jsxs)("div",{className:"sm:hidden flex items-center gap-2",children:[(0,jsx_runtime.jsxs)(dist.bL,{open:menuOpen,onOpenChange:setMenuOpen,children:[(0,jsx_runtime.jsx)(dist.l9,{asChild:!0,children:(0,jsx_runtime.jsx)("button",{type:"button",className:"sm:hidden text-xl p-2 hover:text-gray-600 dark:hover:text-gray-300","aria-label":t("menu"),children:(0,jsx_runtime.jsx)(index_esm.OXb,{})})}),(0,jsx_runtime.jsx)(dist.ZL,{children:(0,jsx_runtime.jsxs)(dist.UC,{sideOffset:4,className:"sm:hidden flex flex-col gap-2 text-sm bg-gray-100 dark:bg-gray-900 border rounded shadow p-4",children:[navLinks,(0,jsx_runtime.jsx)(LanguageSwitcher,{})]})})]}),userMenu]})]})}LanguageSwitcher.__docgenInfo={description:"",methods:[],displayName:"LanguageSwitcher"},NavBar.__docgenInfo={description:"",methods:[],displayName:"NavBar"};const NavBar_stories={component:NavBar,title:"Components/NavBar"},Default={render:()=>(0,jsx_runtime.jsx)(NavBar,{})},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  render: () => <NavBar />\n}",...Default.parameters?.docs?.source}}}},"./src/app/useNewCaseFromFiles.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useNewCaseFromFiles});var _apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/apiClient.ts"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useMutation.js"),next_navigation__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),react_i18next__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/app/components/NotificationProvider.tsx");function useNewCaseFromFiles(){const router=(0,next_navigation__WEBPACK_IMPORTED_MODULE_1__.useRouter)(),notify=(0,_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_3__.l)(),{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_2__.Bd)(),uploadMutation=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_4__.n)({mutationFn:async formData=>(0,_apiClient__WEBPACK_IMPORTED_MODULE_0__.n)("/api/upload",{method:"POST",body:formData})});return async(files,gps)=>{if(!files||0===files.length)return;const id=crypto.randomUUID(),preview=URL.createObjectURL(files[0]);sessionStorage.setItem(`preview-${id}`,preview);(await Promise.all(Array.from(files).map((file,idx)=>{const formData=new FormData;formData.append("photo",file),formData.append("caseId",id),gps&&(formData.append("lat",String(gps.lat)),formData.append("lon",String(gps.lon)));const upload=uploadMutation.mutateAsync(formData);return 0===idx&&upload.then(()=>{sessionStorage.removeItem(`preview-${id}`)}),upload}))).some(r=>!r.ok)?notify(t("failedUpload")):router.push(`/cases/${id}`)}}},"./src/app/useSession.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{CI:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.signOut,Jv:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.signIn,wV:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.useSession});var next_auth_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next-auth/react/index.js")}}]);