"use strict";(self.webpackChunkapp_scaffold=self.webpackChunkapp_scaffold||[]).push([[606],{"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!./node_modules/postcss-loader/dist/cjs.js!./src/app/cases/[id]/CaseChat.module.css":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,'.CaseChat_bubble__CZgum {\n  position: relative;\n  display: inline-block;\n  max-width: 100%;\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n}\n\n.CaseChat_user__ux9N4 {\n  background-color: rgb(37, 99, 235); /* blue-600 */\n  color: white;\n}\n.CaseChat_user__ux9N4::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  right: -0.25rem;\n  border-width: 0.4rem 0 0.4rem 0.4rem;\n  border-style: solid;\n  border-color: transparent transparent transparent rgb(37, 99, 235);\n}\n\n@media (prefers-color-scheme: dark) {\n  .CaseChat_user__ux9N4 {\n    background-color: rgb(29, 78, 216); /* blue-700 */\n  }\n  .CaseChat_user__ux9N4::after {\n    border-left-color: rgb(29, 78, 216);\n  }\n}\n\n.CaseChat_assistant__BSx_p {\n  background-color: rgb(229, 231, 235); /* gray-200 */\n}\n.CaseChat_assistant__BSx_p::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(229, 231, 235) transparent transparent;\n}\n\n.CaseChat_error__nvroa {\n  background-color: rgb(220, 38, 38); /* red-600 */\n  color: white;\n}\n.CaseChat_error__nvroa::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(220, 38, 38) transparent transparent;\n}\n\n@media (prefers-color-scheme: dark) {\n  .CaseChat_assistant__BSx_p {\n    background-color: rgb(55, 65, 81); /* gray-700 */\n    color: white;\n  }\n  .CaseChat_assistant__BSx_p::after {\n    border-right-color: rgb(55, 65, 81);\n  }\n}\n\n@keyframes CaseChat_typing-ellipsis__fDGZx {\n  to {\n    width: 1.2em;\n  }\n}\n\n.CaseChat_typing__0BvNE::after {\n  content: "...";\n  overflow: hidden;\n  display: inline-block;\n  vertical-align: bottom;\n  width: 0;\n  animation: CaseChat_typing-ellipsis__fDGZx 1s steps(4, end) infinite;\n}\n',"",{version:3,sources:["webpack://./src/app/cases/[id]/CaseChat.module.css"],names:[],mappings:"AAAA;EACE,kBAAkB;EAClB,qBAAqB;EACrB,eAAe;EACf,uBAAuB;EACvB,sBAAsB;AACxB;;AAEA;EACE,kCAAkC,EAAE,aAAa;EACjD,YAAY;AACd;AACA;EACE,WAAW;EACX,kBAAkB;EAClB,eAAe;EACf,eAAe;EACf,oCAAoC;EACpC,mBAAmB;EACnB,kEAAkE;AACpE;;AAEA;EACE;IACE,kCAAkC,EAAE,aAAa;EACnD;EACA;IACE,mCAAmC;EACrC;AACF;;AAEA;EACE,oCAAoC,EAAE,aAAa;AACrD;AACA;EACE,WAAW;EACX,kBAAkB;EAClB,eAAe;EACf,cAAc;EACd,oCAAoC;EACpC,mBAAmB;EACnB,oEAAoE;AACtE;;AAEA;EACE,kCAAkC,EAAE,YAAY;EAChD,YAAY;AACd;AACA;EACE,WAAW;EACX,kBAAkB;EAClB,eAAe;EACf,cAAc;EACd,oCAAoC;EACpC,mBAAmB;EACnB,kEAAkE;AACpE;;AAEA;EACE;IACE,iCAAiC,EAAE,aAAa;IAChD,YAAY;EACd;EACA;IACE,mCAAmC;EACrC;AACF;;AAEA;EACE;IACE,YAAY;EACd;AACF;;AAEA;EACE,cAAc;EACd,gBAAgB;EAChB,qBAAqB;EACrB,sBAAsB;EACtB,QAAQ;EACR,oEAAoD;AACtD",sourcesContent:['.bubble {\n  position: relative;\n  display: inline-block;\n  max-width: 100%;\n  padding: 0.25rem 0.5rem;\n  border-radius: 0.25rem;\n}\n\n.user {\n  background-color: rgb(37, 99, 235); /* blue-600 */\n  color: white;\n}\n.user::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  right: -0.25rem;\n  border-width: 0.4rem 0 0.4rem 0.4rem;\n  border-style: solid;\n  border-color: transparent transparent transparent rgb(37, 99, 235);\n}\n\n@media (prefers-color-scheme: dark) {\n  .user {\n    background-color: rgb(29, 78, 216); /* blue-700 */\n  }\n  .user::after {\n    border-left-color: rgb(29, 78, 216);\n  }\n}\n\n.assistant {\n  background-color: rgb(229, 231, 235); /* gray-200 */\n}\n.assistant::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(229, 231, 235) transparent transparent;\n}\n\n.error {\n  background-color: rgb(220, 38, 38); /* red-600 */\n  color: white;\n}\n.error::after {\n  content: "";\n  position: absolute;\n  bottom: 0.25rem;\n  left: -0.25rem;\n  border-width: 0.4rem 0.4rem 0.4rem 0;\n  border-style: solid;\n  border-color: transparent rgb(220, 38, 38) transparent transparent;\n}\n\n@media (prefers-color-scheme: dark) {\n  .assistant {\n    background-color: rgb(55, 65, 81); /* gray-700 */\n    color: white;\n  }\n  .assistant::after {\n    border-right-color: rgb(55, 65, 81);\n  }\n}\n\n@keyframes typing-ellipsis {\n  to {\n    width: 1.2em;\n  }\n}\n\n.typing::after {\n  content: "...";\n  overflow: hidden;\n  display: inline-block;\n  vertical-align: bottom;\n  width: 0;\n  animation: typing-ellipsis 1s steps(4, end) infinite;\n}\n'],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={bubble:"CaseChat_bubble__CZgum",user:"CaseChat_user__ux9N4",assistant:"CaseChat_assistant__BSx_p",error:"CaseChat_error__nvroa",typing:"CaseChat_typing__0BvNE","typing-ellipsis":"CaseChat_typing-ellipsis__fDGZx"};const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___},"./src/app/cases/[id]/CaseChat.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>CaseChat});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),apiClient=__webpack_require__("./src/apiClient.ts"),thumbnail_image=__webpack_require__("./src/components/thumbnail-image.tsx");__webpack_require__("./src/lib/reportModules.ts");const caseActions=[{id:"compose",label:"Draft Report",href:id=>`/cases/${id}/compose`,description:"Open a modal to draft an email report to the relevant authority. Use when the user wants to formally report the violation."},{id:"followup",label:"Follow Up",href:id=>`/cases/${id}/followup`,description:"Send a follow-up email referencing previous correspondence. Suggest this when the user needs to check the status of a prior report."},{id:"notify-owner",label:"Notify Owner",href:id=>`/cases/${id}/notify-owner`,description:"Send an anonymous notice to the vehicle owner about the violation. Useful when the owner might not know they were reported."},{id:"ownership",label:"Request Ownership Info",href:id=>`/cases/${id}/ownership`,description:"Record the steps for requesting official ownership details from the state. Use if the license plate is known but contact info is missing."},{id:"upload-photo",label:"Upload Photo",href:id=>`/upload?case=${id}`,description:"Upload an existing photo to this case."},{id:"take-photo",label:"Take Photo",href:id=>`/point?case=${id}`,description:"Use your camera to take a new photo for this case."}];var clientThumbnails=__webpack_require__("./src/lib/clientThumbnails.ts"),navigation=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),NotificationProvider=__webpack_require__("./src/app/components/NotificationProvider.tsx");const CaseChatContext=(0,react.createContext)(null);function useCaseChat(){const ctx=(0,react.useContext)(CaseChatContext);if(!ctx)throw new Error("CaseChatContext missing");return ctx}function CaseChatProvider({caseId,onChat,expanded:controlledExpanded,onExpandChange,children}){const[open,setOpen]=(0,react.useState)(!1),[expandedState,setExpandedState]=(0,react.useState)(!1),expanded=null!=controlledExpanded?controlledExpanded:expandedState,[messages,setMessages]=(0,react.useState)([]),[history,setHistory]=(0,react.useState)([]),[sessionId,setSessionId]=(0,react.useState)(null),[sessionCreatedAt,setSessionCreatedAt]=(0,react.useState)(""),[sessionSummary,setSessionSummary]=(0,react.useState)(""),[systemPrompt,setSystemPrompt]=(0,react.useState)(""),[availableActions,setAvailableActions]=(0,react.useState)([]),[unavailableActions,setUnavailableActions]=(0,react.useState)([]),[input,setInput]=(0,react.useState)(""),[loading,setLoading]=(0,react.useState)(!1),scrollRef=(0,react.useRef)(null),inputRef=(0,react.useRef)(null),[showJump,setShowJump]=(0,react.useState)(!1),abortRef=(0,react.useRef)(null),openRef=(0,react.useRef)(open),saveCurrentSessionRef=(0,react.useRef)(()=>{}),[photoMap,setPhotoMap]=(0,react.useState)({});(0,react.useEffect)(()=>{openRef.current=open},[open]);const[draftData,setDraftData]=(0,react.useState)(null),[draftLoading,setDraftLoading]=(0,react.useState)(!1),[cameraOpen,setCameraOpen]=(0,react.useState)(!1),[draftAnchorId,setDraftAnchorId]=(0,react.useState)(null),[cameraAnchorId,setCameraAnchorId]=(0,react.useState)(null),notify=(0,NotificationProvider.l)(),[chatError,setChatError]=(0,react.useState)(null),storageKey=`case-chat-${caseId}`,stateKey=`case-chat-state-${caseId}`,loadHistory=(0,react.useCallback)(()=>{try{const raw=localStorage.getItem(storageKey);return raw?JSON.parse(raw):[]}catch(e){return[]}},[storageKey]),saveHistory=(0,react.useCallback)(list=>{localStorage.setItem(storageKey,JSON.stringify(list))},[storageKey]),loadState=(0,react.useCallback)(()=>{try{const raw=localStorage.getItem(stateKey);return raw?JSON.parse(raw):null}catch(e){return null}},[stateKey]),saveState=(0,react.useCallback)(state=>{localStorage.setItem(stateKey,JSON.stringify(state))},[stateKey]);(0,react.useEffect)(()=>{setHistory(loadHistory())},[loadHistory]);const loadPhotos=(0,react.useCallback)(async()=>{const res=await(0,apiClient.n)(`/api/cases/${caseId}`);if(!res.ok)return;const data=await res.json(),map={};var _data_photos;for(const url of null!==(_data_photos=data.photos)&&void 0!==_data_photos?_data_photos:[]){const parts=url.split(/[\\/]/);map[parts[parts.length-1]]=url}setPhotoMap(map)},[caseId]);function startNew(){setMessages([]),setSessionId(crypto.randomUUID()),setSessionCreatedAt((new Date).toISOString()),setSessionSummary(""),setSystemPrompt(""),setAvailableActions([]),setUnavailableActions([]),setDraftAnchorId(null),setCameraAnchorId(null)}async function openDraft(anchorId){setDraftAnchorId(null!=anchorId?anchorId:null),setDraftLoading(!0),setDraftData(null);const res=await(0,apiClient.n)(`/api/cases/${caseId}/report`);if(res.ok){const data=await res.json();setDraftData(data)}else{const err=await res.json().catch(()=>({}));notify(err.error||"Failed to draft report")}setDraftLoading(!1)}(0,react.useEffect)(()=>{loadPhotos()},[loadPhotos]),(0,react.useEffect)(()=>{const state=loadState();state&&(state.open&&setOpen(!0),void 0===controlledExpanded&&state.expanded&&setExpandedState(state.expanded),state.session&&(setMessages(state.session.messages),setSessionId(state.session.id),setSessionCreatedAt(state.session.createdAt),setSessionSummary(state.session.summary)))},[controlledExpanded,loadState]);const saveCurrentSession=(0,react.useCallback)(()=>{if(messages.length>0&&sessionId){const firstUser=messages.find(m=>"user"===m.role),summary=sessionSummary||(firstUser?firstUser.content.slice(0,30):""),session={id:sessionId,createdAt:sessionCreatedAt,summary,messages},list=[...history.filter(h=>h.id!==sessionId),session];setHistory(list),saveHistory(list)}},[messages,sessionId,sessionCreatedAt,sessionSummary,history,saveHistory]);(0,react.useEffect)(()=>{saveCurrentSessionRef.current=saveCurrentSession},[saveCurrentSession]);const router=(0,navigation.useRouter)();return(0,react.useEffect)(()=>{scrollRef.current&&(scrollRef.current.scrollTop=scrollRef.current.scrollHeight)},[messages]),(0,react.useEffect)(()=>{if(!scrollRef.current)return;const current=scrollRef.current;function update(){const canScroll=current.scrollHeight>current.clientHeight+1,atBottom=current.scrollTop+current.clientHeight>=current.scrollHeight-1;setShowJump(canScroll&&!atBottom)}update(),current.addEventListener("scroll",update),window.addEventListener("resize",update);const observer=new ResizeObserver(update);return observer.observe(current),()=>{current.removeEventListener("scroll",update),window.removeEventListener("resize",update),observer.disconnect()}},[open,messages,expanded]),(0,react.useEffect)(()=>{open&&inputRef.current&&inputRef.current.focus()},[open]),(0,react.useEffect)(()=>{const handler=()=>saveCurrentSessionRef.current();return window.addEventListener("beforeunload",handler),()=>{window.removeEventListener("beforeunload",handler),handler()}},[]),(0,react.useEffect)(()=>{openRef.current&&saveCurrentSessionRef.current(),messages.length},[messages]),(0,react.useEffect)(()=>{saveState({open,expanded,session:sessionId&&sessionCreatedAt?{id:sessionId,createdAt:sessionCreatedAt,summary:sessionSummary,messages}:void 0})},[open,expanded,messages,sessionId,sessionCreatedAt,sessionSummary,saveState]),(0,jsx_runtime.jsx)(CaseChatContext.Provider,{value:{open,expanded,expandedState,messages,history,input,loading,draftLoading,cameraOpen,chatError,photoMap,sessionId,sessionCreatedAt,sessionSummary,systemPrompt,availableActions,unavailableActions,showJump,scrollRef,inputRef,handleOpen:function handleOpen(){startNew(),setOpen(!0),void 0===controlledExpanded?setExpandedState(!1):null==onExpandChange||onExpandChange(!1),async function seed(){var _abortRef_current;setLoading(!0),null===(_abortRef_current=abortRef.current)||void 0===_abortRef_current||_abortRef_current.abort();const controller=new AbortController;abortRef.current=controller;try{let reply=null;if(onChat){const result=await onChat([]);if("string"==typeof result)reply=result.startsWith("[action:")&&result.endsWith("]")?{response:"",actions:[{id:result.slice(8,-1)}],noop:!1}:"[noop]"===result?{response:"",actions:[],noop:!0}:{response:result,actions:[],noop:!1};else if("response"in result)reply=result;else if("reply"in result){const r=result;reply=r.reply,r.system&&setSystemPrompt(r.system),r.available&&setAvailableActions(r.available),r.unavailable&&setUnavailableActions(r.unavailable)}else reply=result}else{const res=await(0,apiClient.n)(`/api/cases/${caseId}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[]}),signal:controller.signal});if(res.ok){const data=await res.json();var _data_available,_data_unavailable;reply=data.reply,setSystemPrompt(data.system),setAvailableActions(null!==(_data_available=data.available)&&void 0!==_data_available?_data_available:[]),setUnavailableActions(null!==(_data_unavailable=data.unavailable)&&void 0!==_data_unavailable?_data_unavailable:[])}}controller.signal.aborted||!reply||reply.noop||setMessages([{id:crypto.randomUUID(),role:"assistant",content:reply.response,actions:reply.actions}])}catch(e){}controller.signal.aborted||setLoading(!1)}()},handleClose:function handleClose(){setOpen(!1),setDraftData(null),setDraftLoading(!1),setCameraOpen(!1),setDraftAnchorId(null),setCameraAnchorId(null),void 0===controlledExpanded?setExpandedState(!1):null==onExpandChange||onExpandChange(!1),saveCurrentSession(),localStorage.removeItem(stateKey)},toggleExpanded:function toggleExpanded(){const next=!expanded;void 0===controlledExpanded&&setExpandedState(next),null==onExpandChange||onExpandChange(next)},send:async function send(){const text=input.trim();if(!text)return;const list=[...messages,{id:crypto.randomUUID(),role:"user",content:text}];0===messages.length&&setSessionSummary(text.slice(0,30)),setMessages(list),setInput(""),await async function request(list){var _abortRef_current;setLoading(!0),null===(_abortRef_current=abortRef.current)||void 0===_abortRef_current||_abortRef_current.abort();const controller=new AbortController;abortRef.current=controller;try{let reply=null;if(onChat){const result=await onChat(list);if("string"==typeof result)reply=result.startsWith("[action:")&&result.endsWith("]")?{response:"",actions:[{id:result.slice(8,-1)}],noop:!1}:"[noop]"===result?{response:"",actions:[],noop:!0}:{response:result,actions:[],noop:!1};else if("response"in result)reply=result;else if("reply"in result){const r=result;reply=r.reply,r.system&&setSystemPrompt(r.system),r.available&&setAvailableActions(r.available),r.unavailable&&setUnavailableActions(r.unavailable)}else reply=result}else{const res=await(0,apiClient.n)(`/api/cases/${caseId}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:list}),signal:controller.signal});if(res.ok){const data=await res.json();var _data_available,_data_unavailable;reply=data.reply,setSystemPrompt(data.system),setAvailableActions(null!==(_data_available=data.available)&&void 0!==_data_available?_data_available:[]),setUnavailableActions(null!==(_data_unavailable=data.unavailable)&&void 0!==_data_unavailable?_data_unavailable:[]),setChatError(null)}else{const err=await res.json().catch(()=>({}));503===res.status?setChatError(err.error||"Case Chat server is unavailable. Please try again."):setChatError(err.error||"Case Chat response was invalid. Please try again later.")}}!controller.signal.aborted&&reply&&(reply.noop?setMessages(list):setMessages([...list,{id:crypto.randomUUID(),role:"assistant",content:reply.response,actions:reply.actions}]))}catch(e){controller.signal.aborted||setChatError("Case Chat server is unreachable. Please try again later.")}controller.signal.aborted||setLoading(!1)}(list)},scrollToBottom:function scrollToBottom(){scrollRef.current&&(scrollRef.current.scrollTop=scrollRef.current.scrollHeight,setShowJump(!1))},renderActions:function renderActions(actions,msgId){const buttons=actions.map((a,idx)=>{if("id"in a){const act=caseActions.find(c=>c.id===a.id);if(act)return(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{"compose"===act.id?openDraft(msgId):"take-photo"===act.id?function openCamera(anchorId){setCameraAnchorId(null!=anchorId?anchorId:null),setCameraOpen(!0)}(msgId):router.push(act.href(caseId))},className:"bg-blue-600 text-white px-2 py-1 rounded mx-1",children:act.label},`${a.id}-${idx}`)}else{if("field"in a&&"value"in a){var _labelMap_a_field;const label=null!==(_labelMap_a_field={vin:`Set VIN to "${a.value}"`,plate:`Set Plate to "${a.value}"`,state:`Set State to "${a.value}"`,note:`Add Note: "${a.value}"`}[a.field])&&void 0!==_labelMap_a_field?_labelMap_a_field:`Apply ${a.field}`;return(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{(async function handleEdit(field,value){switch(field){case"vin":await(0,apiClient.n)(`/api/cases/${caseId}/vin`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vin:value})}),router.refresh();break;case"plate":await(0,apiClient.n)(`/api/cases/${caseId}/override`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle:{licensePlateNumber:value}})}),router.refresh();break;case"state":await(0,apiClient.n)(`/api/cases/${caseId}/override`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle:{licensePlateState:value}})}),router.refresh();break;case"note":{const res=await(0,apiClient.n)(`/api/cases/${caseId}`),data=res.ok?await res.json():{note:null},note=data.note?`${data.note}\n${value}`:value;await(0,apiClient.n)(`/api/cases/${caseId}/note`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({note})}),router.refresh()}}})(a.field,a.value)},className:"bg-green-700 text-white px-2 py-1 rounded mx-1",children:label},`edit-${a.field}-${a.value}`)}if("photo"in a&&"note"in a){const url=photoMap[a.photo];if(url)return(0,jsx_runtime.jsxs)("button",{type:"button",onClick:()=>{(async function handlePhotoNote(name,value){var _data_photoNotes;const url=photoMap[name];if(!url)return;const res=await(0,apiClient.n)(`/api/cases/${caseId}`);var _data_photoNotes_url;const current=null!==(_data_photoNotes_url=null===(_data_photoNotes=(res.ok?await res.json():{photoNotes:void 0}).photoNotes)||void 0===_data_photoNotes?void 0:_data_photoNotes[url])&&void 0!==_data_photoNotes_url?_data_photoNotes_url:null,note=current?`${current}\n${value}`:value;await(0,apiClient.n)(`/api/cases/${caseId}/photo-note`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({photo:url,note})}),router.refresh()})(a.photo,a.note)},className:"bg-green-700 text-white px-1 py-1 rounded mx-1 flex items-center gap-1",children:[(0,jsx_runtime.jsx)(thumbnail_image.A,{src:(0,clientThumbnails.s)(url,64),alt:a.photo,width:32,height:24}),(0,jsx_runtime.jsx)("span",{children:`Add "${a.note}"`})]},`photo-${a.photo}-${a.note}`)}}return null});return(0,jsx_runtime.jsx)("div",{className:"mt-1 flex flex-wrap gap-1",children:buttons})},renderContent:function renderContent(m){return(0,jsx_runtime.jsx)("span",{children:m.content})},setInput,openDraft,draftAnchorId,setDraftAnchorId,draftData,setDraftData,cameraAnchorId,setCameraAnchorId,setCameraOpen,selectSession:function selectSession(val){if(saveCurrentSession(),"new"===val)startNew();else{const found=history.find(h=>h.id===val);found&&(setMessages(found.messages),setSessionId(found.id),setSessionCreatedAt(found.createdAt),setSessionSummary(found.summary))}}},children})}CaseChatProvider.__docgenInfo={description:"",methods:[],displayName:"CaseChatProvider",props:{caseId:{required:!0,tsType:{name:"string"},description:""},onChat:{required:!1,tsType:{name:"signature",type:"function",raw:"(\n  messages: Message[],\n) => Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>",signature:{arguments:[{type:{name:"Array",elements:[{name:"Message"}],raw:"Message[]"},name:"messages"}],return:{name:"Promise",elements:[{name:"union",raw:"CaseChatReply | { reply: string; system?: string } | ChatResponse | string",elements:[{name:"CaseChatReply"},{name:"signature",type:"object",raw:"{ reply: string; system?: string }",signature:{properties:[{key:"reply",value:{name:"string",required:!0}},{key:"system",value:{name:"string",required:!1}}]}},{name:"ChatResponse"},{name:"string"}]}],raw:"Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>"}}},description:""},expanded:{required:!1,tsType:{name:"boolean"},description:""},onExpandChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"value"}],return:{name:"void"}}},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};var index_esm=__webpack_require__("__barrel_optimize__?names=FaBars!=!./node_modules/react-icons/fa/index.esm.js");function ChatHeader(){const{expanded,toggleExpanded,handleClose,history,sessionId,sessionCreatedAt,sessionSummary,selectSession}=useCaseChat();return(0,jsx_runtime.jsxs)("div",{className:"flex items-center border-b p-2 gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold flex-none",children:"Case Chat"}),(0,jsx_runtime.jsxs)("select",{"aria-label":"Chat history",value:null!=sessionId?sessionId:"",onChange:e=>selectSession(e.target.value),className:"text-black dark:text-black text-xs flex-auto min-w-0 truncate",children:[(0,jsx_runtime.jsx)("option",{value:"new",children:"New Chat"}),!history.some(h=>h.id===sessionId)&&sessionId&&(0,jsx_runtime.jsxs)("option",{value:sessionId,children:[new Date(sessionCreatedAt).toLocaleString(),sessionSummary?` - ${sessionSummary}`:""]}),history.map(h=>(0,jsx_runtime.jsxs)("option",{value:h.id,children:[new Date(h.createdAt).toLocaleString()," - ",h.summary]},h.id))]}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:toggleExpanded,"aria-label":expanded?"Collapse chat":"Expand chat",className:"text-xl leading-none flex-none",children:expanded?(0,jsx_runtime.jsx)(index_esm.f93,{}):(0,jsx_runtime.jsx)(index_esm.xKl,{})}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:handleClose,"aria-label":"Close chat",className:"text-xl leading-none flex-none",children:"Ã—"})]})}function ChatInput(){const{input,setInput,send,loading,showJump,scrollToBottom,inputRef}=useCaseChat();return(0,jsx_runtime.jsxs)("div",{className:"border-t p-2 flex flex-col gap-2",children:[showJump?(0,jsx_runtime.jsx)("button",{type:"button",onClick:scrollToBottom,className:"self-start text-blue-600 underline text-xs",children:"Jump to latest"}):null,(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)("input",{ref:inputRef,type:"text",value:input,onChange:e=>setInput(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),send())},className:"flex-1 border rounded px-1 dark:bg-gray-800",placeholder:"Ask a question..."}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:send,disabled:loading,className:"bg-blue-600 text-white px-2 rounded disabled:opacity-50",children:"Send"})]})]})}ChatHeader.__docgenInfo={description:"",methods:[],displayName:"ChatHeader"},ChatInput.__docgenInfo={description:"",methods:[],displayName:"ChatInput"};var DebugWrapper=__webpack_require__("./src/app/components/DebugWrapper.tsx"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),CaseChat_module=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!./node_modules/postcss-loader/dist/cjs.js!./src/app/cases/[id]/CaseChat.module.css"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(CaseChat_module.A,options);const _id_CaseChat_module=CaseChat_module.A&&CaseChat_module.A.locals?CaseChat_module.A.locals:void 0;var useAddFilesToCase=__webpack_require__("./src/app/useAddFilesToCase.ts");function ChatWidget({children,className=""}){return(0,jsx_runtime.jsx)("div",{className:`bg-blue-600 text-white px-2 py-1 rounded mx-1 text-xs space-y-1 ${className}`,children})}function WidgetActions({children,centered=!1,wrap=!1}){const classes=["flex","gap-1"];return centered&&classes.push("justify-center"),wrap&&classes.push("flex-wrap"),(0,jsx_runtime.jsx)("div",{className:classes.join(" "),children})}function TakePhotoWidget({caseId,onClose}){const videoRef=(0,react.useRef)(null),canvasRef=(0,react.useRef)(null),uploadCase=(0,useAddFilesToCase.A)(caseId),[error,setError]=(0,react.useState)(null),[uploading,setUploading]=(0,react.useState)(!1);return(0,react.useEffect)(()=>{let stream=null;return async function startCamera(){var _navigator_mediaDevices;if(null===(_navigator_mediaDevices=navigator.mediaDevices)||void 0===_navigator_mediaDevices?void 0:_navigator_mediaDevices.getUserMedia)try{stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});const v=videoRef.current;v&&(v.srcObject=stream,v.setAttribute("autoplay",""),v.setAttribute("muted",""),v.setAttribute("playsinline",""),v.onloadedmetadata=()=>{v.play().catch(()=>{})})}catch(e){setError("Unable to access camera")}else setError("Camera API not available")}(),()=>{if(stream)for(const t of stream.getTracks())t.stop()}},[]),(0,jsx_runtime.jsxs)(ChatWidget,{className:"w-48",children:[(0,jsx_runtime.jsx)("video",{ref:videoRef,className:"w-full h-32 bg-black rounded",children:(0,jsx_runtime.jsx)("track",{kind:"captions",label:""})}),(0,jsx_runtime.jsx)("canvas",{ref:canvasRef,className:"hidden"}),error&&(0,jsx_runtime.jsx)("div",{className:"text-red-200 text-center",children:error}),(0,jsx_runtime.jsxs)(WidgetActions,{centered:!0,children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:async function takePicture(){const video=videoRef.current,canvas=canvasRef.current;if(!video||!canvas)return;canvas.width=video.videoWidth,canvas.height=video.videoHeight;const ctx=canvas.getContext("2d");ctx&&(ctx.drawImage(video,0,0,canvas.width,canvas.height),canvas.toBlob(async blob=>{if(!blob)return;const file=new File([blob],"photo.jpg",{type:"image/jpeg"}),dt=new DataTransfer;dt.items.add(file),setUploading(!0),await uploadCase(dt.files),setUploading(!1),onClose()},"image/jpeg"))},disabled:uploading,className:"bg-blue-800 text-white px-1 rounded disabled:opacity-50",children:uploading?"Uploading...":"Take Case Photo"}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:onClose,className:"bg-gray-200 text-black px-1 rounded",children:"Close"})]})]})}ChatWidget.__docgenInfo={description:"",methods:[],displayName:"ChatWidget",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}}}},WidgetActions.__docgenInfo={description:"",methods:[],displayName:"WidgetActions",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},centered:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},wrap:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}},TakePhotoWidget.__docgenInfo={description:"",methods:[],displayName:"TakePhotoWidget",props:{caseId:{required:!0,tsType:{name:"string"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};var tooltip=__webpack_require__("./src/components/ui/tooltip.tsx"),next_link=__webpack_require__("./node_modules/next/link.js"),link_default=__webpack_require__.n(next_link);function DraftPreview({caseId,data,onClose}){const router=(0,navigation.useRouter)(),notify=(0,NotificationProvider.l)(),[sending,setSending]=(0,react.useState)(!1);async function send(){setSending(!0);const res=await(0,apiClient.n)(`/api/cases/${caseId}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:data.email.subject,body:data.email.body,attachments:data.attachments})});if(res.ok)notify("Email sent"),onClose();else{const err=await res.json().catch(()=>({}));notify(err.error||"Failed to send email")}setSending(!1)}const previewBody=data.email.body.length>80?`${data.email.body.slice(0,77)}...`:data.email.body,tooltipContent=(0,jsx_runtime.jsxs)("div",{className:"bg-white text-black p-2 rounded shadow max-w-sm space-y-2",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold text-sm",children:data.email.subject}),(0,jsx_runtime.jsx)("pre",{className:"whitespace-pre-wrap text-xs",children:data.email.body}),data.attachments.length>0&&(0,jsx_runtime.jsx)("div",{className:"flex gap-1 flex-wrap",children:data.attachments.map(p=>(0,jsx_runtime.jsx)(thumbnail_image.A,{src:(0,clientThumbnails.s)(p,128),alt:"attachment",width:96,height:72,imgClassName:"object-contain"},p))}),(0,jsx_runtime.jsxs)(WidgetActions,{wrap:!0,children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:send,disabled:sending,className:"bg-blue-800 text-white px-1 rounded text-xs disabled:opacity-50",children:sending?"Sending...":"Send"}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:onClose,className:"bg-gray-200 text-black px-1 rounded text-xs",children:"Close"}),(0,jsx_runtime.jsx)(link_default(),{href:`/cases/${caseId}/compose`,className:"bg-blue-600 text-white px-1 rounded text-xs",children:"Full Editor"})]})]});return(0,jsx_runtime.jsxs)(ChatWidget,{children:[(0,jsx_runtime.jsx)(tooltip.A,{label:tooltipContent,interactive:!0,children:(0,jsx_runtime.jsxs)("button",{type:"button",onClick:function openCompose(){const url=`/cases/${caseId}/compose`;if(router.push(url),"undefined"!=typeof history){var _history_state;const st=null!==(_history_state=history.state)&&void 0!==_history_state?_history_state:{};history.replaceState({...st,draftData:data},"",url)}},className:"text-left w-full",children:[(0,jsx_runtime.jsx)("strong",{children:data.email.subject})," ",previewBody]})}),(0,jsx_runtime.jsxs)(WidgetActions,{children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:send,disabled:sending,className:"bg-blue-800 text-white px-1 rounded disabled:opacity-50",children:sending?"Sending...":"Send"}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:onClose,className:"bg-gray-200 text-black px-1 rounded",children:"Close"})]})]})}function ChatMessages({caseId}){const{messages,loading,draftLoading,draftData,cameraOpen,chatError,renderActions,renderContent,scrollRef,setDraftData,setCameraOpen,draftAnchorId,setDraftAnchorId,cameraAnchorId,setCameraAnchorId,systemPrompt,availableActions,unavailableActions}=useCaseChat();return(0,jsx_runtime.jsx)(DebugWrapper.A,{data:{system:systemPrompt,available:availableActions,unavailable:unavailableActions},className:"flex flex-col flex-1 min-h-0",children:(0,jsx_runtime.jsxs)("div",{ref:scrollRef,className:"flex-1 overflow-y-auto p-2 space-y-2",children:[messages.map(m=>(0,jsx_runtime.jsxs)("div",{className:"user"===m.role?"flex flex-col items-end":"flex flex-col items-start",children:[(0,jsx_runtime.jsx)("span",{className:`${_id_CaseChat_module.bubble} ${"user"===m.role?_id_CaseChat_module.user:_id_CaseChat_module.assistant}`,children:renderContent(m)}),"assistant"===m.role&&m.actions&&m.actions.length>0&&renderActions(m.actions,m.id),draftData&&draftAnchorId===m.id&&(0,jsx_runtime.jsx)(DraftPreview,{caseId,data:draftData,onClose:()=>{setDraftData(null),setDraftAnchorId(null)}}),cameraOpen&&cameraAnchorId===m.id&&(0,jsx_runtime.jsx)(TakePhotoWidget,{caseId,onClose:()=>{setCameraOpen(!1),setCameraAnchorId(null)}})]},m.id)),loading&&(0,jsx_runtime.jsx)("div",{className:"text-left",children:(0,jsx_runtime.jsx)("span",{className:`${_id_CaseChat_module.bubble} ${_id_CaseChat_module.assistant} ${_id_CaseChat_module.typing}`})},"typing"),draftLoading&&(0,jsx_runtime.jsx)("div",{className:"text-left",children:(0,jsx_runtime.jsx)("span",{className:"text-sm",children:"Drafting email based on case information..."})},"draft-loading"),chatError&&(0,jsx_runtime.jsx)("div",{className:"text-left",children:(0,jsx_runtime.jsx)("span",{className:`${_id_CaseChat_module.bubble} ${_id_CaseChat_module.error}`,children:chatError})},"chat-error")]})})}function CaseChat(props){const{caseId}=props;return(0,jsx_runtime.jsx)(CaseChatProvider,{...props,children:(0,jsx_runtime.jsx)(CaseChatInner,{caseId})})}function CaseChatInner({caseId}){const{open,expanded,handleOpen}=useCaseChat();return(0,jsx_runtime.jsx)("div",{className:(expanded?"relative h-full":open?"fixed inset-0 sm:bottom-4 sm:right-4 sm:inset-auto z-40":"fixed bottom-4 right-4 z-40")+" text-sm",children:open?(0,jsx_runtime.jsxs)("div",{className:"bg-white dark:bg-gray-900 shadow-lg rounded flex flex-col "+(expanded?"w-full h-full":"w-screen h-screen sm:w-80 sm:h-96"),children:[(0,jsx_runtime.jsx)(ChatHeader,{}),(0,jsx_runtime.jsx)(ChatMessages,{caseId}),(0,jsx_runtime.jsx)(ChatInput,{})]}):(0,jsx_runtime.jsx)("button",{type:"button",onClick:handleOpen,className:"bg-blue-600 text-white px-3 py-1 rounded shadow",children:"Chat"})})}DraftPreview.__docgenInfo={description:"",methods:[],displayName:"DraftPreview",props:{caseId:{required:!0,tsType:{name:"string"},description:""},data:{required:!0,tsType:{name:"DraftData"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}},ChatMessages.__docgenInfo={description:"",methods:[],displayName:"ChatMessages",props:{caseId:{required:!0,tsType:{name:"string"},description:""}}},CaseChat.__docgenInfo={description:"",methods:[],displayName:"CaseChat",props:{caseId:{required:!0,tsType:{name:"string"},description:""},onChat:{required:!1,tsType:{name:"signature",type:"function",raw:"(\n  messages: Message[],\n) => Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>",signature:{arguments:[{type:{name:"Array",elements:[{name:"Message"}],raw:"Message[]"},name:"messages"}],return:{name:"Promise",elements:[{name:"union",raw:"CaseChatReply | { reply: string; system?: string } | ChatResponse | string",elements:[{name:"CaseChatReply"},{name:"signature",type:"object",raw:"{ reply: string; system?: string }",signature:{properties:[{key:"reply",value:{name:"string",required:!0}},{key:"system",value:{name:"string",required:!1}}]}},{name:"ChatResponse"},{name:"string"}]}],raw:"Promise<\n  CaseChatReply | { reply: string; system?: string } | ChatResponse | string\n>"}}},description:""},expanded:{required:!1,tsType:{name:"boolean"},description:""},onExpandChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"value"}],return:{name:"void"}}},description:""}}}},"./src/app/components/DebugWrapper.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>DebugWrapper});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");var tooltip=__webpack_require__("./src/components/ui/tooltip.tsx"),config=__webpack_require__("./src/lib/config.ts");function DebugWrapper({data,children,availableActions,unavailableActions,className}){const enabled=Boolean(config.$.NEXT_PUBLIC_BROWSER_DEBUG),alt=function useAltKey(){const[pressed,setPressed]=(0,react.useState)(!1);return(0,react.useEffect)(()=>{const down=e=>{e.altKey&&setPressed(!0)},up=()=>setPressed(!1);return window.addEventListener("keydown",down),window.addEventListener("keyup",up),window.addEventListener("blur",up),()=>{window.removeEventListener("keydown",down),window.removeEventListener("keyup",up),window.removeEventListener("blur",up)}},[]),pressed}(),[refHover,setRefHover]=(0,react.useState)(!1),[open,setOpen]=(0,react.useState)(!1);(0,react.useEffect)(()=>{alt&&refHover&&setOpen(!0)},[alt,refHover]);const json=JSON.stringify(data,null,2),tokens=function tokenize(json){const tokens=[];let last=0;return json.replace(/(\"(?:\\u[a-fA-F0-9]{4}|\\[^u]|[^\\\"])*\"(?:\s*:)?|\b(?:true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(match,_p1,offset)=>{last<offset&&tokens.push(json.slice(last,offset));let cls="json-number";return/^\"/.test(match)?cls=/:$/.test(match)?"json-key":"json-string":/true|false/.test(match)?cls="json-boolean":/null/.test(match)&&(cls="json-null"),tokens.push((0,jsx_runtime.jsx)("span",{className:cls,children:match},tokens.length)),last=offset+match.length,""}),last<json.length&&tokens.push(json.slice(last)),tokens}(json);if(!enabled)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children});const show=alt&&refHover||open;return(0,jsx_runtime.jsx)(tooltip.A,{label:(0,jsx_runtime.jsxs)("div",{className:"text-xs bg-black/80 text-white p-2 rounded shadow max-w-sm max-h-60 overflow-auto relative space-y-1",children:[((null==availableActions?void 0:availableActions.length)||(null==unavailableActions?void 0:unavailableActions.length))&&(0,jsx_runtime.jsxs)("div",{className:"mb-1 space-y-1",children:[(null==availableActions?void 0:availableActions.length)?(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Available:"})," ",availableActions.join(", ")]}):null,(null==unavailableActions?void 0:unavailableActions.length)?(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Unavailable:"})," ",unavailableActions.join(", ")]}):null,(0,jsx_runtime.jsx)("hr",{})]}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>navigator.clipboard.writeText(json),className:"absolute top-1 right-1 underline",children:"Copy"}),(0,jsx_runtime.jsx)("pre",{className:"pt-4 whitespace-pre-wrap break-words",children:tokens})]}),open:show,onOpenChange:setOpen,interactive:!0,closeDelay:200,children:(0,jsx_runtime.jsx)("div",{onMouseEnter:()=>{setRefHover(!0),alt&&setOpen(!0)},onMouseLeave:()=>{setRefHover(!1)},className:null!=className?className:"inline-block",children})})}DebugWrapper.__docgenInfo={description:"",methods:[],displayName:"DebugWrapper",props:{data:{required:!0,tsType:{name:"unknown"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""},availableActions:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},unavailableActions:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}}},"./src/app/useAddFilesToCase.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useAddFilesToCase});var _apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/apiClient.ts"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useMutation.js"),next_navigation__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/app/components/NotificationProvider.tsx");function useAddFilesToCase(caseId){const router=(0,next_navigation__WEBPACK_IMPORTED_MODULE_1__.useRouter)(),notify=(0,_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_2__.l)(),uploadMutation=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_3__.n)({mutationFn:async formData=>(0,_apiClient__WEBPACK_IMPORTED_MODULE_0__.n)("/api/upload",{method:"POST",body:formData})});return async files=>{if(!files||0===files.length)return;(await Promise.all(Array.from(files).map(file=>{const formData=new FormData;return formData.append("photo",file),formData.append("caseId",caseId),uploadMutation.mutateAsync(formData)}))).some(r=>!r.ok)?notify("Failed to upload one or more files."):router.push(`/cases/${caseId}`)}}},"./src/components/thumbnail-image.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>ThumbnailImage});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function ThumbnailImage({src,alt,width,height,className,imgClassName,...props}){const[ready,setReady]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[attempt,setAttempt]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(0);return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(ready)return;const timer=setInterval(()=>setAttempt(a=>a+1),2e3);return()=>clearInterval(timer)},[ready]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{style:{width,height},className:`relative overflow-hidden ${null!=className?className:""}`,children:[!ready&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-200 dark:bg-gray-800",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"w-6 h-6 border-2 border-gray-500 border-t-transparent rounded-full animate-spin"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("img",{src:`${src}${attempt?`?${attempt}`:""}`,alt:null!=alt?alt:"",width,height,onLoad:()=>setReady(!0),onError:()=>setReady(!1),className:`object-cover max-w-full max-h-full ${null!=imgClassName?imgClassName:""} ${ready?"":"invisible"}`,loading:"lazy",...props})]})}ThumbnailImage.__docgenInfo={description:"",methods:[],displayName:"ThumbnailImage",props:{src:{required:!0,tsType:{name:"string"},description:""},alt:{required:!0,tsType:{name:"string"},description:""},width:{required:!0,tsType:{name:"number"},description:""},height:{required:!0,tsType:{name:"number"},description:""},imgClassName:{required:!1,tsType:{name:"string"},description:""}},composes:["Omit"]}},"./src/components/ui/tooltip.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>Tooltip});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@floating-ui/react/dist/floating-ui.react.mjs"),_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@floating-ui/react-dom/dist/floating-ui.react-dom.mjs"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function Tooltip({label,children,placement="top",open:controlledOpen,onOpenChange,interactive=!1,closeDelay=0}){const[uncontrolledOpen,setUncontrolledOpen]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),open=null!=controlledOpen?controlledOpen:uncontrolledOpen,setOpen=null!=onOpenChange?onOpenChange:setUncontrolledOpen,{refs,floatingStyles,context}=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.we)({open,onOpenChange:setOpen,middleware:[(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.cY)(5),(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.UU)(),(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_3__.BN)({padding:5})],placement}),hover=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.Mk)(context,{enabled:void 0===controlledOpen,move:!1,handleClose:interactive?(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.iB)():void 0,delay:{close:closeDelay}}),focus=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.iQ)(context,{enabled:void 0===controlledOpen}),dismiss=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.s9)(context),role=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.It)(context,{role:"tooltip"}),{getReferenceProps,getFloatingProps}=(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.bv)([hover,focus,dismiss,role]),referenceProps=getReferenceProps({ref:refs.setReference});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[(0,react__WEBPACK_IMPORTED_MODULE_1__.cloneElement)(children,referenceProps),open&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_floating_ui_react__WEBPACK_IMPORTED_MODULE_2__.XF,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{ref:refs.setFloating,style:floatingStyles,...getFloatingProps(),className:"z-50 rounded bg-black/80 px-2 py-1 text-xs text-white shadow",children:label})})]})}Tooltip.__docgenInfo={description:"",methods:[],displayName:"Tooltip",props:{label:{required:!0,tsType:{name:"union",raw:"ReactElement | string",elements:[{name:"ReactElement"},{name:"string"}]},description:""},children:{required:!0,tsType:{name:"ReactElement"},description:""},placement:{required:!1,tsType:{name:"Placement"},description:"",defaultValue:{value:'"top"',computed:!1}},open:{required:!1,tsType:{name:"boolean"},description:""},onOpenChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(open: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"open"}],return:{name:"void"}}},description:""},interactive:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},closeDelay:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0",computed:!1}}}}},"./src/lib/clientThumbnails.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function getThumbnailUrl(url,size){return`/uploads/thumbs/${size}/${url.substring(url.lastIndexOf("/")+1)}`}__webpack_require__.d(__webpack_exports__,{s:()=>getThumbnailUrl})},"./src/lib/reportModules.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{u:()=>reportModules});const reportModules={"oak-park":{id:"oak-park",authorityName:"Oak Park Police Department",authorityEmail:"police@oak-park.us",authorityAddress:"123 Madison St\nOak Park, IL 60302"}}}}]);