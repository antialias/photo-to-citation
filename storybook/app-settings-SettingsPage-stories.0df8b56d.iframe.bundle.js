"use strict";(self.webpackChunkapp_scaffold=self.webpackChunkapp_scaffold||[]).push([[3897],{"./src/apiClient.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>apiEventSource,n:()=>apiFetch});var _basePath__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/basePath.ts");async function apiFetch(input,init){return fetch((0,_basePath__WEBPACK_IMPORTED_MODULE_0__.h)(input),init)}function apiEventSource(input){return new EventSource((0,_basePath__WEBPACK_IMPORTED_MODULE_0__.h)(input))}},"./src/app/settings/SettingsPage.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>SettingsPage_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),QueryClientProvider=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js"),modern=__webpack_require__("./node_modules/@tanstack/react-query-devtools/build/modern/index.js"),apiClient=__webpack_require__("./src/apiClient.ts");const app_queryClient=new(__webpack_require__("./node_modules/@tanstack/query-core/build/modern/queryClient.js").E)({defaultOptions:{queries:{queryFn:async({queryKey})=>{const path=Array.isArray(queryKey)?String(queryKey[0]):String(queryKey),res=await(0,apiClient.n)(path);if(!res.ok)throw new Error(await res.text());return res.json()}}}});var process=__webpack_require__("./node_modules/process/browser.js");function QueryProvider({children}){const showReactQueryDevTools=process.env.SHOW_REACT_QUERY_DEV_TOOLS&&!1;return(0,jsx_runtime.jsxs)(QueryClientProvider.Ht,{client:app_queryClient,children:[children,showReactQueryDevTools&&(0,jsx_runtime.jsx)(modern.E,{initialIsOpen:!1})]})}QueryProvider.__docgenInfo={description:"",methods:[],displayName:"QueryProvider",props:{children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};var useSession=__webpack_require__("./src/app/useSession.ts"),dist=__webpack_require__("./node_modules/@radix-ui/react-tabs/dist/index.mjs"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");const Tabs=dist.bL,TabsList=react.forwardRef(({className,...props},ref)=>(0,jsx_runtime.jsx)(dist.B8,{ref,className:`flex border-b ${null!=className?className:""}`,...props}));TabsList.displayName=dist.B8.displayName;const TabsTrigger=react.forwardRef(({className,...props},ref)=>(0,jsx_runtime.jsx)(dist.l9,{ref,className:`px-3 py-1 border-b-2 rounded-t border-transparent text-gray-700 dark:text-gray-300 data-[state=active]:border-blue-600 data-[state=active]:text-blue-600 data-[state=active]:font-bold ${null!=className?className:""}`,...props}));TabsTrigger.displayName=dist.l9.displayName;const TabsContent=react.forwardRef(({className,...props},ref)=>(0,jsx_runtime.jsx)(dist.UC,{ref,className,...props}));TabsContent.displayName=dist.UC.displayName,TabsList.__docgenInfo={description:"",methods:[]},TabsTrigger.__docgenInfo={description:"",methods:[]},TabsContent.__docgenInfo={description:"",methods:[]};var useQuery=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useQuery.js"),useMutation=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useMutation.js"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js");const creditBalanceQueryKey=["/api/credits/balance"];function UserSettingsPage(){var _session_user,_session_user1,_session_user2;const{data:session}=(0,useSession.wV)(),{t}=(0,es.Bd)(),[tab,setTab]=(0,react.useState)("profile"),[usd,setUsd]=(0,react.useState)("0"),{data:balanceData}=function useCreditBalance(enabled=!0){return(0,useQuery.I)({queryKey:creditBalanceQueryKey,enabled})}("credits"===tab),addCreditsMutation=function useAddCredits(){const queryClient=(0,QueryClientProvider.jE)();return(0,useMutation.n)({async mutationFn(usd){await(0,apiClient.n)("/api/credits/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usd})})},onSuccess(){queryClient.invalidateQueries({queryKey:creditBalanceQueryKey})}})}();var _balanceData_balance;const balance=null!==(_balanceData_balance=null==balanceData?void 0:balanceData.balance)&&void 0!==_balanceData_balance?_balanceData_balance:0,queryClient=(0,QueryClientProvider.jE)(),{data}=(0,useQuery.I)({queryKey:["/api/profile"],queryFn:async()=>{const res=await(0,apiClient.n)("/api/profile");return await res.json()},enabled:!!session}),[name,setName]=(0,react.useState)(""),[image,setImage]=(0,react.useState)(""),[bio,setBio]=(0,react.useState)(""),[links,setLinks]=(0,react.useState)(""),[status,setStatus]=(0,react.useState)(void 0),[notes,setNotes]=(0,react.useState)(void 0);(0,react.useEffect)(()=>{var _data_name,_data_image,_data_bio,_data_socialLinks,_data_profileReviewNotes;data&&(setName(null!==(_data_name=data.name)&&void 0!==_data_name?_data_name:""),setImage(null!==(_data_image=data.image)&&void 0!==_data_image?_data_image:""),setBio(null!==(_data_bio=data.bio)&&void 0!==_data_bio?_data_bio:""),setLinks(null!==(_data_socialLinks=data.socialLinks)&&void 0!==_data_socialLinks?_data_socialLinks:""),setStatus(data.profileStatus),setNotes(null!==(_data_profileReviewNotes=data.profileReviewNotes)&&void 0!==_data_profileReviewNotes?_data_profileReviewNotes:null))},[data]);const mutation=(0,useMutation.n)({mutationFn:async()=>{await(0,apiClient.n)("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name,image,bio,socialLinks:links})})},onSuccess:()=>{queryClient.invalidateQueries({queryKey:["/api/profile"]})}});return session?(0,jsx_runtime.jsxs)("div",{className:"p-8",children:[(0,jsx_runtime.jsx)("h1",{className:"text-xl font-bold mb-4",children:t("nav.userSettings")}),(0,jsx_runtime.jsxs)(Tabs,{value:tab,onValueChange:v=>setTab(v),children:[(0,jsx_runtime.jsxs)(TabsList,{className:"mb-4 flex gap-4",children:[(0,jsx_runtime.jsx)(TabsTrigger,{value:"profile",children:t("profileTab")}),(0,jsx_runtime.jsx)(TabsTrigger,{value:"credits",children:t("creditsTab")})]}),(0,jsx_runtime.jsx)(TabsContent,{value:"profile",children:(0,jsx_runtime.jsxs)("form",{className:"grid gap-2 max-w-md",onSubmit:e=>{e.preventDefault(),mutation.mutate()},children:[(0,jsx_runtime.jsxs)("p",{children:[t("emailLabel")," ",null!==(_ref=null!==(_session_user_email=null===(_session_user=session.user)||void 0===_session_user?void 0:_session_user.email)&&void 0!==_session_user_email?_session_user_email:null===(_session_user1=session.user)||void 0===_session_user1?void 0:_session_user1.name)&&void 0!==_ref?_ref:t("unknown")]}),(0,jsx_runtime.jsxs)("p",{children:[t("roleLabel")," ",null===(_session_user2=session.user)||void 0===_session_user2?void 0:_session_user2.role]}),(0,jsx_runtime.jsxs)("label",{className:"flex flex-col",children:[t("nameLabel"),(0,jsx_runtime.jsx)("input",{value:name,onChange:e=>setName(e.target.value),className:"border p-1"})]}),(0,jsx_runtime.jsxs)("label",{className:"flex flex-col",children:[t("imageUrlLabel"),(0,jsx_runtime.jsx)("input",{value:image,onChange:e=>setImage(e.target.value),className:"border p-1"})]}),(0,jsx_runtime.jsxs)("label",{className:"flex flex-col",children:[t("socialLinksLabel"),(0,jsx_runtime.jsx)("textarea",{value:links,onChange:e=>setLinks(e.target.value),rows:3,className:"border p-1 resize-y"})]}),(0,jsx_runtime.jsxs)("label",{className:"flex flex-col",children:[t("bioLabel"),(0,jsx_runtime.jsx)("textarea",{value:bio,onChange:e=>setBio(e.target.value),rows:5,className:"border p-1 resize-y"})]}),"under_review"===status&&(0,jsx_runtime.jsx)("p",{className:"text-sm text-gray-600",children:t("profileStatusUnderReview")}),"published"===status&&(0,jsx_runtime.jsx)("p",{className:"text-sm text-green-700",children:t("profileStatusPublished")}),"hidden"===status&&(0,jsx_runtime.jsxs)("p",{className:"text-sm text-red-600",children:[t("profileStatusHidden")," ",null!=notes?notes:""]}),(0,jsx_runtime.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2",children:t("save")})]})}),(0,jsx_runtime.jsx)(TabsContent,{value:"credits",children:(0,jsx_runtime.jsxs)("div",{className:"grid gap-2 max-w-sm",children:[(0,jsx_runtime.jsx)("p",{children:t("balanceCredits",{balance})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)("input",{type:"number",value:usd,onChange:e=>setUsd(e.target.value),className:"border p-1 flex-1"}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>addCreditsMutation.mutate(Number(usd),{onSuccess(){setUsd("0")}}),className:"bg-blue-600 text-white px-2 py-1 rounded",children:t("add")})]})]})})]})]}):(0,jsx_runtime.jsx)("div",{className:"p-8",children:t("notLoggedIn")});var _session_user_email,_ref}UserSettingsPage.__docgenInfo={description:"",methods:[],displayName:"UserSettingsPage"};const SettingsPage_stories={component:UserSettingsPage,title:"Pages/SettingsPage"};const Default={render:()=>(function mockFetch(){__webpack_require__.g.fetch=async(url,options)=>url.endsWith("/api/credits/balance")?new Response(JSON.stringify({balance:3})):(url.endsWith("/api/credits/add")&&(null==options||options.method),new Response(null))}(),(0,jsx_runtime.jsx)(QueryProvider,{children:(0,jsx_runtime.jsx)(UserSettingsPage,{})}))},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  render: () => {\n    mockFetch();\n    return <QueryProvider>\n        <SettingsPage />\n      </QueryProvider>;\n  }\n}",...Default.parameters?.docs?.source}}}},"./src/app/useSession.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{CI:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.signOut,Jv:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.signIn,wV:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.useSession});var next_auth_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next-auth/react/index.js")},"./src/basePath.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{h:()=>withBasePath});var _publicEnv__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/publicEnv.ts");__webpack_require__("./node_modules/process/browser.js");function withBasePath(path){return`${function getBasePath(){var _getPublicEnv_NEXT_PUBLIC_BASE_PATH;return null!==(_getPublicEnv_NEXT_PUBLIC_BASE_PATH=(0,_publicEnv__WEBPACK_IMPORTED_MODULE_0__.j)().NEXT_PUBLIC_BASE_PATH)&&void 0!==_getPublicEnv_NEXT_PUBLIC_BASE_PATH?_getPublicEnv_NEXT_PUBLIC_BASE_PATH:""}()}${path}`}},"./src/publicEnv.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function getPublicEnv(){var _window_PUBLIC_ENV;return null!==(_window_PUBLIC_ENV=window.PUBLIC_ENV)&&void 0!==_window_PUBLIC_ENV?_window_PUBLIC_ENV:{}}__webpack_require__.d(__webpack_exports__,{j:()=>getPublicEnv})}}]);