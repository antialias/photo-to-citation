"use strict";(self.webpackChunkapp_scaffold=self.webpackChunkapp_scaffold||[]).push([[461],{"./node_modules/next/dist/client/use-merged-ref.js":(module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"useMergedRef",{enumerable:!0,get:function(){return useMergedRef}});const _react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function useMergedRef(refA,refB){const cleanupA=(0,_react.useRef)(null),cleanupB=(0,_react.useRef)(null);return(0,_react.useCallback)((current=>{if(null===current){const cleanupFnA=cleanupA.current;cleanupFnA&&(cleanupA.current=null,cleanupFnA());const cleanupFnB=cleanupB.current;cleanupFnB&&(cleanupB.current=null,cleanupFnB())}else refA&&(cleanupA.current=applyRef(refA,current)),refB&&(cleanupB.current=applyRef(refB,current))}),[refA,refB])}function applyRef(refA,current){if("function"==typeof refA){const cleanup=refA(current);return"function"==typeof cleanup?cleanup:()=>refA(null)}return refA.current=current,()=>{refA.current=null}}("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default)},"./src/app/point/PointAndShootPage.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>PointAndShootPage_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),next_link=__webpack_require__("./node_modules/next/link.js"),link_default=__webpack_require__.n(next_link),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),useNewCaseFromFiles=__webpack_require__("./src/app/useNewCaseFromFiles.ts"),console=__webpack_require__("./node_modules/console-browserify/index.js");function PointAndShootPage(){const videoRef=(0,react.useRef)(null),canvasRef=(0,react.useRef)(null),inputRef=(0,react.useRef)(null),[cameraError,setCameraError]=(0,react.useState)(null),uploadCase=(0,useNewCaseFromFiles.A)();return(0,react.useEffect)((()=>(async function startCamera(){try{const constraints={audio:!1,video:{facingMode:"environment"}},stream=await navigator.mediaDevices.getUserMedia(constraints),v=videoRef.current;v&&(v.setAttribute("autoplay",""),v.setAttribute("muted",""),v.setAttribute("playsinline",""),"srcObject"in v?v.srcObject=stream:v.src=URL.createObjectURL(stream),v.onloadedmetadata=()=>{v.play().catch((()=>{}))})}catch(err){console.error("Could not access camera",err),setCameraError("Unable to access camera. Please check permissions.")}}(),()=>{var _videoRef_current;if(null===(_videoRef_current=videoRef.current)||void 0===_videoRef_current?void 0:_videoRef_current.srcObject)for(const t of videoRef.current.srcObject.getTracks())t.stop()})),[]),(0,jsx_runtime.jsxs)("div",{className:"relative h-[100dvh] overflow-hidden bg-black",children:[cameraError&&(0,jsx_runtime.jsx)("div",{className:"absolute inset-x-0 top-0 z-10 bg-red-600 text-white text-center py-2",children:cameraError}),(0,jsx_runtime.jsx)("video",{ref:videoRef,autoPlay:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover z-0",children:(0,jsx_runtime.jsx)("track",{kind:"captions",label:""})}),(0,jsx_runtime.jsx)("canvas",{ref:canvasRef,className:"hidden"}),(0,jsx_runtime.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-end gap-2 p-4 pointer-events-none",children:[(0,jsx_runtime.jsx)("input",{ref:inputRef,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:e=>uploadCase(e.target.files)}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{var _inputRef_current;return null===(_inputRef_current=inputRef.current)||void 0===_inputRef_current?void 0:_inputRef_current.click()},className:"pointer-events-auto bg-white/80 text-black px-4 py-2 rounded",children:"Upload Picture"}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:async function takePicture(){if(!videoRef.current||!canvasRef.current)return;const video=videoRef.current,canvas=canvasRef.current;canvas.width=video.videoWidth,canvas.height=video.videoHeight;const ctx=canvas.getContext("2d");ctx&&(ctx.drawImage(video,0,0,canvas.width,canvas.height),canvas.toBlob((async blob=>{if(!blob)return;const file=new File([blob],"photo.jpg",{type:"image/jpeg"}),dt=new DataTransfer;dt.items.add(file),await uploadCase(dt.files)}),"image/jpeg"))},className:"pointer-events-auto bg-blue-600 text-white px-4 py-2 rounded w-full",children:"Take Picture"}),(0,jsx_runtime.jsx)(link_default(),{href:"/cases",className:"pointer-events-auto text-xs text-white underline mt-2",children:"Cases"})]})]})}PointAndShootPage.__docgenInfo={description:"",methods:[],displayName:"PointAndShootPage"};const PointAndShootPage_stories={component:PointAndShootPage,title:"Pages/PointAndShootPage"},Default={render:()=>(0,jsx_runtime.jsx)(PointAndShootPage,{})},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  render: () => <PointAndShootPage />\n}",...Default.parameters?.docs?.source}}}},"./src/app/useNewCaseFromFiles.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useNewCaseFromFiles});var next_navigation__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs");function useNewCaseFromFiles(){const router=(0,next_navigation__WEBPACK_IMPORTED_MODULE_0__.useRouter)();return async files=>{if(!files||0===files.length)return;const id=Date.now().toString(),preview=URL.createObjectURL(files[0]);sessionStorage.setItem(`preview-${id}`,preview);(await Promise.all(Array.from(files).map(((file,idx)=>{const formData=new FormData;formData.append("photo",file),formData.append("caseId",id);const upload=fetch("/api/upload",{method:"POST",body:formData});return 0===idx&&upload.then((()=>{sessionStorage.removeItem(`preview-${id}`)})),upload})))).some((r=>!r.ok))?alert("Failed to upload one or more files."):router.push(`/cases/${id}`)}}}}]);