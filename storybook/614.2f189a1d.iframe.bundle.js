"use strict";(self.webpackChunkapp_scaffold=self.webpackChunkapp_scaffold||[]).push([[614],{"./src/app/cases/useDragReset.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useDragReset});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function useDragReset(reset){(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{function handleDragEnd(){reset()}function handleDragLeave(e){e.relatedTarget||reset()}return window.addEventListener("dragend",handleDragEnd),window.addEventListener("drop",handleDragEnd),window.addEventListener("dragleave",handleDragLeave),()=>{window.removeEventListener("dragend",handleDragEnd),window.removeEventListener("drop",handleDragEnd),window.removeEventListener("dragleave",handleDragLeave)}}),[reset])}},"./src/app/components/AnalysisInfo.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>AnalysisInfo});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js");const US_STATES=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY","DC"];var EditableText=__webpack_require__("./src/app/components/EditableText.tsx");function AnalysisInfo({analysis,onPlateChange,onStateChange,onClearPlate,onClearState}){const{violationType,details,location,vehicle={}}=analysis;var _vehicle_licensePlateState,_vehicle_licensePlateNumber;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1 text-sm",children:[(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Violation:"})," ",violationType]}),(0,jsx_runtime.jsx)("p",{children:details}),location?(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Location clues:"})," ",location]}):null,(0,jsx_runtime.jsxs)("div",{className:"pl-4 flex flex-col gap-1",children:[vehicle.make?(0,jsx_runtime.jsxs)("span",{children:["Make: ",vehicle.make]}):null,vehicle.model?(0,jsx_runtime.jsxs)("span",{children:["Model: ",vehicle.model]}):null,vehicle.type?(0,jsx_runtime.jsxs)("span",{children:["Type: ",vehicle.type]}):null,vehicle.color?(0,jsx_runtime.jsxs)("span",{children:["Color: ",vehicle.color]}):null,onPlateChange||onStateChange?(0,jsx_runtime.jsxs)("span",{className:"inline-flex items-center gap-1",children:["Plate:",onStateChange?(0,jsx_runtime.jsx)(EditableText.A,{value:null!==(_vehicle_licensePlateState=vehicle.licensePlateState)&&void 0!==_vehicle_licensePlateState?_vehicle_licensePlateState:"",onSubmit:onStateChange,onClear:onClearState,placeholder:"state",options:US_STATES}):vehicle.licensePlateState?(0,jsx_runtime.jsx)("span",{children:vehicle.licensePlateState}):null,onPlateChange?(0,jsx_runtime.jsx)(EditableText.A,{value:null!==(_vehicle_licensePlateNumber=vehicle.licensePlateNumber)&&void 0!==_vehicle_licensePlateNumber?_vehicle_licensePlateNumber:"",onSubmit:onPlateChange,onClear:onClearPlate,placeholder:"plate"}):vehicle.licensePlateNumber?(0,jsx_runtime.jsx)("span",{children:vehicle.licensePlateNumber}):null]}):vehicle.licensePlateState||vehicle.licensePlateNumber?(0,jsx_runtime.jsxs)("span",{children:["Plate:"," ",vehicle.licensePlateState?`${vehicle.licensePlateState} `:"",vehicle.licensePlateNumber]}):null]})]})}AnalysisInfo.__docgenInfo={description:"",methods:[],displayName:"AnalysisInfo",props:{analysis:{required:!0,tsType:{name:"z.infer",elements:[{name:"violationReportSchema"}],raw:"z.infer<typeof violationReportSchema>"},description:""},onPlateChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(v: string) => Promise<void> | void",signature:{arguments:[{type:{name:"string"},name:"v"}],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""},onStateChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(v: string) => Promise<void> | void",signature:{arguments:[{type:{name:"string"},name:"v"}],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""},onClearPlate:{required:!1,tsType:{name:"signature",type:"function",raw:"() => Promise<void> | void",signature:{arguments:[],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""},onClearState:{required:!1,tsType:{name:"signature",type:"function",raw:"() => Promise<void> | void",signature:{arguments:[],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""}}}},"./src/app/components/EditableText.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>EditableText});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function EditableText({value,onSubmit,onClear,placeholder,options}){const[editing,setEditing]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[text,setText]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(value),inputRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),listId=(0,react__WEBPACK_IMPORTED_MODULE_1__.useId)();return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((()=>{setText(value)}),[value]),editing?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("input",{ref:inputRef,type:"text",value:text,placeholder,list:options?listId:void 0,onChange:e=>setText(e.target.value),onBlur:async function finish(){setEditing(!1),text!==value&&await onSubmit(text)},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()},className:"border p-1 text-sm"}),options?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("datalist",{id:listId,children:options.map((o=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("option",{value:o},o)))}):null]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{children:value||placeholder}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{type:"button",onClick:function start(){setEditing(!0),setTimeout((()=>{var _inputRef_current,_inputRef_current1;null===(_inputRef_current=inputRef.current)||void 0===_inputRef_current||_inputRef_current.focus(),null===(_inputRef_current1=inputRef.current)||void 0===_inputRef_current1||_inputRef_current1.select()}),0)},className:"text-gray-500 dark:text-gray-400",children:"✎"}),onClear&&value?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{type:"button",onClick:onClear,className:"text-gray-500 dark:text-gray-400",children:"×"}):null]})}EditableText.__docgenInfo={description:"",methods:[],displayName:"EditableText",props:{value:{required:!0,tsType:{name:"string"},description:""},onSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"(v: string) => Promise<void> | void",signature:{arguments:[{type:{name:"string"},name:"v"}],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""},onClear:{required:!1,tsType:{name:"signature",type:"function",raw:"() => Promise<void> | void",signature:{arguments:[],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},options:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""}}}},"./src/app/components/MapPreview.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>MapPreview});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),next_image__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/nextjs/dist/images/next-image.mjs"),process=__webpack_require__("./node_modules/process/browser.js");function MapPreview({lat,lon,width,height,className,link}){const key=process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY,url=key?`https://maps.googleapis.com/maps/api/staticmap?center=${lat},${lon}&zoom=16&size=${width}x${height}&markers=color:red|${lat},${lon}&key=${key}`:`https://staticmap.openstreetmap.de/staticmap.php?center=${lat},${lon}&zoom=16&size=${width}x${height}&markers=${lat},${lon},red`;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:`relative ${null!=className?className:""}`,style:{aspectRatio:`${width} / ${height}`},children:[link?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("a",{href:link,target:"_blank",rel:"noopener noreferrer",className:"absolute inset-0 z-10",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"sr-only",children:"View on map"})}):null,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(next_image__WEBPACK_IMPORTED_MODULE_1__.A,{src:url,alt:`Map preview at ${lat}, ${lon}`,fill:!0,className:"object-cover",sizes:"100vw"})]})}MapPreview.__docgenInfo={description:"",methods:[],displayName:"MapPreview",props:{lat:{required:!0,tsType:{name:"number"},description:""},lon:{required:!0,tsType:{name:"number"},description:""},width:{required:!0,tsType:{name:"number"},description:""},height:{required:!0,tsType:{name:"number"},description:""},className:{required:!1,tsType:{name:"string"},description:""},link:{required:!1,tsType:{name:"string"},description:""}}}},"./src/lib/caseUtils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function basename(filePath){const parts=filePath.split(/[\\/]/);return parts[parts.length-1]}function getRepresentativePhoto(caseData){var _caseData_analysis;if(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images){const best=Object.entries(caseData.analysis.images).sort(((a,b)=>b[1].representationScore-a[1].representationScore))[0];if(best){const name=best[0],file=caseData.photos.find((p=>basename(p)===name));if(file)return file}}return[...caseData.photos].sort()[0]}function getOfficialCaseGps(caseData){var _caseData_analysis,_caseData_gps;if((null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)&&caseData.photoGps){const entries=Object.entries(caseData.analysis.images).sort(((a,b)=>b[1].representationScore-a[1].representationScore));for(const[name]of entries){const file=caseData.photos.find((p=>basename(p)===name));if(file){const gps=caseData.photoGps[file];if(gps)return gps}}}if(caseData.photoGps)for(const p of caseData.photos){const g=caseData.photoGps[p];if(g)return g}return null!==(_caseData_gps=caseData.gps)&&void 0!==_caseData_gps?_caseData_gps:null}function hasViolation(report){var _report_violationType;if(!report)return!1;if(report.images){const all=Object.values(report.images),hasTrue=all.some((i=>!0===i.violation)),hasFalse=all.some((i=>!1===i.violation));if(hasTrue||hasFalse)return hasTrue}return Boolean(null===(_report_violationType=report.violationType)||void 0===_report_violationType?void 0:_report_violationType.trim())}function getCaseVin(caseData){var _caseData_analysis;if(caseData.vin)return caseData.vin;const imgs=(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const vin=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.vin;if(vin)return vin}return null}function getCasePlateNumber(caseData){var _caseData_analysis_vehicle,_caseData_analysis,_caseData_analysis1;const direct=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis||null===(_caseData_analysis_vehicle=_caseData_analysis.vehicle)||void 0===_caseData_analysis_vehicle?void 0:_caseData_analysis_vehicle.licensePlateNumber;if(direct)return direct;const imgs=(null===(_caseData_analysis1=caseData.analysis)||void 0===_caseData_analysis1?void 0:_caseData_analysis1.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const plate=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.licensePlateNumber;if(plate)return plate}return null}function getCasePlateState(caseData){var _caseData_analysis_vehicle,_caseData_analysis,_caseData_analysis1;const direct=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis||null===(_caseData_analysis_vehicle=_caseData_analysis.vehicle)||void 0===_caseData_analysis_vehicle?void 0:_caseData_analysis_vehicle.licensePlateState;if(direct)return direct;const imgs=(null===(_caseData_analysis1=caseData.analysis)||void 0===_caseData_analysis1?void 0:_caseData_analysis1.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const state=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.licensePlateState;if(state)return state}return null}function getCaseOwnerContact(caseData){var _caseData_analysis;const imgs=(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo;const contact=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo?void 0:_info_paperworkInfo.contact;if(contact)return contact}return null}function getCaseOwnerContactInfo(caseData){const contact=getCaseOwnerContact(caseData);return contact?function parseContactInfo(text){const emailMatch=text.match(/[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}/),phoneMatch=text.match(/\+?\d[\d\s().-]{7,}\d/);let address;return text.trim().split(/\n+/).length>1&&(address=text.trim()),{email:emailMatch?emailMatch[0]:void 0,phone:phoneMatch?phoneMatch[0]:void 0,address}}(contact):null}function getBestViolationPhoto(caseData){var _caseData_analysis,_caseData_analysis_images;const imgs=null!==(_caseData_analysis_images=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)&&void 0!==_caseData_analysis_images?_caseData_analysis_images:{},entries=Object.entries(imgs).filter((([,info])=>info.violation)).sort(((a,b)=>b[1].representationScore-a[1].representationScore)),best=entries[0];if(!best)return null;const[name,info]=best,file=caseData.photos.find((p=>basename(p)===name));return file?{photo:file,caption:info.highlights}:null}function getAnalysisSummary(report){var _report_vehicle,_report_vehicle1;const parts=[`Violation: ${report.violationType}`,report.details];report.location&&parts.push(`Location: ${report.location}`);const plate=[];return(null===(_report_vehicle=report.vehicle)||void 0===_report_vehicle?void 0:_report_vehicle.licensePlateState)&&plate.push(report.vehicle.licensePlateState),(null===(_report_vehicle1=report.vehicle)||void 0===_report_vehicle1?void 0:_report_vehicle1.licensePlateNumber)&&plate.push(report.vehicle.licensePlateNumber),plate.length>0&&parts.push(`Plate: ${plate.join(" ")}`),parts.filter(Boolean).join("\n")}__webpack_require__.d(__webpack_exports__,{E5:()=>getCaseVin,Pk:()=>getAnalysisSummary,UO:()=>hasViolation,W7:()=>getCasePlateState,_g:()=>getBestViolationPhoto,g_:()=>getCaseOwnerContact,qR:()=>getOfficialCaseGps,qy:()=>getCasePlateNumber,sC:()=>getCaseOwnerContactInfo,wq:()=>getRepresentativePhoto})}}]);