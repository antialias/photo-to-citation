(self.webpackChunkapp_scaffold=self.webpackChunkapp_scaffold||[]).push([[461],{"./node_modules/next/dist/client/use-merged-ref.js":(module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"useMergedRef",{enumerable:!0,get:function(){return useMergedRef}});const _react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function useMergedRef(refA,refB){const cleanupA=(0,_react.useRef)(null),cleanupB=(0,_react.useRef)(null);return(0,_react.useCallback)(current=>{if(null===current){const cleanupFnA=cleanupA.current;cleanupFnA&&(cleanupA.current=null,cleanupFnA());const cleanupFnB=cleanupB.current;cleanupFnB&&(cleanupB.current=null,cleanupFnB())}else refA&&(cleanupA.current=applyRef(refA,current)),refB&&(cleanupB.current=applyRef(refB,current))},[refA,refB])}function applyRef(refA,current){if("function"==typeof refA){const cleanup=refA(current);return"function"==typeof cleanup?cleanup:()=>refA(null)}return refA.current=current,()=>{refA.current=null}}("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default)},"./src/apiClient.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{a:()=>apiEventSource,n:()=>apiFetch});var _basePath__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/basePath.ts");async function apiFetch(input,init){return fetch((0,_basePath__WEBPACK_IMPORTED_MODULE_0__.h)(input),init)}function apiEventSource(input){return new EventSource((0,_basePath__WEBPACK_IMPORTED_MODULE_0__.h)(input))}},"./src/app/components/NotificationProvider.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{l:()=>useNotify});__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js");var react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");__webpack_require__("./node_modules/react-hot-toast/dist/index.mjs");const NotifyContext=(0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)(()=>{});function useNotify(){return(0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(NotifyContext)}},"./src/app/point/PointAndShootPage.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>PointAndShootPage_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),next_link=__webpack_require__("./node_modules/next/link.js"),link_default=__webpack_require__.n(next_link),navigation=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),useAddFilesToCase=__webpack_require__("./src/app/useAddFilesToCase.ts"),useNewCaseFromFiles=__webpack_require__("./src/app/useNewCaseFromFiles.ts"),console=__webpack_require__("./node_modules/console-browserify/index.js");function PointAndShootPage(){const videoRef=(0,react.useRef)(null),canvasRef=(0,react.useRef)(null),inputRef=(0,react.useRef)(null),workerRef=(0,react.useRef)(null),[analysisHint,setAnalysisHint]=(0,react.useState)(null),[cameraError,setCameraError]=(0,react.useState)(null),[uploading,setUploading]=(0,react.useState)(!1),caseId=(0,navigation.useSearchParams)().get("case")||null,addFiles=(0,useAddFilesToCase.A)(null!=caseId?caseId:""),newCase=(0,useNewCaseFromFiles.A)(),uploadCase=caseId?addFiles:newCase;return(0,react.useEffect)(()=>{!async function startCamera(){var _navigator_mediaDevices;if(null===(_navigator_mediaDevices=navigator.mediaDevices)||void 0===_navigator_mediaDevices?void 0:_navigator_mediaDevices.getUserMedia)if("https:"===location.protocol||"localhost"===location.hostname)try{const constraints={audio:!1,video:{facingMode:"environment"}},stream=await navigator.mediaDevices.getUserMedia(constraints),v=videoRef.current;v&&(v.setAttribute("autoplay",""),v.setAttribute("muted",""),v.setAttribute("playsinline",""),"srcObject"in v?v.srcObject=stream:v.src=URL.createObjectURL(stream),v.onloadedmetadata=()=>{v.play().catch(()=>{})})}catch(err){console.error("Could not access camera",err),setCameraError("Unable to access camera. Please check permissions.")}else setCameraError("Camera requires a secure connection (HTTPS).");else setCameraError("Camera API not available. Use HTTPS and a compatible browser.")}();const w="undefined"==typeof Worker?null:new Worker(new URL(__webpack_require__.p+__webpack_require__.u(333),__webpack_require__.b),{type:void 0});w&&(workerRef.current=w,w.postMessage({type:"load",modelUrl:"/models/demo.onnx"}),w.onmessage=e=>{if("result"===e.data.type){var _r_vehicle;const r=e.data.result;var _r_vehicle_licensePlateNumber,_ref;setAnalysisHint(null!==(_ref=null!==(_r_vehicle_licensePlateNumber=null===(_r_vehicle=r.vehicle)||void 0===_r_vehicle?void 0:_r_vehicle.licensePlateNumber)&&void 0!==_r_vehicle_licensePlateNumber?_r_vehicle_licensePlateNumber:r.violationType)&&void 0!==_ref?_ref:null)}});let handle=0;handle=window.setInterval(()=>{const video=videoRef.current,canvas=canvasRef.current;if(!video||!canvas||!w)return;const ctx=canvas.getContext("2d");if(!ctx)return;if(canvas.width=video.videoWidth,canvas.height=video.videoHeight,0===canvas.width||0===canvas.height)return;ctx.drawImage(video,0,0,canvas.width,canvas.height);const data=ctx.getImageData(0,0,canvas.width,canvas.height);w.postMessage({type:"analyze",image:data},[data.data.buffer])},2e3);const v=videoRef.current;return()=>{if(null==v?void 0:v.srcObject)for(const t of v.srcObject.getTracks())t.stop();w&&w.terminate(),clearInterval(handle)}},[]),(0,jsx_runtime.jsxs)("div",{className:"relative h-[100dvh] overflow-hidden bg-black",children:[cameraError&&(0,jsx_runtime.jsx)("div",{className:"absolute inset-x-0 top-0 z-10 bg-red-600 text-white text-center py-2",children:cameraError}),(0,jsx_runtime.jsx)("video",{ref:videoRef,autoPlay:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover z-0",children:(0,jsx_runtime.jsx)("track",{kind:"captions",label:""})}),(0,jsx_runtime.jsx)("canvas",{ref:canvasRef,className:"hidden"}),uploading?(0,jsx_runtime.jsx)("div",{className:"absolute inset-0 bg-black/50 text-white flex items-center justify-center pointer-events-none text-xl z-10",children:"Uploading photo..."}):null,(0,jsx_runtime.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:(0,jsx_runtime.jsx)("div",{className:"bg-black/40 text-white px-2 py-1 rounded text-xl","data-testid":"hint",children:null!=analysisHint?analysisHint:"Nothing has been detected"})}),(0,jsx_runtime.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-end gap-2 p-4 pointer-events-none",children:[(0,jsx_runtime.jsx)("input",{ref:inputRef,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:e=>async function handleInputChange(files){setUploading(!0),await uploadCase(files)}(e.target.files)}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{var _inputRef_current;return null===(_inputRef_current=inputRef.current)||void 0===_inputRef_current?void 0:_inputRef_current.click()},disabled:uploading,className:"pointer-events-auto bg-white/80 text-black px-4 py-2 rounded disabled:opacity-50",children:"Upload Picture"}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:async function takePicture(){if(!videoRef.current||!canvasRef.current)return;setUploading(!0);const video=videoRef.current,canvas=canvasRef.current;canvas.width=video.videoWidth,canvas.height=video.videoHeight;const ctx=canvas.getContext("2d");ctx&&(ctx.drawImage(video,0,0,canvas.width,canvas.height),canvas.toBlob(async blob=>{if(!blob)return;const file=new File([blob],"photo.jpg",{type:"image/jpeg"}),dt=new DataTransfer;dt.items.add(file),await uploadCase(dt.files)},"image/jpeg"))},disabled:uploading,className:"pointer-events-auto bg-blue-600 text-white px-4 py-2 rounded w-full disabled:opacity-50",children:"Take Picture"}),(0,jsx_runtime.jsx)(link_default(),{href:caseId?`/cases/${caseId}`:"/cases",className:"pointer-events-auto text-xs text-white underline mt-2",children:caseId?"Back to Case":"Cases"})]})]})}PointAndShootPage.__docgenInfo={description:"",methods:[],displayName:"PointAndShootPage"};const PointAndShootPage_stories={component:PointAndShootPage,title:"Pages/PointAndShootPage"},Default={render:()=>(0,jsx_runtime.jsx)(PointAndShootPage,{})},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  render: () => <PointAndShootPage />\n}",...Default.parameters?.docs?.source}}}},"./src/app/useAddFilesToCase.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>useAddFilesToCase});var _apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/apiClient.ts"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useMutation.js"),next_navigation__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/app/components/NotificationProvider.tsx");function useAddFilesToCase(caseId){const router=(0,next_navigation__WEBPACK_IMPORTED_MODULE_1__.useRouter)(),notify=(0,_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_2__.l)(),uploadMutation=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_3__.n)({mutationFn:async formData=>(0,_apiClient__WEBPACK_IMPORTED_MODULE_0__.n)("/api/upload",{method:"POST",body:formData})});return async files=>{if(!files||0===files.length)return;(await Promise.all(Array.from(files).map(file=>{const formData=new FormData;return formData.append("photo",file),formData.append("caseId",caseId),uploadMutation.mutateAsync(formData)}))).some(r=>!r.ok)?notify("Failed to upload one or more files."):router.push(`/cases/${caseId}`)}}},"./src/app/useNewCaseFromFiles.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>useNewCaseFromFiles});var _apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/apiClient.ts"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useMutation.js"),next_navigation__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/app/components/NotificationProvider.tsx");function useNewCaseFromFiles(){const router=(0,next_navigation__WEBPACK_IMPORTED_MODULE_1__.useRouter)(),notify=(0,_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_2__.l)(),uploadMutation=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_3__.n)({mutationFn:async formData=>(0,_apiClient__WEBPACK_IMPORTED_MODULE_0__.n)("/api/upload",{method:"POST",body:formData})});return async files=>{if(!files||0===files.length)return;const id=Date.now().toString(),preview=URL.createObjectURL(files[0]);sessionStorage.setItem(`preview-${id}`,preview);(await Promise.all(Array.from(files).map((file,idx)=>{const formData=new FormData;formData.append("photo",file),formData.append("caseId",id);const upload=uploadMutation.mutateAsync(formData);return 0===idx&&upload.then(()=>{sessionStorage.removeItem(`preview-${id}`)}),upload}))).some(r=>!r.ok)?notify("Failed to upload one or more files."):router.push(`/cases/${id}`)}}},"./src/basePath.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{h:()=>withBasePath});const BASE_PATH=__webpack_require__("./src/lib/config.ts").$.NEXT_PUBLIC_BASE_PATH||"";function withBasePath(path){return`${BASE_PATH}${path}`}},"./src/lib/config.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{$:()=>config});var dotenv__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/dotenv/lib/main.js"),dotenv__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(dotenv__WEBPACK_IMPORTED_MODULE_0__),zod__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/zod/dist/esm/index.js"),process=__webpack_require__("./node_modules/process/browser.js");dotenv__WEBPACK_IMPORTED_MODULE_0___default().config();const envSchema=zod__WEBPACK_IMPORTED_MODULE_1__.z.object({OPENAI_API_KEY:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),OPENAI_BASE_URL:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),LLM_PROVIDERS:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().default("openai"),LLM_DRAFT_EMAIL_MODEL:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().default("gpt-4o"),LLM_DRAFT_EMAIL_PROVIDER:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().default("openai"),LLM_ANALYZE_IMAGES_MODEL:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().default("gpt-4o"),LLM_ANALYZE_IMAGES_PROVIDER:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().default("openai"),LLM_OCR_PAPERWORK_MODEL:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().default("gpt-4o"),LLM_OCR_PAPERWORK_PROVIDER:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().default("openai"),LLM_EXTRACT_INFO_MODEL:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().default("gpt-4o"),LLM_EXTRACT_INFO_PROVIDER:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().default("openai"),GOOGLE_MAPS_API_KEY:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),NEXT_PUBLIC_GOOGLE_MAPS_API_KEY:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),SMTP_HOST:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),SMTP_PORT:zod__WEBPACK_IMPORTED_MODULE_1__.z.coerce.number().optional(),SMTP_SECURE:zod__WEBPACK_IMPORTED_MODULE_1__.z.coerce.boolean().optional(),SMTP_USER:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),SMTP_PASS:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),SMTP_FROM:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),MOCK_EMAIL_TO:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),EMAIL_FILE:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),SUPER_ADMIN_EMAIL:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),NEXTAUTH_SECRET:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),NEXTAUTH_URL:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),GOOGLE_CLIENT_ID:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),GOOGLE_CLIENT_SECRET:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),CASE_STORE_FILE:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),VIN_SOURCE_FILE:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),SNAIL_MAIL_FILE:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),SNAIL_MAIL_PROVIDER_FILE:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),RETURN_ADDRESS:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),SNAIL_MAIL_PROVIDER:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().default("mock"),SNAIL_MAIL_OUT_DIR:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),TWILIO_ACCOUNT_SID:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),TWILIO_AUTH_TOKEN:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),TWILIO_FROM_NUMBER:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),DOCSMIT_BASE_URL:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),DOCSMIT_EMAIL:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),DOCSMIT_PASSWORD:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),DOCSMIT_SOFTWARE_ID:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),IMAP_HOST:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),IMAP_PORT:zod__WEBPACK_IMPORTED_MODULE_1__.z.coerce.number().optional(),IMAP_USER:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),IMAP_PASS:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),IMAP_TLS:zod__WEBPACK_IMPORTED_MODULE_1__.z.coerce.boolean().default(!0),INBOX_STATE_FILE:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().optional(),NEXT_PUBLIC_BROWSER_DEBUG:zod__WEBPACK_IMPORTED_MODULE_1__.z.coerce.boolean().default(!1),NEXT_PUBLIC_BASE_PATH:zod__WEBPACK_IMPORTED_MODULE_1__.z.string().default("")}).passthrough();const config={...function getConfig(){return envSchema.parse(process.env)}(),NEXT_PUBLIC_GOOGLE_MAPS_API_KEY:process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY,NEXT_PUBLIC_BROWSER_DEBUG:"true"===process.env.NEXT_PUBLIC_BROWSER_DEBUG,NEXT_PUBLIC_BASE_PATH:process.env.NEXT_PUBLIC_BASE_PATH||""}},"?0aec":()=>{},"?3fc0":()=>{},"?4068":()=>{},"?593c":()=>{},"?7bec":()=>{},"?8131":()=>{},"?a0c3":()=>{},"?cad2":()=>{},"?d546":()=>{},"?e7e4":()=>{},"?fbf1":()=>{}}]);