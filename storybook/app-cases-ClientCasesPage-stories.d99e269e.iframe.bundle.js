"use strict";(self.webpackChunkapp_scaffold=self.webpackChunkapp_scaffold||[]).push([[3590],{"./.storybook/MapPreviewStub.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>MapPreviewStub});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js");function MapPreviewStub({width,height,className}){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:null!=className?className:"",style:{aspectRatio:`${width} / ${height}`},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("img",{src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='150'%3E%3Crect width='100%25' height='100%25' fill='%23ddd'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23666' font-family='sans-serif' font-size='20'%3EMap Preview%3C/text%3E%3C/svg%3E",alt:"Map preview placeholder",width,height,loading:"lazy"})})}MapPreviewStub.__docgenInfo={description:"",methods:[],displayName:"MapPreviewStub",props:{width:{required:!0,tsType:{name:"number"},description:""},height:{required:!0,tsType:{name:"number"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}}},"./src/app/cases/ClientCasesPage.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MultipleCases:()=>MultipleCases,SelectedCase:()=>SelectedCase,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ClientCasesPage_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),apiClient=__webpack_require__("./src/apiClient.ts"),AnalysisInfo=__webpack_require__("./src/app/components/AnalysisInfo.tsx"),MapPreviewStub=__webpack_require__("./.storybook/MapPreviewStub.tsx"),useNewCaseFromFiles=__webpack_require__("./src/app/useNewCaseFromFiles.ts"),caseUtils=__webpack_require__("./src/lib/caseUtils.ts");const WGS84_F=1/298.257223563;function toRad(deg){return deg*Math.PI/180}function distanceBetween(a,b){const L=toRad(b.lon-a.lon),U1=Math.atan((1-WGS84_F)*Math.tan(toRad(a.lat))),U2=Math.atan((1-WGS84_F)*Math.tan(toRad(b.lat))),sinU1=Math.sin(U1),cosU1=Math.cos(U1),sinU2=Math.sin(U2),cosU2=Math.cos(U2);let lambda=L,lambdaP=0,iter=0,cosSqAlpha=0,sinSigma=0,cosSigma=0,sigma=0,cos2SigmaM=0;do{const sinLambda=Math.sin(lambda),cosLambda=Math.cos(lambda);if(sinSigma=Math.sqrt((cosU2*sinLambda)**2+(cosU1*sinU2-sinU1*cosU2*cosLambda)**2),0===sinSigma)return 0;cosSigma=sinU1*sinU2+cosU1*cosU2*cosLambda,sigma=Math.atan2(sinSigma,cosSigma);const sinAlpha=cosU1*cosU2*sinLambda/sinSigma;cosSqAlpha=1-sinAlpha**2,cos2SigmaM=0!==cosSqAlpha?cosSigma-2*sinU1*sinU2/cosSqAlpha:0;const C=WGS84_F/16*cosSqAlpha*(4+WGS84_F*(4-3*cosSqAlpha));lambdaP=lambda,lambda=L+(1-C)*WGS84_F*sinAlpha*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(2*cos2SigmaM**2-1)))}while(Math.abs(lambda-lambdaP)>1e-12&&++iter<1e3);const uSq=272331606109.84375*cosSqAlpha/40408299984659.16,B=uSq/1024*(256+uSq*(uSq*(74-47*uSq)-128));return 6356752.314245*(1+uSq/16384*(4096+uSq*(uSq*(320-175*uSq)-768)))*(sigma-B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(2*cos2SigmaM**2-1)-B/6*cos2SigmaM*(4*sinSigma**2-3)*(4*cos2SigmaM**2-3))))}var QueryClientProvider=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js"),next_link=__webpack_require__("./node_modules/next/link.js"),link_default=__webpack_require__.n(next_link),navigation=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),NotificationProvider=__webpack_require__("./src/app/components/NotificationProvider.tsx"),useCase=__webpack_require__("./src/app/hooks/useCase.ts"),useEventSource=__webpack_require__("./src/app/hooks/useEventSource.ts"),useSession=__webpack_require__("./src/app/useSession.ts"),useDragReset=__webpack_require__("./src/app/cases/useDragReset.ts");function sortList(list,key,location){if("distance"===key&&location)return[...list].sort((a,b)=>{const ag=(0,caseUtils.qR)(a),bg=(0,caseUtils.qR)(b);return ag||bg?ag?bg?distanceBetween(location,ag)-distanceBetween(location,bg):-1:1:0});const k=key;return[...list].sort((a,b)=>{var _b_k,_a_k;return new Date(null!==(_b_k=b[k])&&void 0!==_b_k?_b_k:b.createdAt).getTime()-new Date(null!==(_a_k=a[k])&&void 0!==_a_k?_a_k:a.createdAt).getTime()})}function ClientCasesPage({initialCases}){var _searchParams_get;const[orderBy,setOrderBy]=(0,react.useState)("createdAt"),[cases,setCases]=(0,react.useState)(()=>sortList(initialCases,"createdAt")),[states,setStates]=(0,react.useState)(["open"]),[userLocation,setUserLocation]=(0,react.useState)(null),router=(0,navigation.useRouter)(),{t,i18n}=(0,es.Bd)(),uploadNewCase=(0,useNewCaseFromFiles.A)(),[dragging,setDragging]=(0,react.useState)(!1),[dropCase,setDropCase]=(0,react.useState)(null),queryClient=(0,QueryClientProvider.jE)(),notify=(0,NotificationProvider.l)(),{data:session}=(0,useSession.wV)(),params=(0,navigation.useParams)();var _searchParams_get_split_filter;const selectedIds=null!==(_searchParams_get_split_filter=null===(_searchParams_get=(0,navigation.useSearchParams)().get("ids"))||void 0===_searchParams_get?void 0:_searchParams_get.split(",").filter(Boolean))&&void 0!==_searchParams_get_split_filter?_searchParams_get_split_filter:params.id?[params.id]:[];return(0,useEventSource.A)(session?"/api/cases/stream":null,data=>{setCases(prev=>{if(data.deleted)return sortList(prev.filter(c=>c.id!==data.id),orderBy,userLocation);const idx=prev.findIndex(c=>c.id===data.id);if(-1===idx)return sortList([...prev,data],orderBy,userLocation);const copy=[...prev];return copy[idx]=data,sortList(copy,orderBy,userLocation)})}),(0,react.useEffect)(()=>{setCases(prev=>sortList(prev,orderBy,userLocation))},[orderBy,userLocation]),(0,react.useEffect)(()=>{"distance"===orderBy&&!userLocation&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(pos=>{setUserLocation({lat:pos.coords.latitude,lon:pos.coords.longitude})})},[orderBy,userLocation]),(0,useDragReset.A)(()=>{setDragging(!1),setDropCase(null)}),(0,jsx_runtime.jsxs)("div",{className:"p-8 relative h-full",onDragOver:e=>e.preventDefault(),onDragEnter:e=>{e.preventDefault(),setDragging(!0)},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||(setDragging(!1),setDropCase(null))},onDrop:async e=>{e.preventDefault();const files=e.dataTransfer.files;dropCase?await async function uploadFilesToCase(id,files){(await Promise.all(Array.from(files).map(file=>{const formData=new FormData;return formData.append("photo",file),formData.append("caseId",id),(0,apiClient.n)("/api/upload",{method:"POST",body:formData})}))).some(r=>!r.ok)&&notify(t("failedUpload"))}(dropCase,files):await uploadNewCase(files),setDragging(!1),setDropCase(null)},children:[(0,jsx_runtime.jsx)("h1",{className:"text-xl font-bold mb-4",children:t("nav.cases")}),(0,jsx_runtime.jsxs)("div",{className:"mb-4 flex items-center gap-4",children:[(0,jsx_runtime.jsx)("label",{className:"mr-2",htmlFor:"order",children:t("orderBy")}),(0,jsx_runtime.jsxs)("select",{id:"order",value:orderBy,onChange:e=>setOrderBy(e.target.value),className:"border rounded p-1 bg-white dark:bg-gray-900",children:[(0,jsx_runtime.jsx)("option",{value:"createdAt",children:t("creationDate")}),(0,jsx_runtime.jsx)("option",{value:"updatedAt",children:t("lastUpdated")}),(0,jsx_runtime.jsx)("option",{value:"distance",children:t("distanceFromMe")})]}),(0,jsx_runtime.jsxs)("label",{className:"flex items-center gap-1",htmlFor:"case-states",children:[(0,jsx_runtime.jsx)("span",{children:t("show")}),(0,jsx_runtime.jsxs)("select",{id:"case-states",multiple:!0,value:states,onChange:e=>setStates(Array.from(e.target.selectedOptions).map(o=>o.value)),className:"border rounded p-1 bg-white dark:bg-gray-900",children:[(0,jsx_runtime.jsx)("option",{value:"open",children:t("open")}),(0,jsx_runtime.jsx)("option",{value:"archived",children:t("archived")}),(0,jsx_runtime.jsx)("option",{value:"closed",children:t("closed")})]})]})]}),(0,jsx_runtime.jsx)("ul",{className:"grid gap-4",children:cases.filter(c=>{const state=c.archived?"archived":c.closed?"closed":"open";return states.includes(state)}).map(c=>(0,jsx_runtime.jsx)("li",{onDragEnter:()=>{setDropCase(c.id),setDragging(!0)},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||setDropCase(null)},className:"border p-2 "+(selectedIds.includes(c.id)?"bg-gray-100 dark:bg-gray-800 ring-2 ring-blue-500":dropCase===c.id?"ring-2 ring-green-500":"ring-1 ring-transparent"),children:(0,jsx_runtime.jsxs)(link_default(),{href:session?`/cases/${c.id}`:`/public/cases/${c.id}`,onClick:e=>{if(e.shiftKey){e.preventDefault();const ids=Array.from(new Set([...selectedIds,c.id]));router.push(`/cases?ids=${ids.join(",")}`)}},className:"flex flex-wrap lg:flex-nowrap items-start gap-4 w-full text-left",children:[(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(()=>{const photo=(0,caseUtils.wq)(c);return photo?(0,jsx_runtime.jsx)("img",{src:`/uploads/${photo}`,alt:t("casePreview"),width:80,height:60,loading:"lazy"}):null})(),c.photos.length>1?(0,jsx_runtime.jsx)("span",{className:"absolute bottom-1 right-1 bg-black bg-opacity-75 text-white text-xs rounded px-1",children:c.photos.length}):null]}),(()=>{const g=(0,caseUtils.qR)(c);return g?(0,jsx_runtime.jsx)(MapPreviewStub.A,{lat:g.lat,lon:g.lon,width:120,height:90,className:"w-20 aspect-[4/3]"}):null})(),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col text-sm gap-1",children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:t("caseLabel",{id:c.id})}),c.analysis?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(AnalysisInfo.A,{analysis:c.analysis,onTranslate:()=>async function translate(id,path,lang){(await(0,apiClient.n)(`/api/cases/${id}/translate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path,lang})})).ok?queryClient.invalidateQueries({queryKey:(0,useCase.U)(id)}):notify("Failed to translate.")}(c.id,"analysis.details",i18n.language)}),"pending"===c.analysisStatus?(0,jsx_runtime.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:t("updatingAnalysis")}):null]}):(0,jsx_runtime.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:t("analyzingPhoto")})]})]})},c.id))}),dragging?(0,jsx_runtime.jsx)("div",{className:"absolute inset-0 bg-black/50 text-white flex items-center justify-center pointer-events-none text-xl z-nav",children:dropCase?t("addPhotosToCase",{id:dropCase}):t("dropPhotosToCreateCase")}):null]})}ClientCasesPage.__docgenInfo={description:"",methods:[],displayName:"ClientCasesPage",props:{initialCases:{required:!0,tsType:{name:"Array",elements:[{name:"Case"}],raw:"Case[]"},description:""}}};const ClientCasesPage_stories={component:ClientCasesPage,title:"Pages/ClientCasesPage"},caseBase={photos:["https://placehold.co/600x400?text=photo"],photoTimes:{},createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),gps:{lat:41.88,lon:-87.78},streetAddress:null,intersection:null,vin:null,vinOverride:null,analysis:null,analysisOverrides:null,analysisStatus:"pending",analysisStatusCode:null,public:!1,sentEmails:[],ownershipRequests:[]},MultipleCases={render:()=>{const cases=[{id:"1",...caseBase,analysis:{violationType:"parking",details:{en:"Blocking sidewalk"},vehicle:{licensePlateNumber:"ABC123"},location:"Oak Park",images:{}},analysisStatus:"complete"},{id:"2",...caseBase,photos:["https://placehold.co/600x400?text=photo2","https://placehold.co/601x400?text=photo3"]}];return(0,jsx_runtime.jsx)(ClientCasesPage,{initialCases:cases})}},SelectedCase={render:()=>{const cases=[{id:"1",...caseBase},{id:"2",...caseBase}];return(0,jsx_runtime.jsx)(ClientCasesPage,{initialCases:cases})}},__namedExportsOrder=["MultipleCases","SelectedCase"];MultipleCases.parameters={...MultipleCases.parameters,docs:{...MultipleCases.parameters?.docs,source:{originalSource:'{\n  render: () => {\n    const cases: Case[] = [{\n      id: "1",\n      ...caseBase,\n      analysis: {\n        violationType: "parking",\n        details: {\n          en: "Blocking sidewalk"\n        },\n        vehicle: {\n          licensePlateNumber: "ABC123"\n        },\n        location: "Oak Park",\n        images: {}\n      },\n      analysisStatus: "complete"\n    }, {\n      id: "2",\n      ...caseBase,\n      photos: ["https://placehold.co/600x400?text=photo2", "https://placehold.co/601x400?text=photo3"]\n    }];\n    return <ClientCasesPage initialCases={cases} />;\n  }\n}',...MultipleCases.parameters?.docs?.source}}},SelectedCase.parameters={...SelectedCase.parameters,docs:{...SelectedCase.parameters?.docs,source:{originalSource:'{\n  render: () => {\n    const cases: Case[] = [{\n      id: "1",\n      ...caseBase\n    }, {\n      id: "2",\n      ...caseBase\n    }];\n    return <ClientCasesPage initialCases={cases} />;\n  }\n}',...SelectedCase.parameters?.docs?.source}}}},"./src/app/cases/useDragReset.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useDragReset});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function useDragReset(reset){(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{function handleDragEnd(){reset()}function handleDragLeave(e){e.relatedTarget||reset()}return window.addEventListener("dragend",handleDragEnd),window.addEventListener("drop",handleDragEnd),window.addEventListener("dragleave",handleDragLeave),()=>{window.removeEventListener("dragend",handleDragEnd),window.removeEventListener("drop",handleDragEnd),window.removeEventListener("dragleave",handleDragLeave)}},[reset])}},"./src/app/components/AnalysisInfo.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>AnalysisInfo});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),localizedText=__webpack_require__("./src/lib/localizedText.ts");const US_STATES=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY","DC"];var es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),EditableText=__webpack_require__("./src/app/components/EditableText.tsx"),InlineTranslateButton=__webpack_require__("./src/app/components/InlineTranslateButton.tsx");function AnalysisInfo({analysis,onPlateChange,onStateChange,onClearPlate,onClearState,onTranslate}){const{i18n,t}=(0,es.Bd)(),{violationType,details,location,vehicle={}}=analysis,{text:detailText,needsTranslation}=(0,localizedText.P)(details,i18n.language);var _vehicle_licensePlateState,_vehicle_licensePlateNumber;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1 text-sm",children:[(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Violation:"})," ",violationType]}),(0,jsx_runtime.jsxs)("p",{children:[detailText,needsTranslation?(0,jsx_runtime.jsx)(InlineTranslateButton.A,{lang:i18n.language,onTranslate:()=>null==onTranslate?void 0:onTranslate("analysis.details",i18n.language)}):null]}),location?(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Location clues:"})," ",location]}):null,(0,jsx_runtime.jsxs)("div",{className:"pl-4 flex flex-col gap-1",children:[vehicle.make?(0,jsx_runtime.jsxs)("span",{children:["Make: ",vehicle.make]}):null,vehicle.model?(0,jsx_runtime.jsxs)("span",{children:["Model: ",vehicle.model]}):null,vehicle.type?(0,jsx_runtime.jsxs)("span",{children:["Type: ",vehicle.type]}):null,vehicle.color?(0,jsx_runtime.jsxs)("span",{children:["Color: ",vehicle.color]}):null,onPlateChange||onStateChange?(0,jsx_runtime.jsxs)("span",{className:"inline-flex items-center gap-1",children:["Plate:",onStateChange?(0,jsx_runtime.jsx)(EditableText.A,{value:null!==(_vehicle_licensePlateState=vehicle.licensePlateState)&&void 0!==_vehicle_licensePlateState?_vehicle_licensePlateState:"",onSubmit:onStateChange,onClear:onClearState,placeholder:"state",options:US_STATES}):vehicle.licensePlateState?(0,jsx_runtime.jsx)("span",{children:vehicle.licensePlateState}):null,onPlateChange?(0,jsx_runtime.jsx)(EditableText.A,{value:null!==(_vehicle_licensePlateNumber=vehicle.licensePlateNumber)&&void 0!==_vehicle_licensePlateNumber?_vehicle_licensePlateNumber:"",onSubmit:onPlateChange,onClear:onClearPlate,placeholder:"plate"}):vehicle.licensePlateNumber?(0,jsx_runtime.jsx)("span",{children:vehicle.licensePlateNumber}):null]}):vehicle.licensePlateState||vehicle.licensePlateNumber?(0,jsx_runtime.jsxs)("span",{children:["Plate:"," ",vehicle.licensePlateState?`${vehicle.licensePlateState} `:"",vehicle.licensePlateNumber]}):null]})]})}AnalysisInfo.__docgenInfo={description:"",methods:[],displayName:"AnalysisInfo",props:{analysis:{required:!0,tsType:{name:"ViolationReport"},description:""},onPlateChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(v: string) => Promise<void> | void",signature:{arguments:[{type:{name:"string"},name:"v"}],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""},onStateChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(v: string) => Promise<void> | void",signature:{arguments:[{type:{name:"string"},name:"v"}],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""},onClearPlate:{required:!1,tsType:{name:"signature",type:"function",raw:"() => Promise<void> | void",signature:{arguments:[],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""},onClearState:{required:!1,tsType:{name:"signature",type:"function",raw:"() => Promise<void> | void",signature:{arguments:[],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""},onTranslate:{required:!1,tsType:{name:"signature",type:"function",raw:"(path: string, lang: string) => Promise<void> | void",signature:{arguments:[{type:{name:"string"},name:"path"},{type:{name:"string"},name:"lang"}],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""}}}},"./src/app/components/EditableText.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>EditableText});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function EditableText({value,onSubmit,onClear,placeholder,options}){const[editing,setEditing]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[text,setText]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(value),inputRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),listId=(0,react__WEBPACK_IMPORTED_MODULE_1__.useId)();return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{setText(value)},[value]),editing?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("input",{ref:inputRef,type:"text",value:text,placeholder,list:options?listId:void 0,onChange:e=>setText(e.target.value),onBlur:async function finish(){setEditing(!1),text!==value&&await onSubmit(text)},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()},className:"border p-1 text-sm"}),options?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("datalist",{id:listId,children:options.map(o=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("option",{value:o},o))}):null]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{children:value||placeholder}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{type:"button",onClick:function start(){setEditing(!0),setTimeout(()=>{var _inputRef_current,_inputRef_current1;null===(_inputRef_current=inputRef.current)||void 0===_inputRef_current||_inputRef_current.focus(),null===(_inputRef_current1=inputRef.current)||void 0===_inputRef_current1||_inputRef_current1.select()},0)},className:"text-gray-500 dark:text-gray-400",children:"âœŽ"}),onClear&&value?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{type:"button",onClick:onClear,className:"text-gray-500 dark:text-gray-400",children:"Ã—"}):null]})}EditableText.__docgenInfo={description:"",methods:[],displayName:"EditableText",props:{value:{required:!0,tsType:{name:"string"},description:""},onSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"(v: string) => Promise<void> | void",signature:{arguments:[{type:{name:"string"},name:"v"}],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""},onClear:{required:!1,tsType:{name:"signature",type:"function",raw:"() => Promise<void> | void",signature:{arguments:[],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:""},options:{required:!1,tsType:{name:"unknown"},description:""}}}},"./src/app/components/InlineTranslateButton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>InlineTranslateButton});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),index_esm=__webpack_require__("__barrel_optimize__?names=FaBars,FaUserCircle!=!./node_modules/react-icons/fa/index.esm.js");const FLAGS={en:"ðŸ‡ºðŸ‡¸",es:"ðŸ‡ªðŸ‡¸",fr:"ðŸ‡«ðŸ‡·"};function TranslateIcon({lang,loading=!1,error=!1}){const flag=(0,react.useMemo)(()=>{var _FLAGS_lang;return null!==(_FLAGS_lang=FLAGS[lang])&&void 0!==_FLAGS_lang?_FLAGS_lang:"ðŸ³ï¸"},[lang]),ArrowIcon=error?index_esm.KP4:index_esm.Z0P;return(0,jsx_runtime.jsxs)("span",{className:"inline-flex items-center text-xs relative",children:[(0,jsx_runtime.jsx)(ArrowIcon,{className:"mr-0.5 "+(loading?"animate-translate-arrow":"")}),(0,jsx_runtime.jsxs)("span",{"aria-label":lang,className:"relative "+(loading?"animate-translate-flag":""),children:[flag,error?(0,jsx_runtime.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-red-600",children:"âœ–"}):null]})]})}function InlineTranslateButton({lang,onTranslate}){const[state,setState]=(0,react.useState)("idle");return(0,jsx_runtime.jsx)("button",{type:"button",onClick:async function handleClick(){if("loading"!==state){setState("loading");try{await Promise.resolve(onTranslate()),setState("idle")}catch(e){setState("error")}}},"aria-label":"translate",className:"ml-2 text-blue-500 hover:text-blue-700",children:(0,jsx_runtime.jsx)(TranslateIcon,{lang,loading:"loading"===state,error:"error"===state})})}TranslateIcon.__docgenInfo={description:"",methods:[],displayName:"TranslateIcon",props:{lang:{required:!0,tsType:{name:"string"},description:""},loading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},error:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}},InlineTranslateButton.__docgenInfo={description:"",methods:[],displayName:"InlineTranslateButton",props:{lang:{required:!0,tsType:{name:"string"},description:""},onTranslate:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void> | void",signature:{arguments:[],return:{name:"union",raw:"Promise<void> | void",elements:[{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"void"}]}}},description:""}}}},"./src/app/hooks/useCase.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useCase,U:()=>caseQueryKey});var _tanstack_react_query__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useQuery.js");const caseQueryKey=id=>[`/api/cases/${id}`];function useCase(id,initialData){return(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_0__.I)({queryKey:caseQueryKey(id),initialData:null!=initialData?initialData:void 0,enabled:!!id})}},"./src/app/hooks/useEventSource.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useEventSource});var _apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/apiClient.ts"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function useEventSource(url,onData){const handleMessage=(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)(e=>{try{onData(JSON.parse(e.data))}catch(e){}},[onData]);(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(!url)return;const es=(0,_apiClient__WEBPACK_IMPORTED_MODULE_0__.a)(url);return es.onmessage=handleMessage,()=>es.close()},[url,handleMessage])}},"./src/app/useNewCaseFromFiles.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>useNewCaseFromFiles});var _apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/apiClient.ts"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useMutation.js"),next_navigation__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),react_i18next__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/app/components/NotificationProvider.tsx");function useNewCaseFromFiles(){const router=(0,next_navigation__WEBPACK_IMPORTED_MODULE_1__.useRouter)(),notify=(0,_components_NotificationProvider__WEBPACK_IMPORTED_MODULE_3__.l)(),{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_2__.Bd)(),uploadMutation=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_4__.n)({mutationFn:async formData=>(0,_apiClient__WEBPACK_IMPORTED_MODULE_0__.n)("/api/upload",{method:"POST",body:formData})});return async(files,gps)=>{if(!files||0===files.length)return;const id=crypto.randomUUID(),preview=URL.createObjectURL(files[0]);sessionStorage.setItem(`preview-${id}`,preview);(await Promise.all(Array.from(files).map((file,idx)=>{const formData=new FormData;formData.append("photo",file),formData.append("caseId",id),gps&&(formData.append("lat",String(gps.lat)),formData.append("lon",String(gps.lon)));const upload=uploadMutation.mutateAsync(formData);return 0===idx&&upload.then(()=>{sessionStorage.removeItem(`preview-${id}`)}),upload}))).some(r=>!r.ok)?notify(t("failedUpload")):router.push(`/cases/${id}`)}}},"./src/app/useSession.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{CI:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.signOut,Jv:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.signIn,wV:()=>next_auth_react__WEBPACK_IMPORTED_MODULE_0__.useSession});var next_auth_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next-auth/react/index.js")},"./src/lib/caseUtils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Pk:()=>getAnalysisSummary,_g:()=>getBestViolationPhoto,g_:()=>getCaseOwnerContact,sC:()=>getCaseOwnerContactInfo,qy:()=>getCasePlateNumber,W7:()=>getCasePlateState,E5:()=>getCaseVin,qR:()=>getOfficialCaseGps,wq:()=>getRepresentativePhoto,u5:()=>hasCaseViolation});var i18next=__webpack_require__("./node_modules/i18next/dist/esm/i18next.js");__webpack_require__("./public/locales/en/common.json"),__webpack_require__("./public/locales/es/common.json"),__webpack_require__("./public/locales/fr/common.json");const instance=i18next.Ay.createInstance();const i18n_server=instance;function basename(filePath){const parts=filePath.split(/[\\/]/);return parts[parts.length-1]}function getRepresentativePhoto(caseData){var _caseData_analysis;if(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images){const best=Object.entries(caseData.analysis.images).sort((a,b)=>b[1].representationScore-a[1].representationScore)[0];if(best){const name=best[0],file=caseData.photos.find(p=>basename(p)===name);if(file)return file}}const sorted=[...caseData.photos].sort();return sorted.length>0?sorted[0]:null}function getOfficialCaseGps(caseData){var _caseData_analysis,_caseData_gps;if((null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)&&caseData.photoGps){const entries=Object.entries(caseData.analysis.images).sort((a,b)=>b[1].representationScore-a[1].representationScore);for(const[name]of entries){const file=caseData.photos.find(p=>basename(p)===name);if(file){const gps=caseData.photoGps[file];if(gps)return gps}}}if(caseData.photoGps)for(const p of caseData.photos){const g=caseData.photoGps[p];if(g)return g}return null!==(_caseData_gps=caseData.gps)&&void 0!==_caseData_gps?_caseData_gps:null}function hasCaseViolation(c){return!!c.violationOverride||function hasViolation(report){var _report_violationType;if(!report)return!1;if(report.images){const all=Object.values(report.images),hasTrue=all.some(i=>!0===i.violation),hasFalse=all.some(i=>!1===i.violation);if(hasTrue||hasFalse)return hasTrue}return Boolean(null===(_report_violationType=report.violationType)||void 0===_report_violationType?void 0:_report_violationType.trim())}(c.analysis)}function getCaseVin(caseData){var _caseData_analysis;if(caseData.vin)return caseData.vin;const imgs=(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const vin=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.vin;if(vin)return vin}return null}function getCasePlateNumber(caseData){var _caseData_analysis_vehicle,_caseData_analysis,_caseData_analysis1;const direct=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis||null===(_caseData_analysis_vehicle=_caseData_analysis.vehicle)||void 0===_caseData_analysis_vehicle?void 0:_caseData_analysis_vehicle.licensePlateNumber;if(direct)return direct;const imgs=(null===(_caseData_analysis1=caseData.analysis)||void 0===_caseData_analysis1?void 0:_caseData_analysis1.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const plate=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.licensePlateNumber;if(plate)return plate}return null}function getCasePlateState(caseData){var _caseData_analysis_vehicle,_caseData_analysis,_caseData_analysis1;const direct=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis||null===(_caseData_analysis_vehicle=_caseData_analysis.vehicle)||void 0===_caseData_analysis_vehicle?void 0:_caseData_analysis_vehicle.licensePlateState;if(direct)return direct;const imgs=(null===(_caseData_analysis1=caseData.analysis)||void 0===_caseData_analysis1?void 0:_caseData_analysis1.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo_vehicle,_info_paperworkInfo;const state=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo||null===(_info_paperworkInfo_vehicle=_info_paperworkInfo.vehicle)||void 0===_info_paperworkInfo_vehicle?void 0:_info_paperworkInfo_vehicle.licensePlateState;if(state)return state}return null}function getCaseOwnerContact(caseData){var _caseData_analysis;const imgs=(null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)?Object.values(caseData.analysis.images):[];for(const info of imgs){var _info_paperworkInfo;const contact=null===(_info_paperworkInfo=info.paperworkInfo)||void 0===_info_paperworkInfo?void 0:_info_paperworkInfo.contact;if(contact)return contact}return null}function getCaseOwnerContactInfo(caseData){const contact=getCaseOwnerContact(caseData);return contact?function parseContactInfo(text){const emailMatch=text.match(/[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}/),phoneMatch=text.match(/\+?\d[\d\s().-]{7,}\d/);let address;return text.trim().split(/\n+/).length>1&&(address=text.trim()),{email:emailMatch?emailMatch[0]:void 0,phone:phoneMatch?phoneMatch[0]:void 0,address}}(contact):null}function getBestViolationPhoto(caseData){var _caseData_analysis,_info_highlights,_info_highlights1,_caseData_analysis_images;const imgs=null!==(_caseData_analysis_images=null===(_caseData_analysis=caseData.analysis)||void 0===_caseData_analysis?void 0:_caseData_analysis.images)&&void 0!==_caseData_analysis_images?_caseData_analysis_images:{},entries=Object.entries(imgs).filter(([,info])=>info.violation).sort((a,b)=>b[1].representationScore-a[1].representationScore),best=entries[0];if(!best)return null;const[name,info]=best,file=caseData.photos.find(p=>basename(p)===name);if(!file)return null;var _info_highlights_i18n_language,_info_highlights2,_ref;return{photo:file,caption:"string"==typeof info.highlights?info.highlights:null!==(_ref=null!==(_info_highlights_i18n_language=null===(_info_highlights=info.highlights)||void 0===_info_highlights?void 0:_info_highlights[i18n_server.language])&&void 0!==_info_highlights_i18n_language?_info_highlights_i18n_language:null===(_info_highlights1=info.highlights)||void 0===_info_highlights1?void 0:_info_highlights1.en)&&void 0!==_ref?_ref:Object.values(null!==(_info_highlights2=info.highlights)&&void 0!==_info_highlights2?_info_highlights2:{})[0]}}function getAnalysisSummary(report){var _report_vehicle,_report_vehicle1,_report_details_i18n_language,_ref,_ref1;const detailText="string"==typeof report.details?report.details:null!==(_ref1=null!==(_ref=null!==(_report_details_i18n_language=report.details[i18n_server.language])&&void 0!==_report_details_i18n_language?_report_details_i18n_language:report.details.en)&&void 0!==_ref?_ref:Object.values(report.details)[0])&&void 0!==_ref1?_ref1:"",parts=[`Violation: ${report.violationType}`,detailText];report.location&&parts.push(`Location: ${report.location}`);const plate=[];return(null===(_report_vehicle=report.vehicle)||void 0===_report_vehicle?void 0:_report_vehicle.licensePlateState)&&plate.push(report.vehicle.licensePlateState),(null===(_report_vehicle1=report.vehicle)||void 0===_report_vehicle1?void 0:_report_vehicle1.licensePlateNumber)&&plate.push(report.vehicle.licensePlateNumber),plate.length>0&&parts.push(`Plate: ${plate.join(" ")}`),parts.filter(Boolean).join("\n")}},"./src/lib/localizedText.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function getLocalizedText(textMap,lang){if(!textMap)return{text:"",needsTranslation:!1};if("string"==typeof textMap)return{text:textMap,needsTranslation:!1};var _textMap_lang,_ref,_ref1;return{text:null!==(_ref1=null!==(_ref=null!==(_textMap_lang=textMap[lang])&&void 0!==_textMap_lang?_textMap_lang:textMap.en)&&void 0!==_ref?_ref:Object.values(textMap)[0])&&void 0!==_ref1?_ref1:"",needsTranslation:!(lang in textMap)}}__webpack_require__.d(__webpack_exports__,{P:()=>getLocalizedText})}}]);